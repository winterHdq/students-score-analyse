(function(){var e={3280:function(e,t,a){"use strict";var s=a(6369),l=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],r=a(1001),o={},n=(0,r.Z)(o,l,i,!1,null,null,null),c=n.exports,h=a(2631),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Excel"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"",accept:".xls,.xlsx","auto-upload":!1,"show-file-list":!1,"on-change":e.fileChange}},[t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""}},[e._v("上传")])],1),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:function(t){e.compaseDialog.show=!0}}},[e._v(" 进退比较 ")]),t("base-mul-sheet-export-btn",{staticClass:"btn"}),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:e.onDelete}},[e._v(" 一键删除 ")])],1),t("div",{staticClass:"right"},[t("base-template-btn")],1)]),t("div",{staticClass:"content"},[t("div",{staticClass:"left"},[t("menu-list")],1),t("div",{staticClass:"right"},[e.curTable.column?t("div",["sortTemplate"==e.curTable.template?t("sort-template",{attrs:{subjects:e.curTable.extend.subjects,curTable:e.curTable,sortObj:e.curTable.extend.sortObj,extendData:e.curTable.extend.extendData,scoreTable:e.curTable.extend.scoreTable,"table-height":e.tableHeight}}):t("score-template",{attrs:{tableHeight:e.tableHeight}})],1):e._e()])]),e.compaseDialog.show?t("compase-dialog",{attrs:{tables:e.tables},on:{onClose:function(t){e.compaseDialog.show=!1}}}):e._e()],1)},m=[],d=(a(7658),a(7387)),b=a.n(d),p=a(7092),f=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"compare-dialog",attrs:{visible:e.dialogVisible,title:"比较设置","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:"","label-width":"80px"}},[t("el-form-item",{attrs:{label:"本次成绩",prop:"initTableId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.initTableChange},model:{value:e.formData.initTableId,callback:function(t){e.$set(e.formData,"initTableId",t)},expression:"formData.initTableId"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"上次成绩",prop:"compareTableId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.compareTableChange},model:{value:e.formData.compareTableId,callback:function(t){e.$set(e.formData,"compareTableId",t)},expression:"formData.compareTableId"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("br"),t("el-form-item",{attrs:{label:"基准",prop:"baseTh"}},[t("el-select",{attrs:{placeholder:""},model:{value:e.formData.baseTh,callback:function(t){e.$set(e.formData,"baseTh",t)},expression:"formData.baseTh"}},e._l(e.thList,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1),t("span",{staticClass:"tip"},[e._v(" 请确保基准列数据唯一，比如以【姓名】为基准比较两个表格 ")])],1),t("br"),t("br"),t("el-form-item",{attrs:{label:"比较列",prop:"compareTh"}},[e.formData.initTableId?t("el-checkbox",{attrs:{indeterminate:e.checkData.compareThIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"compareTh")}},model:{value:e.checkData.compareThCheckAll,callback:function(t){e.$set(e.checkData,"compareThCheckAll",t)},expression:"checkData.compareThCheckAll"}},[e._v(" 全选 ")]):e._e(),t("el-checkbox-group",{model:{value:e.formData.compareTh,callback:function(t){e.$set(e.formData,"compareTh",t)},expression:"formData.compareTh"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1),e.compareTableDialog?t("el-dialog",{attrs:{title:"比较列表",width:"90%",visible:e.compareTableDialog,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.compareTableDialog=t}}},[t("base-export-btn",{attrs:{table:e.compareTable,isMultiple:!0}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:e.onAddList}},[e._v(" 添加到列表 ")]),t("base-table",{attrs:{table:e.compareTable}})],1):e._e()],1)},g=[],y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-table"},[t("el-table",{ref:"table",attrs:{data:e.table.data,border:"",stripe:"","highlight-current-row":"",height:e.tableHeight}},[t("el-table-column",{attrs:{fixed:"",label:"序号",type:"index",align:"center"}}),e._l(e.table.column,(function(a){return t("el-table-column",{key:a,attrs:{label:a,prop:a,fixed:a.indexOf("班级")>=0||"姓名"==a,sortable:-1==a.indexOf("班级")&&"姓名"!==a,align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("span",{style:e.scoreStyle(s,a)},[e._v(e._s(s[a]))])]}}],null,!0)})}))],2)],1)},v=[],x={name:"BaseTable",props:{tableHeight:{type:Number,default:500},table:{type:Object,default(){return{}}}},watch:{table(){this.$nextTick((()=>{this.doLayout()}))}},computed:{subjectObj(){return this.$store.getters.subjectObj},subjectRankList(){return this.table.column.filter((e=>e.indexOf("进退")>0))}},data(){return{}},methods:{doLayout(){this.$refs.table&&this.$refs.table.doLayout()},scoreStyle(e,t){let{subjectObj:a,subjectRankList:s}=this;if(this.table.isCompare){if(s.includes(t)&&e[t]<0)return{color:"red"}}else if(a[t]&&e[t]<a[t].passScore)return{color:"red"};return{}}}},T=x,k=(0,r.Z)(T,y,v,!1,null,"0e80698f",null),C=k.exports,S=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseExportBtn"},[t("el-button",{attrs:{type:"primary"},on:{click:e.exportExcelHandle}},[e._v("导出")]),e.isMultiple?t("el-button",{staticClass:"btn",attrs:{type:"success"},on:{click:e.exportMultipleSheetsExcelHandle}},[e._v(" 分表导出 ")]):e._e(),t("el-dialog",{attrs:{top:"20vh",title:"导出",visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"导出名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入导出表格的名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"导出列",prop:"column"}},[t("el-checkbox",{attrs:{indeterminate:e.checkData.showThIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkData.showThCheckAll,callback:function(t){e.$set(e.checkData,"showThCheckAll",t)},expression:"checkData.showThCheckAll"}},[e._v(" 全选 ")]),t("el-checkbox-group",{on:{change:e.handleCheckChange},model:{value:e.formData.column,callback:function(t){e.$set(e.formData,"column",t)},expression:"formData.column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1),t("el-dialog",{attrs:{top:"20vh",title:"分表导出",visible:e.dialogVisibleMul,"append-to-body":!0,"destroy-on-close":!0,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.dialogVisibleMul=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExportMul}},[e._v("导出")]),t("el-form",{ref:"formMul",attrs:{model:e.formDataMul,rules:e.rulesMul,inline:""}},[t("el-table",{attrs:{data:e.formDataMul.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),t("el-table-column",{attrs:{label:"表名",width:"150"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.name}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formDataMul.tables[a].name,callback:function(t){e.$set(e.formDataMul.tables[a],"name",t)},expression:"formDataMul.tables[$index].name"}})],1)]}}])}),t("el-table-column",{attrs:{label:"列名",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.column}},[t("el-checkbox-group",{model:{value:e.formDataMul.tables[a].column,callback:function(t){e.$set(e.formDataMul.tables[a],"column",t)},expression:"formDataMul.tables[$index].column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[a==e.formDataMul.tables.length-1?t("el-button",{attrs:{type:"primary"},on:{click:e.onAddSheet}},[e._v(" 添加 ")]):e._e(),e.formDataMul.tables.length-1?t("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"danger"},on:{click:function(t){return e.onDelectSheet(a)}}},[e._v(" 删除 ")]):e._e()]}}])})],1)],1)],1)],1)},w=[],D=a(5209),$=a.n(D);const _={data(){return{}},computed:{subjectObj(){return this.$store.getters.subjectObj}},methods:{baseExportExcel(e){const t=$().utils.book_new(),a=this.sheetHandle(e);$().utils.book_append_sheet(t,a);const s=e.name.lastIndexOf("."),l=e.name.slice(0,-1==s?99:s);$().writeFile(t,`${l}-${e.className||"班级"}.xlsx`)},baseExportMulSheetExcel(e){const t=$().utils.book_new();e.sheets.forEach((e=>{const a=this.sheetHandle(e);$().utils.book_append_sheet(t,a,e.name)})),$().writeFile(t,`${e.name}.xlsx`)},sheetHandle(e){try{const t=$().utils.json_to_sheet(e.data),a=e.column.length,s=e.column.filter((e=>e.indexOf("进退")>0));return Object.keys(t).forEach(((l,i)=>{l.indexOf("!")<0&&(t[l].s={alignment:{vertical:"center",horizontal:"center"},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},font:{name:"宋体",sz:10}},this.textColorHandle(e.column[i%a],t[l],e.isCompare,s))})),t}catch(t){this.$message.error("啊欧，数据出错，导出失败")}},textColorHandle(e,t,a,s){try{const l=t.v;a?s.includes(e)&&l<0&&(t.s.font.color={rgb:"FF0000"}):this.subjectObj[e]&&l<this.subjectObj[e].passScore&&(t.s.font.color={rgb:"FF0000"})}catch(l){console.log(l),this.$message.error("样式错误，导出失败")}}}};var N=_,j={name:"BaseExportBtn",components:{},mixins:[N],props:{table:{type:Object,default(){return{}}},isMultiple:{type:Boolean,default:!1}},computed:{thList(){return this.table.column||Object.keys(this.table.data[0])},subjectList(){return this.$store.getters.subjectList}},data(){return{dialogVisible:!1,formData:{name:"",column:[]},checkData:{showThCheckAll:!0,showThIndeterminate:!1},rules:{name:[{required:!0,message:"请输入"}],column:[{required:!0,message:"请选择"}]},dialogVisibleMul:!1,rulesMul:{},formDataMul:{tables:[]}}},methods:{handleCheckAllChange(e){this.formData.column=e?this.thList:[],this.checkData.showThIndeterminate=!1},handleCheckChange(e){let t=e.length;this.checkData.showThCheckAll=t===this.thList.length,this.checkData.showThIndeterminate=t>0&&t<this.thList.length},exportExcelHandle(){this.formData.name=this.table.name,this.formData.column=this.thList,this.dialogVisible=!0},onAddSheet(e={}){this.formDataMul.tables.push({id:Date.now(),name:e.name||"",column:e.column||[],data:[],isCompare:!0})},onDelectSheet(e){this.formDataMul.tables.splice(e,1)},exportMultipleSheetsExcelHandle(){this.dialogVisibleMul=!0,this.formDataMul.tables=[],this.thList.forEach((e=>{if(this.subjectList.includes(e)){let t={name:`${e}进退分析`,column:["姓名","班级",e]};this.thList.includes(this.subjectObj[e].rankKey)&&t.column.push(this.subjectObj[e].rankKey),this.thList.includes(`${this.subjectObj[e].rankKey}进退`)&&t.column.push(`${this.subjectObj[e].rankKey}进退`),["总分","段名","折总","折算名"].forEach((e=>{this.thList.includes(e)&&t.column.push(e)})),this.onAddSheet(t)}}))},async onExport(){await this.$refs.form.validate();let e=[];this.table.data.forEach((t=>{let a={};for(let e in t)this.formData.column.includes(e)&&(a[e]=t[e]);e.push(a)})),this.baseExportExcel({...this.table,data:e,column:this.formData.column,name:this.formData.name},!0),this.$message.warning("正在导出"),this.dialogVisible=!1},async onExportMul(){try{await this.$refs.formMul.validate(),this.formDataMul.tables.forEach((e=>e.data=[])),this.table.data.forEach((e=>{this.formDataMul.tables.forEach((t=>{let a={};for(let s in e)t.column.includes(s)&&(a[s]=e[s]);t.data.push(a)}))}));const e={name:"分科",sheets:this.formDataMul.tables};this.baseExportMulSheetExcel(e),this.$message.warning("正在导出"),this.dialogVisibleMul=!1}catch(e){console.log(e)}}}},E=j,O=(0,r.Z)(E,S,w,!1,null,"0c0757fd",null),L=O.exports,M=a(3767);const I=(e=[])=>{const t=Array.from(new Set(e));return e.length!==t.length},R=(e=[])=>{for(let t=0;t<e.length;t++)e[t]=e[t]||0},A=(...e)=>{R(e);const t=M.ZP.minus.apply(null,e);return H(t)},H=e=>{let t=e.toString().split(".")[1]?.length||0;return t>6&&(t=6),B(e,t)},B=M.ZP.round;var P={name:"CompareDialog",components:{BaseTable:C,BaseExportBtn:L},mixins:[N],props:{tables:{type:Array,default(){return[]}}},data(){return{formData:{initTableId:null,compareTableId:null,baseTh:"",compareTh:[]},checkData:{showThCheckAll:!1,showThIndeterminate:!1,compareThCheckAll:!1,compareThIndeterminate:!1},initTable:null,preTable:null,rules:{initTableId:[{required:!0,message:"请选择"}],compareTableId:[{required:!0,message:"请选择"}],baseTh:[{required:!0,message:"请选择"}],compareTh:[{required:!0,message:"请选择"}]},thList:[],dialogVisible:!1,compareTableDialog:!1,compareTable:{}}},created(){this.dialogVisible=!0},methods:{handleCheckAllChange(e,t){this.formData[t]=e?this.thList:[],this.checkData[`${t}Indeterminate`]=!1},handleCheckChange(e,t){let a=e.length;this.checkData[`${t}CheckAll`]=a===this.thList.length,this.checkData[`${t}Indeterminate`]=a>0&&a<this.thList.length},initTableChange(e){e==this.formData.compareTableId&&this.$message.error("比较的是同一张表格，请确认"),this.initTable=this.tables.find((t=>t.id==e)),this.thList=Object.keys(this.initTable.data[0]),this.formData.compareTh=this.thList.filter((e=>"姓名"!==e&&e.indexOf("名")>0)),this.formData.baseTh=this.thList.find((e=>"姓名"==e))||this.thList[0]},compareTableChange(e){e==this.formData.initTableId&&this.$message.error("比较的是同一张表格，请确认"),this.preTable=this.tables.find((t=>t.id==e))},async onSave(){if(await this.$refs.form.validate(),I(this.initTable.data.map((e=>e[this.formData.baseTh]))))return this.$message.error(`本次成绩【${this.formData.baseTh}】基准列存在重复值，请修改`),!1;if(!this.preTable.column.includes(this.formData.baseTh))return this.$message.error(`上次成绩无【${this.formData.baseTh}】基准列，请重新选择`),!1;let e=this.formData.compareTh.find((e=>!this.preTable.column.includes(e)));if(e)return this.$message.error(`上次成绩里无【${e}】列，无法进行比较，请重新选择`),!1;let t=[],a=JSON.parse(JSON.stringify(this.preTable.data)),s=a.length;this.initTable.data.forEach((e=>{let l=!1;for(let i=0;i<s;i++)if(e[this.formData.baseTh]==a[i][this.formData.baseTh]){l=!0;let r={};for(let t in e)r[t]=e[t],this.formData.compareTh.includes(t)&&!isNaN(e[t])&&(r[`${t}进退`]=A(e[t],a[i][t]),t.indexOf("名")>0&&(r[`${t}进退`]=0-r[`${t}进退`]));a.splice(i,1),t.push(r),s--;break}l||(this.formData.compareTh.forEach((t=>e[`${t}进退`]="")),t.push(e))}));const l=Object.keys(t[0]);a.forEach((e=>{let a={};l.forEach((t=>{e[t]&&isNaN(e[t])?a[t]=e[t]:a[t]=""})),t.push(a)}));let i={name:`${this.initTable.name}-${this.initTable.className}-进退比较`,data:t,id:Date.now(),column:l,className:`${this.initTable.className}`,isCompare:!0,extend:{compareColumn:this.formData.compareTh,preTable:this.preTable}};this.compareTable=i,this.compareTableDialog=!0},onAddList(){this.$store.commit("addTable",this.compareTable),this.$store.commit("setCurTableId",this.compareTable.id),this.onClose()},onClose(){this.$emit("onClose")}}},K=P,V=(0,r.Z)(K,f,g,!1,null,"2c650d4e",null),z=V.exports,Z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseTemplateBtn"},[t("el-button",{attrs:{type:"success",size:"small",plain:""},on:{click:function(t){e.dialogVisiable=!e.dialogVisiable}}},[e._v(" 模板 ")]),t("el-dialog",{attrs:{title:"模板",visible:e.dialogVisiable,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),t("table",{staticClass:"table",attrs:{border:""}},[t("tr",e._l(e.table.column,(function(a){return t("th",{key:a},[e._v(e._s(a))])})),0),e._l(e.table.data.length,(function(a){return t("tr",{key:a},e._l(e.table.column,(function(e){return t("td",{key:e})})),0)}))],2)],1)],1)},F=[],q={name:"BaseTemplateBtn",mixins:[N],data(){return{dialogVisiable:!1,table:{id:Date.now(),name:"模板",column:[],data:[]}}},computed:{subjectMap(){return this.$store.state.subjectMap}},created(){this.table.column=this.subjectMap.reduce(((e,t)=>(e.push(t.scoreKey),e.push(t.rankKey),e)),["班级","姓名"]),this.table.column.push("总分","段名","折总","折算名");for(let e=0;e<3;e++){const e={};this.table.column.forEach((t=>e[t]="")),this.table.data.push(e)}},methods:{onExport(){this.baseExportExcel(this.table)}}},J=q,W=(0,r.Z)(J,Z,F,!1,null,"2f7b454a",null),U=W.exports,G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sortTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[1==e.radio?t("el-button",{attrs:{type:"warning"},on:{click:function(t){e.isShowName=!e.isShowName}}},[e._v(" "+e._s(e.isShowName?"隐藏":"显示")+"姓名 ")]):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:e.exportExcel}},[e._v("导出")]),t("el-button",{attrs:{type:"danger"},on:{click:e.onAddTable}},[e._v("添加到列表")])],1),t("div",{staticClass:"content"},[e._v(e._s(e.subjects))]),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1)],1)]),t("el-table",{directives:[{name:"show",rawName:"v-show",value:1==e.radio,expression:"radio == 1"}],attrs:{data:e.scoreTable,border:"",height:e.tableHeight}},[t("el-table-column",{attrs:{label:e.subjects,prop:"label",width:"100",align:"center"}}),t("el-table-column",{attrs:{label:e.curTable.className},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e._v(" "+e._s(a.value)+" "),e.isShowName&&a.isName?t("span",[e._v("："+e._s(e._f("toList")(a.data)))]):e._e()]}}])})],1),2==e.radio?t("div",[t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"270px"},attrs:{id:"sortScoreName"}}),e._m(0),e._m(1)]):e._e()],1)},Q=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"250px"},attrs:{id:"scoreRegion"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"250px"},attrs:{id:"rangRegion"}})])},function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"pass"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"excellent"}})])}],X={name:"SortTemplate",mixins:[N],props:{tableHeight:{type:Number,default:500},subjects:{type:String,require:!0},curTable:{type:Object,default(){return{}}},sortObj:{type:Object,default(){return{}}},scoreTable:{type:Array,default(){return[]}},extendData:{type:Object,default(){return{}}}},filters:{toList(e){return Array.isArray(e)?e.map((e=>e.name)).join("、"):e.name||""}},watch:{"curTable.id":{handler(){this.typeChangeHandle()}},isShowMenu(){this.echartsResize()}},computed:{isShowMenu(){return this.$store.state.isShowMenu}},data(){return{isShowName:!1,radio:2,echartsScoreName:null,echartsScoreRegion:null,echartsRangRegion:null,echartsPass:null,echartsexcellent:null,echartTitleStyle:{color:"#5470c6",fontSize:"14px",lineHeight:30}}},created(){this.typeChangeHandle()},destroyed(){this.destroyedEchart()},methods:{echartInit(){this.$nextTick((()=>{this.echartsScoreNameInit(),this.echartsScoreRegionInit(),this.echartsRangRegionInit(),this.echartsPassInit(),this.echartsexcellentInit()}))},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},echartsScoreNameInit(){this.echartsScoreName=this.$echarts.init(document.getElementById("sortScoreName"));const e=this,t={title:{text:"成绩排序表",textStyle:this.echartTitleStyle},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"姓名",type:"category",data:this.extendData.scoreList.map((e=>e.name)),axisLabel:{interval:0,rotate:45}},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:[{name:"分数",data:this.extendData.scoreList.map((e=>e.score)),type:"line",markPoint:{data:[{type:"max",name:"最高分"},{type:"min",name:"最低分"}]},markLine:{data:[{type:"average",name:"平均分"}],label:{formatter(t){return`${t.name}：${t.value}\n均分人数：${e.sortObj.averageNum}`}}}}]};this.echartsScoreName.setOption(t)},echartsScoreRegionInit(){this.echartsScoreRegion=this.$echarts.init(document.getElementById("scoreRegion"));const e={title:{text:"成绩分析表",textStyle:this.echartTitleStyle},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{true:!1},xAxis:{name:"分数",type:"category",data:this.extendData.scoreRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:20}},yAxis:{name:"人数",type:"value"},series:[{name:"人数",data:this.extendData.scoreRegionList.map((e=>e.value)),type:"bar",label:{show:!0},showBackground:!0,backgroundStyle:{color:"rgba(220, 220, 220, 0.8)"}}]};this.echartsScoreRegion.setOption(e)},echartsRangRegionInit(){this.echartsRangRegion=this.$echarts.init(document.getElementById("rangRegion"));const e={title:{text:"名次分析表",textStyle:this.echartTitleStyle},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{name:"名次",type:"category",data:this.extendData.rangRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:0}},yAxis:{name:"人数",type:"value"},series:[{name:"人数",data:this.extendData.rangRegionList.map((e=>e.value)),type:"bar",label:{show:!0},showBackground:!0,backgroundStyle:{color:"rgba(220, 220, 220, 0.8)"}}]};this.echartsRangRegion.setOption(e)},echartsPassInit(){this.echartsPass=this.$echarts.init(document.getElementById("pass"));let e={title:{text:"及格率",textStyle:this.echartTitleStyle},tooltip:{trigger:"item"},series:[{name:"人数",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!0,position:"inside",formatter:"{d}%"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:this.sortObj.pass.length,name:"及格数"},{value:this.sortObj.noPass.length,name:"不及格数"}]}],legend:{show:!0,zlevel:0,z:2,left:"center",formatter(t){const a="及格数"==t?e.series[0].data[0].value:e.series[0].data[1].value;return`${t}：${a}`}}};this.echartsPass.setOption(e)},echartsexcellentInit(){this.echartsexcellent=this.$echarts.init(document.getElementById("excellent"));const e={title:{text:"优秀率",textStyle:this.echartTitleStyle},tooltip:{trigger:"item"},series:[{name:"人数",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!0,position:"inside",formatter:"{d}%"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:this.sortObj.excellent.length,name:"优秀数"},{value:this.sortObj.peopleNum-this.sortObj.excellent.length,name:"其他"}]}],legend:{show:!0,zlevel:0,z:2,left:"center",formatter(t){const a="优秀数"==t?e.series[0].data[0].value:e.series[0].data[1].value;return`${t}：${a}`}}};this.echartsexcellent.setOption(e)},destroyedEchart(){this.echartsScoreName&&this.echartsScoreName.dispose(),this.echartsScoreRegion&&this.echartsScoreRegion.dispose(),this.echartsRangRegion&&this.echartsRangRegion.dispose(),this.echartsPass&&this.echartsPass.dispose(),this.echartsexcellent&&this.echartsexcellent.dispose()},echartsResize(){setTimeout((()=>{["echartsScoreName","echartsScoreRegion","echartsRangRegion","echartsPass","echartsexcellent"].forEach((e=>{this[e]&&this[e].resize()}))}),500)},exportExcel(){const e=this.tableHandle();this.baseExportExcel(e)},onAddTable(){const e=this.tableHandle();this.$store.commit("addTable",e),this.$store.commit("setCurTableId",e.id),this.$emit("onAddTable")},tableHandle(){let e=[];this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((t=>{if("TR"!==t.tagName)return;let a={},s=t.childNodes[0].textContent;s!=this.subjects&&(a[this.subjects]=s,a[this.curTable.className]=t.childNodes[1].textContent.trim(),e.push(a))}));const t={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.curTable.name}-${this.curTable.className}-${this.subjects}分析表`,className:this.curTable.className,isCompare:!1,template:"sortTemplate",extend:{subjects:this.subjects,extendData:this.extendData,sortObj:this.sortObj,scoreTable:this.scoreTable}};return t}}},Y=X,ee=(0,r.Z)(Y,G,Q,!1,null,"0d1669cd",null),te=ee.exports,ae=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scoreTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("base-class-setting",{ref:"setting",model:{value:e.curTable.className,callback:function(t){e.$set(e.curTable,"className",t)},expression:"curTable.className"}}),e.curTable.sortObj?e._l(e.subjectMap,(function(a){return t("el-button",{key:a.type,staticClass:"btn",attrs:{plain:"",type:"primary",size:"small"},on:{click:function(t){return e.openSortDialog(a.name)}}},[e._v(" "+e._s(a.name)+"分析 ")])})):e._e()],2),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1)],1)]),2==e.radio?t("div",[t("el-checkbox-group",{staticClass:"nameCheck",attrs:{min:1},on:{change:e.nameCheckChange},model:{value:e.nameCheck,callback:function(t){e.nameCheck=t},expression:"nameCheck"}},e._l(e.nameList,(function(e){return t("el-checkbox",{key:e,staticStyle:{width:"70px"},attrs:{label:e,value:e}})})),1),e._m(0),e.isCompare?t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"250px"},attrs:{id:"compare"}}):e._e()],1):t("base-table",{ref:"baseTable",attrs:{"table-height":e.tableHeight,table:e.curTable}}),e.sortCompareDialog.show?t("sort-dialog",{attrs:{subjectName:e.sortCompareDialog.name,curTable:e.curTable},on:{onClose:function(t){e.sortCompareDialog.show=!1}}}):e._e()],1)},se=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"scoreName"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"rankName"}})])}],le=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-class-setting"},[t("el-form",{ref:"form",attrs:{model:e.formData,inline:"","label-position":"left",rules:e.rules}},[t("el-form-item",{attrs:{label:"班级:",prop:"className"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.changeHandle},model:{value:e.formData.className,callback:function(t){e.$set(e.formData,"className",t)},expression:"formData.className"}},e._l(e.classMap,(function(e){return t("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)],1)],1)],1)},ie=[];const re=[{name:"语文",type:1,fullScore:150,scoreKey:"语文",rankKey:"语名"},{name:"数学",type:2,fullScore:150,scoreKey:"数学",rankKey:"数名"},{name:"英语",type:3,fullScore:150,scoreKey:"英语",rankKey:"英名"},{name:"物理",type:4,fullScore:100,scoreKey:"物理",rankKey:"物名"},{name:"化学",type:5,fullScore:100,scoreKey:"化学",rankKey:"化名"},{name:"政治",type:6,fullScore:100,scoreKey:"政治",rankKey:"政名"},{name:"历史",type:7,fullScore:100,scoreKey:"历史",rankKey:"历名"},{name:"生物",type:8,fullScore:100,scoreKey:"生物",rankKey:"生名"},{name:"地理",type:9,fullScore:100,scoreKey:"地理",rankKey:"地名"}],oe=[{label:"1班",value:"1班",bgColor:"#d32525"},{label:"2班",value:"2班",bgColor:"#0085ff"},{label:"3班",value:"3班",bgColor:"#9361dd"},{label:"4班",value:"4班",bgColor:"#d8810b"},{label:"5班",value:"5班",bgColor:"#5ed80b"},{label:"6班",value:"6班",bgColor:"#2acfcf"},{label:"7班",value:"7班",bgColor:"#49d4a5"},{label:"8班",value:"8班",bgColor:"#957e62"},{label:"9班",value:"9班",bgColor:"#3939fa"},{label:"10班",value:"10班",bgColor:"#cc66ad"},{label:"11班",value:"11班",bgColor:"#78a8dd"},{label:"12班",value:"12班",bgColor:"#b1ba13"},{label:"13班",value:"13班",bgColor:"#ff00eb"},{label:"14班",value:"14班",bgColor:"#9fb7cc"},{label:"年段",value:"年段",bgColor:"#8b0000"}];var ne={name:"BaseClassSetting",props:{value:{type:String,default:""}},computed:{tables(){return this.$store.state.tables}},watch:{value:{handler(e){this.formData.className=e||""},immediate:!0}},data(){return{classMap:oe,formData:{className:""},rules:{className:[{required:!0,message:"请设置班级"}]}}},methods:{changeHandle(e){this.$emit("input",e),this.$store.commit("setTables",this.tables)},async validate(){return await this.$refs.form.validate()}}},ce=ne,he=(0,r.Z)(ce,le,ie,!1,null,"2e4112b6",null),ue=he.exports,me=function(){var e=this,t=e._self._c;return e.dialogVisible?t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sort-dialog",attrs:{visible:e.dialogVisible,title:`${e.title}排位`,width:"80%",top:"5vh","close-on-click-modal":!1,"element-loading-text":"正在拼命计算中，请小主耐心等待"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("sort-template",{attrs:{curTable:e.curTable,scoreTable:e.scoreTable,sortObj:e.sortObj,subjects:e.title,extendData:{scoreList:e.scoreList,scoreRegionList:e.scoreRegionList,rangRegionList:e.rangRegionList}},on:{onAddTable:e.onClose}})],1):e._e()},de=[],be={name:"SortDialog",components:{SortTemplate:te},mixins:[N],props:{subjectName:{type:String,required:!0},curTable:{type:Object,default(){return{}}}},filters:{toList(e){return Array.isArray(e)?e.map((e=>e.name)).join("、"):e.name||""}},data(){return{title:"",dialogVisible:!1,sortObj:{},config:{},loading:!1,isShowName:!1,scoreList:[],scoreRegionList:[],otherList:[{label:"最高分",value:0,key:"maxScore",isName:!0},{label:"最低分",value:0,key:"minScore",isName:!0},{label:"不及格数",value:0,key:"pass",isName:!0},{label:"及格数",value:0,key:"noPass",isName:!0},{label:"及格率%",value:0,key:"passRate"},{label:"优秀数",value:0,key:"excellent",isName:!0},{label:"优秀率%",value:0,key:"excellentRate"},{label:"与考人数",value:0,key:"peopleNum"}],rangRegionList:[],averageList:[{label:"平均分",value:0,key:"average"},{label:"均分人数",value:0,key:"averageList",isName:!0}],scoreTable:[]}},computed:{subjectMap(){return this.$store.state.subjectMap},subjectObj(){return this.$store.getters.subjectObj},is150(){return 150==this.config.fullScore}},created(){this.config=this.subjectObj[this.subjectName],this.scoreRegionList=this.getScoreRegionList(),this.rangRegionList=this.getRangRegionList(),this.init()},methods:{getScoreRegionList(){let e=[];for(let t=14;t>=0;t--){let a=10*t,s=a+9;e.push({label:`${a}-${s}`,value:0,key:`score${a}to${s}`,isName:!0})}return this.is150?e[0].label="140-150":(e.splice(0,5),e[0].label="90-100"),e},getRangRegionList(){let e=[{label:"前10名",value:0,key:"top10",isAdd:!0,isName:!0}];for(let t=50;t<=400;t+=50)e.push({label:`前${t}名`,value:0,key:`top${t}`,isAdd:!0,isName:!0});return e.push({label:"400名后",value:0,key:"otherTop",isName:!0}),e},init(){let e=this.curTable.sortObj[this.config.scoreKey],t=this.curTable.sortObj[this.config.rankKey];this.title=`${this.config.name}`,this.singleSubjectSort(e,t)},singleSubjectSort(e,t){if(!e||!t)return this.$message.error("未查到该数据"),void this.onClose();const a=[];this.dialogVisible=!0,this.loading=!0,this.scoreList=e.sort(((e,t)=>t.score-e.score));let s={maxScore:0,minScore:0,pass:[],noPass:[],passRate:0,excellent:[],excellentNum:0,excellentRate:0,peopleNum:e.length,top10:[],top50:[],top100:[],top150:[],top200:[],top250:[],top300:[],top350:[],top400:[],otherTop:[],average:0,averageList:[]},l=0,i=.6*this.config.fullScore,r=.85*this.config.fullScore;s.maxScore=this.scoreList[0],s.minScore=this.scoreList[this.scoreList.length-1],e.forEach((e=>{this.getScoreRange(e,s),l+=e.score,e.score>=i?s.pass.push(e):s.noPass.push(e),e.score>=r&&s.excellent.push(e)})),s.passRate=(s.pass.length/s.peopleNum*100).toFixed(2),s.excellentRate=(s.excellent.length/s.peopleNum*100).toFixed(2),this.scoreRegionList.forEach((e=>{e.data=s[e.key]||[],e.value=e.data.length,a.push(e)})),this.otherList.forEach((e=>{let t=s[e.key];Array.isArray(t)?(e.data=t,e.value=t.length):t instanceof Object?(e.data=t,e.value=t.score):e.value=t,a.push(e)})),t.forEach((e=>{e.score>0&&e.score<=10?s.top10.push(e):e.score>10&&e.score<=50?s.top50.push(e):e.score>50&&e.score<=100?s.top100.push(e):e.score>100&&e.score<=150?s.top150.push(e):e.score>150&&e.score<=200?s.top200.push(e):e.score>200&&e.score<=250?s.top250.push(e):e.score>250&&e.score<=300?s.top300.push(e):e.score>300&&e.score<=350?s.top350.push(e):e.score>350&&e.score<=400?s.top400.push(e):s.otherTop.push(e)}));let o=0;this.rangRegionList.forEach((e=>{e.data=s[e.key]||[],e.value=e.isAdd?e.data.length+o:e.data.length,o=e.value,a.push(e)})),s.average=(l/s.peopleNum).toFixed(2),e.forEach((e=>{e.score>=s.average&&s.averageList.push(e)})),s.averageNum=s.averageList.length,this.averageList.forEach((e=>{const t=s[e.key];Array.isArray(t)?(e.data=t,e.value=t.length):e.value=s[e.key],a.push(e)})),this.scoreTable=a,this.sortObj=s,this.loading=!1},getScoreRange(e,t){let a=10*parseInt(e.score/10);this.is150||10!=a||(a=9),this.is150&&15==a&&(a=14);let s=a+9;t[`score${a}to${s}`]||(t[`score${a}to${s}`]=[]),t[`score${a}to${s}`].push(e)},tableHandle(){let e=[];this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((t=>{if("TR"!==t.tagName)return;let a={},s=t.childNodes[0].textContent;s!=this.title&&(a[this.title]=s,a[this.curTable.className]=t.childNodes[1].textContent.trim(),e.push(a))}));const t={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.curTable.name}-${this.curTable.className}-${this.title}分析表`,className:this.curTable.className,isCompare:!1};return t},onClose(){this.$emit("onClose")}}},pe=be,fe=(0,r.Z)(pe,me,de,!1,null,"1f4c8919",null),ge=fe.exports,ye=a(3822),ve={name:"ScoreTemplate",components:{BaseClassSetting:ue,BaseTable:C,SortDialog:ge},props:{tableHeight:{type:Number,default:500}},data(){return{sortCompareDialog:{show:!1,name:""},nameList:[],nameListObj:{},preNameListObj:{},radio:1,nameCheck:[],echartsScoreName:null,echartsRankName:null,echartsCompare:null,xAxisData:[],xAxisRankData:[]}},computed:{...(0,ye.rn)({subjectMap:e=>e.subjectMap,isShowMenu:e=>e.isShowMenu}),...(0,ye.Se)(["curTable","subjectList","subjectRankList"]),isCompare(){return this.curTable.isCompare}},watch:{"curTable.id":{handler(){this.dataInitHandle(),this.typeChangeHandle()},immediate:!0},isShowMenu(){this.echartsResize()}},destroyed(){this.destroyedEchart()},methods:{dataInitHandle(){this.nameCheck=[this.curTable.data[0]["姓名"]];let e={},t=[],a=[],s=[];this.curTable.data.forEach((a=>{let s=a["姓名"];e[s]=a,t.push(s)})),this.nameList=t,this.nameListObj=e,this.curTable.column.forEach((e=>{this.subjectList.includes(e)&&a.push(e)})),this.curTable.column.forEach((e=>{this.subjectRankList.includes(e)&&s.push(e)})),s.push("段名"),this.xAxisData=a,this.xAxisRankData=s,this.isCompare&&this.compareInitHandle()},compareInitHandle(){(this.curTable?.extend?.preTable.data||[]).forEach((e=>{this.preNameListObj[e["姓名"]]=e}))},async openSortDialog(e){try{await this.$refs.setting.validate(),this.sortCompareDialog.name=e,this.sortCompareDialog.show=!0}catch(t){console.log(t),this.$message.error("请先设置班级")}},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},destroyedEchart(){["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].dispose()}))},echartsResize(){setTimeout((()=>{["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].resize()}))}),500)},echartInit(){this.$nextTick((()=>{this.echartsScoreInit(),this.echartsRankInit(),this.echartsCompareInit()}))},nameCheckChange(e){this.nameCheck=e.splice(1,1);const t=this.getSeries();if(this.echartsScoreName.setOption({series:t.score}),this.echartsRankName.setOption({series:t.rank}),this.isCompare){const{series:e}=this.getCompaseConfig();this.echartsCompare.setOption({series:e})}},getSeries(){let e={score:[],rank:[]};return this.nameCheck.forEach((t=>{let a={name:this.curTable.name,type:"line",label:{show:!0},data:[]},s={name:this.curTable.name,type:"line",label:{show:!0},data:[]},l=this.nameListObj[t];this.xAxisData.forEach((e=>{a.data.push(l[e])})),this.xAxisRankData.forEach((e=>{s.data.push(l[e])})),e.score.push(a),e.rank.push(s)})),e},echartsScoreInit(){let{score:e}=this.getSeries();this.echartsScoreName=this.$echarts.init(document.getElementById("scoreName"));const t={title:{text:"成绩表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",data:this.xAxisData},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsScoreName.setOption(t)},echartsRankInit(){let{rank:e}=this.getSeries();this.echartsRankName=this.$echarts.init(document.getElementById("rankName"));const t={title:{text:"名次表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",data:this.xAxisRankData},yAxis:{name:"名次",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsRankName.setOption(t)},getCompaseConfig(){let e=this.curTable.extend.preTable,t=[{name:this.curTable.name,type:"line",label:{show:!0},data:[]},{name:e.name,type:"line",label:{show:!0},data:[]}],a=this.curTable.extend.compareColumn;const s=this.nameCheck[0];let l=this.nameListObj[s],i=this.preNameListObj[s];return a.forEach((e=>{l&&t[0].data.push(l[e]),i&&t[1].data.push(i[e])})),{series:t,xAxis:a}},echartsCompareInit(){if(!this.isCompare)return;let{xAxis:e,series:t}=this.getCompaseConfig();this.echartsCompare=this.$echarts.init(document.getElementById("compare"));const a={title:{text:"比较表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"比较",type:"category",data:e},yAxis:{type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:t};this.echartsCompare.setOption(a)}}},xe=ve,Te=(0,r.Z)(xe,ae,se,!1,null,"6240d563",null),ke=Te.exports,Ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseMulSheetExportBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" 合表导出 ")]),t("el-dialog",{attrs:{title:"分表导出",visible:e.visiableDialog,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.visiableDialog=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-table",{attrs:{data:e.formData.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"70"}}),t("el-table-column",{attrs:{label:"sheet名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.tableName}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.tableChangeHandle(t,a)}},model:{value:e.formData.tables[a].name,callback:function(t){e.$set(e.formData.tables[a],"name",t)},expression:"formData.tables[$index].name"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"列名"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.tableColumn}},[t("el-checkbox-group",{model:{value:e.formData.tables[a].column,callback:function(t){e.$set(e.formData.tables[a],"column",t)},expression:"formData.tables[$index].column"}},e._l(e.formData.tables[a].th,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{width:"100",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.formData.tables.push({name:"",column:[]})}}},[e._v(" 添加 ")])]},proxy:!0},{key:"default",fn:function({$index:a}){return[t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.onDelect(a)}}},[e._v(" 删除 ")])]}}])})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1)],1)},Se=[],we={name:"BaseMulSheetExportBtn",mixins:[N],computed:{tables(){return this.$store.state.tables}},data(){return{visiableDialog:!1,formData:{name:"",tables:[{name:"",column:[]}]},rules:{name:[{required:!0,message:"请输入"}],tableName:[{required:!0,message:"请选择"}],tableColumn:[{required:!0,message:"请选择"}]}}},methods:{tableChangeHandle(e,t){const a=this.tables.find((t=>t.id===e));this.formData.tables[t].table=a,this.formData.tables[t].th=a.column,this.formData.tables[t].column=a.column},onDelect(e){this.formData.tables.splice(e,1)},async onExport(){try{await this.$refs.form.validate();let e=[];this.formData.tables.forEach((t=>{let a={id:t.table.id,className:t.table.className,isCompare:t.table.isCompare||!1,data:[],column:t.column,name:t.table.name};t.table.data.forEach((e=>{let s={};for(const a in e)t.column.includes(a)&&(s[a]=e[a]);a.data.push(s)})),e.push(a)}));const t={name:this.formData.name,sheets:e};this.baseExportMulSheetExcel(t)}catch(e){console.log(e)}}}},De=we,$e=(0,r.Z)(De,Ce,Se,!1,null,"f1111b88",null),_e=$e.exports,Ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"menuList",style:{width:e.isShowMenu?"250px":"50px"}},[t("div",{staticClass:"title"},[e.isShowMenu?t("p",{staticClass:"text"},[e._v("列表")]):e._e(),t("i",{staticClass:"btn",class:e.isShowMenu?"el-icon-s-fold":"el-icon-s-unfold",on:{click:function(t){return e.$store.commit("setIsShowMenu",!e.isShowMenu)}}})]),t("transition",{attrs:{name:"el-fade-in-linear"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMenu,expression:"isShowMenu"}]},e._l(e.tables,(function(a,s){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("span",{staticClass:"name"},[e._v(e._s(a.name))]),t("i",{staticClass:"el-icon-download btn",on:{click:function(t){return e.exportExcel(a,t)}}}),t("i",{staticClass:"el-icon-delete-solid btn",staticStyle:{"padding-left":"5px"},on:{click:function(t){return e.delectTable(a,s,t)}}}),t("i",{staticClass:"el-icon-top btn",staticStyle:{"padding-left":"3px"},on:{click:function(t){return e.upMove(s,t)}}}),t("i",{staticClass:"el-icon-bottom btn",on:{click:function(t){return e.downMove(s,t)}}})])})),0)]),t("transition",{attrs:{name:"el-fade-in"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowMenu,expression:"!isShowMenu"}]},e._l(e.tables,(function(a){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:a.name,placement:"right"}},[t("i",{staticClass:"el-icon-document"})])],1)})),0)])],1)},je=[],Ee={name:"MenuList",mixins:[N],computed:{isShowMenu(){return this.$store.state.isShowMenu},tables(){return this.$store.state.tables},curTable(){return this.$store.getters.curTable||{}},classNameObj(){let e={};return oe.forEach((t=>{e[t.value]=t})),e}},created(){this.$store.commit("getIsShowMenu")},methods:{changeTable(e){this.$store.commit("setCurTableId",e.id)},exportExcel(e,t){t.stopPropagation(),this.baseExportExcel(e)},delectTable(e,t,a){a.stopPropagation(),this.$store.commit("deleteTable",t),e.id==this.curTableId&&this.$store.commit("setCurTableId",null)},upMove(e,t){t.stopPropagation(),this.$store.commit("upMoveTables",e)},downMove(e,t){t.stopPropagation(),this.$store.commit("downMoveTables",e)}}},Oe=Ee,Le=(0,r.Z)(Oe,Ne,je,!1,null,"3e945f6b",null),Me=Le.exports,Ie={name:"ExcelView",components:{CompaseDialog:z,BaseTemplateBtn:U,SortTemplate:te,ScoreTemplate:ke,BaseMulSheetExportBtn:_e,MenuList:Me},mixins:[N],data(){return{tableHeight:500,compaseDialog:{show:!1}}},computed:{...(0,ye.rn)({subjectMap:e=>e.subjectMap,tables:e=>e.tables}),curTable(){return this.$store.getters.curTable||{}}},created(){this.$store.commit("getTables")},mounted(){this.tableHeight=b()(".content")[0].offsetHeight-55,this.$store.commit("getCurTableId")},methods:{fileChange(e){return/\.(xls|xlsx)$/.test(e.name)?e.raw?void this.importFile(e):this.$message.error("文件导入失败"):this.$message.error("上传格式不正确，请上传xls/xlsx文件格式")},importFile(e){let t=this.curTable;const a=new FileReader;a.readAsArrayBuffer(e.raw),a.onload=a=>{const s=a.target.result,l=p.ij(s,{type:"binary"});l.SheetNames.forEach((a=>{const s=p.P6.sheet_to_json(l.Sheets[a]);if(0==s.length)return;const i={name:a.indexOf("Sheet")<0?a:e.name,data:s,id:Date.now(),column:Object.keys(s[0]),className:"",isCompare:!1,sortObj:this.sortCompare(s)};this.$store.commit("addTable",i),t=i.id})),this.$store.commit("setCurTableId",t)}},sortCompare(e){let t={};return e.forEach((e=>{let a=e["姓名"];for(let s in e)"姓名"!==s&&(t[s]||(t[s]=[]),t[s].push({name:a,score:e[s]}))})),t},onDelete(){this.$store.commit("setCurTableId",null),this.$store.commit("setTables",[])}}},Re=Ie,Ae=(0,r.Z)(Re,u,m,!1,null,"06f50634",null),He=Ae.exports;s["default"].use(h.ZP);const Be=[{path:"/",name:"home",component:He},{path:"/test",name:"test",component:()=>a.e(241).then(a.bind(a,2306))},{path:"/echarts",name:"echarts",component:()=>a.e(338).then(a.bind(a,8522))}],Pe=new h.ZP({routes:Be});var Ke=Pe;s["default"].use(ye.ZP);var Ve=new ye.ZP.Store({state:{tables:[],curTableId:null,subjectMap:re,isShowMenu:!0},getters:{curTable(e){return e.tables.find((t=>t.id==e.curTableId))},subjectObj(e){let t={};return e.subjectMap.forEach((e=>{t[e.name]=e,t[e.name].passScore=.6*(e.fullScore||100),t[e.name].excellentScore=.85*(e.fullScore||100)})),t},subjectList(e){return e.subjectMap.map((e=>e.name))},subjectRankList(e){return e.subjectMap.map((e=>e.rankKey))}},mutations:{getTables(e){e.tables=JSON.parse(localStorage.getItem("tables"))||[]},setTables(e,t){e.tables=t,localStorage.setItem("tables",JSON.stringify(e.tables))},addTable(e,t){e.tables.push(t),localStorage.setItem("tables",JSON.stringify(e.tables))},deleteTable(e,t){e.tables.splice(t,1),localStorage.setItem("tables",JSON.stringify(e.tables))},upMoveTables(e,t){if(0==t)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t-1]),s["default"].set(e.tables,t-1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},downMoveTables(e,t){if(t==e.tables.length-1)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t+1]),s["default"].set(e.tables,t+1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},setCurTableId(e,t){e.curTableId=t,localStorage.setItem("curTableId",t)},getCurTableId(e){e.curTableId=localStorage.getItem("curTableId")},getIsShowMenu(e){e.isShowMenu="false"!=localStorage.getItem("isShowMenu")},setIsShowMenu(e,t){e.isShowMenu=t,localStorage.setItem("isShowMenu",t)}},actions:{},modules:{}}),ze=a(8499),Ze=a.n(ze),Fe=a(3139);s["default"].prototype.$echarts=Fe,s["default"].prototype.$echarts=Fe,s["default"].config.productionTip=!1,s["default"].use(Ze(),{size:"mini"}),new s["default"]({router:Ke,store:Ve,render:e=>e(c)}).$mount("#app")},5234:function(){},3659:function(){}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,a),i.exports}a.m=e,function(){var e=[];a.O=function(t,s,l,i){if(!s){var r=1/0;for(h=0;h<e.length;h++){s=e[h][0],l=e[h][1],i=e[h][2];for(var o=!0,n=0;n<s.length;n++)(!1&i||r>=i)&&Object.keys(a.O).every((function(e){return a.O[e](s[n])}))?s.splice(n--,1):(o=!1,i<r&&(r=i));if(o){e.splice(h--,1);var c=l();void 0!==c&&(t=c)}}return t}i=i||0;for(var h=e.length;h>0&&e[h-1][2]>i;h--)e[h]=e[h-1];e[h]=[s,l,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,s){return a.f[s](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"faf4ed3c",338:"eaa52566"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"4f034e44",338:"06b842a9"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="students-score-analyse:";a.l=function(s,l,i,r){if(e[s])e[s].push(l);else{var o,n;if(void 0!==i)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+i){o=u;break}}o||(n=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",t+i),o.src=s),e[s]=[l];var m=function(t,a){o.onerror=o.onload=null,clearTimeout(d);var l=e[s];if(delete e[s],o.parentNode&&o.parentNode.removeChild(o),l&&l.forEach((function(e){return e(a)})),t)return t(a)},d=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),n&&document.head.appendChild(o)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e=function(e,t,a,s){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css";var i=function(i){if(l.onerror=l.onload=null,"load"===i.type)a();else{var r=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.href||t,n=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");n.code="CSS_CHUNK_LOAD_FAILED",n.type=r,n.request=o,l.parentNode.removeChild(l),s(n)}};return l.onerror=l.onload=i,l.href=t,document.head.appendChild(l),l},t=function(e,t){for(var a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s],i=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(i===e||i===t))return l}var r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){l=r[s],i=l.getAttribute("data-href");if(i===e||i===t)return l}},s=function(s){return new Promise((function(l,i){var r=a.miniCssF(s),o=a.p+r;if(t(r,o))return l();e(s,o,l,i)}))},l={143:0};a.f.miniCss=function(e,t){var a={241:1,338:1};l[e]?t.push(l[e]):0!==l[e]&&a[e]&&t.push(l[e]=s(e).then((function(){l[e]=0}),(function(t){throw delete l[e],t})))}}(),function(){var e={143:0};a.f.j=function(t,s){var l=a.o(e,t)?e[t]:void 0;if(0!==l)if(l)s.push(l[2]);else{var i=new Promise((function(a,s){l=e[t]=[a,s]}));s.push(l[2]=i);var r=a.p+a.u(t),o=new Error,n=function(s){if(a.o(e,t)&&(l=e[t],0!==l&&(e[t]=void 0),l)){var i=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",o.name="ChunkLoadError",o.type=i,o.request=r,l[1](o)}};a.l(r,n,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,s){var l,i,r=s[0],o=s[1],n=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(l in o)a.o(o,l)&&(a.m[l]=o[l]);if(n)var h=n(a)}for(t&&t(s);c<r.length;c++)i=r[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(h)},s=self["webpackChunkstudents_score_analyse"]=self["webpackChunkstudents_score_analyse"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(3280)}));s=a.O(s)})();
//# sourceMappingURL=app.98a5d737.js.map