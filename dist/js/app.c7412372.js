(function(){var e={1997:function(e,t,a){"use strict";var s=a(6369),l=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],i=a(1001),r={},n=(0,i.Z)(r,l,o,!1,null,null,null),c=n.exports,h=a(2631),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Excel"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"",accept:".xls,.xlsx","auto-upload":!1,"show-file-list":!1,"on-change":e.fileChange}},[t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""}},[e._v("上传")])],1),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:function(t){e.compaseDialog.show=!0}}},[e._v(" 进退比较 ")]),t("base-mul-class-analyse-btn",{staticClass:"btn"}),t("base-score-analyse-btn",{staticClass:"btn"}),t("base-mul-sheet-export-btn",{staticClass:"btn"}),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:e.onDelete}},[e._v(" 一键删除 ")])],1),t("div",{staticClass:"right"},[t("base-template-btn"),t("base-setting-btn")],1)]),t("div",{staticClass:"content"},[t("div",{staticClass:"left"},[t("menu-list")],1),t("div",{staticClass:"right"},[e.curTable.column?t("div",["sortTemplate"==e.curTable.template?t("sort-template",{attrs:{tableId:e.curTable.extend.tableId,"table-height":e.tableHeight}}):"studentScoreTemplate"==e.curTable.template?t("student-score-template",{attrs:{selectTablesId:e.curTable.extend.selectTablesId,"table-height":e.tableHeight}}):"totalSortTemplate"==e.curTable.template?t("total-sort-template",{attrs:{classes:e.curTable.extend.classes,"table-height":e.tableHeight}}):t("score-template",{attrs:{tableHeight:e.tableHeight}})],1):e._e()])]),e.compaseDialog.show?t("compase-dialog",{attrs:{tables:e.tables},on:{onClose:function(t){e.compaseDialog.show=!1}}}):e._e()],1)},m=[],d=(a(7658),a(7387)),b=a.n(d),p=a(7092),f=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"compare-dialog",attrs:{visible:e.dialogVisible,title:"比较设置","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:"","label-width":"80px"}},[t("el-form-item",{attrs:{label:"本次成绩",prop:"initTableId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.initTableChange},model:{value:e.formData.initTableId,callback:function(t){e.$set(e.formData,"initTableId",t)},expression:"formData.initTableId"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"上次成绩",prop:"compareTableId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.compareTableChange},model:{value:e.formData.compareTableId,callback:function(t){e.$set(e.formData,"compareTableId",t)},expression:"formData.compareTableId"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("br"),t("el-form-item",{attrs:{label:"基准",prop:"baseTh"}},[t("el-select",{attrs:{placeholder:""},model:{value:e.formData.baseTh,callback:function(t){e.$set(e.formData,"baseTh",t)},expression:"formData.baseTh"}},e._l(e.thList,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1),t("span",{staticClass:"tip"},[e._v(" 请确保基准列数据唯一，比如以【姓名】为基准比较两个表格 ")])],1),t("br"),t("br"),t("el-form-item",{attrs:{label:"比较列",prop:"compareTh"}},[e.formData.initTableId?t("el-checkbox",{attrs:{indeterminate:e.checkData.compareThIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"compareTh")}},model:{value:e.checkData.compareThCheckAll,callback:function(t){e.$set(e.checkData,"compareThCheckAll",t)},expression:"checkData.compareThCheckAll"}},[e._v(" 全选 ")]):e._e(),t("el-checkbox-group",{model:{value:e.formData.compareTh,callback:function(t){e.$set(e.formData,"compareTh",t)},expression:"formData.compareTh"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1),e.compareTableDialog?t("el-dialog",{attrs:{title:"比较列表",width:"90%",visible:e.compareTableDialog,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.compareTableDialog=t}}},[t("base-export-btn",{attrs:{table:e.compareTable,isMultiple:!0}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:e.onAddList}},[e._v(" 添加到列表 ")]),t("base-table",{attrs:{table:e.compareTable}})],1):e._e()],1)},g=[],y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-table"},[t("el-table",{ref:"table",attrs:{data:e.table.data,border:"",stripe:"","highlight-current-row":"",height:e.tableHeight}},[t("el-table-column",{attrs:{fixed:"",label:"序号",type:"index",align:"center"}}),e._l(e.table.column,(function(a){return t("el-table-column",{key:a,attrs:{label:a,prop:a,fixed:a.indexOf("班级")>=0||"姓名"==a,sortable:-1==a.indexOf("班级")&&"姓名"!==a,align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("span",{style:e.scoreStyle(s,a)},[e._v(" "+e._s(e.numHandle(s[a],a))+" ")])]}}],null,!0)})}))],2)],1)},v=[],k={name:"BaseTable",props:{tableHeight:{type:Number,default:500},table:{type:Object,default(){return{}}}},watch:{table(){this.$nextTick((()=>{this.doLayout()}))}},computed:{subjectObj(){return this.$store.getters.subjectObj},subjectRankList(){return this.table.column.filter((e=>/进退|差/.test(e)))}},data(){return{}},methods:{doLayout(){this.$refs.table&&this.$refs.table.doLayout()},numHandle(e,t){return console.log(t),e},scoreStyle(e,t){let{subjectObj:a,subjectRankList:s}=this;if(this.table.isCompare){if(s.includes(t)&&e[t]<0)return{color:"red"}}else if(a[t]&&e[t]<a[t].passScore)return{color:"red"};return{}}}},x=k,T=(0,i.Z)(x,y,v,!1,null,"0a2618da",null),C=T.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseExportBtn"},[e.isExportBtn?t("el-button",{attrs:{type:"primary"},on:{click:e.exportExcelHandle}},[e._v(" 导出 ")]):e._e(),e.isMultiple?t("el-button",{staticClass:"btn",attrs:{type:"success"},on:{click:e.exportMultipleSheetsExcelHandle}},[e._v(" 分科导出 ")]):e._e(),t("el-dialog",{attrs:{top:"20vh",title:"导出",visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"导出名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入导出表格的名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"导出列",prop:"column"}},[t("el-checkbox",{attrs:{indeterminate:e.checkData.showThIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkData.showThCheckAll,callback:function(t){e.$set(e.checkData,"showThCheckAll",t)},expression:"checkData.showThCheckAll"}},[e._v(" 全选 ")]),t("el-checkbox-group",{on:{change:e.handleCheckChange},model:{value:e.formData.column,callback:function(t){e.$set(e.formData,"column",t)},expression:"formData.column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1),t("el-dialog",{attrs:{top:"20vh",title:"分科导出",visible:e.dialogVisibleMul,"append-to-body":!0,"destroy-on-close":!0,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.dialogVisibleMul=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExportMul}},[e._v("导出")]),t("el-form",{ref:"formMul",attrs:{model:e.formDataMul,rules:e.rulesMul,inline:""}},[t("el-table",{attrs:{data:e.formDataMul.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),t("el-table-column",{attrs:{label:"表名",width:"150"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.name}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formDataMul.tables[a].name,callback:function(t){e.$set(e.formDataMul.tables[a],"name",t)},expression:"formDataMul.tables[$index].name"}})],1)]}}])}),t("el-table-column",{attrs:{label:"列名",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.column}},[t("el-checkbox-group",{model:{value:e.formDataMul.tables[a].column,callback:function(t){e.$set(e.formDataMul.tables[a],"column",t)},expression:"formDataMul.tables[$index].column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[a==e.formDataMul.tables.length-1?t("el-button",{attrs:{type:"primary"},on:{click:e.onAddSheet}},[e._v(" 添加 ")]):e._e(),e.formDataMul.tables.length-1?t("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"danger"},on:{click:function(t){return e.onDelectSheet(a)}}},[e._v(" 删除 ")]):e._e()]}}])})],1)],1)],1)],1)},S=[],D=a(5209),w=a.n(D);const $={data(){return{}},computed:{subjectObj(){return this.$store.getters.subjectObj}},methods:{baseExportExcel(e){const t=w().utils.book_new(),a=this.sheetHandle(e);w().utils.book_append_sheet(t,a);const s=e.name.lastIndexOf("."),l=e.name.slice(0,-1==s?99:s);w().writeFile(t,`${l}-${e.className||"班级"}.xlsx`)},baseExportMulSheetExcel(e){let t=!0;const a=w().utils.book_new();e.sheets.forEach((e=>{const s=this.sheetHandle(e);!s&&(t=!1),w().utils.book_append_sheet(a,s,e.name)})),t&&w().writeFile(a,`${e.name}.xlsx`)},sheetHandle(e){try{const t=w().utils.json_to_sheet(e.data);e?.sheet?.cols&&(t["!cols"]=e.sheet.cols),e?.sheet?.rows&&(t["!rows"]=e.sheet.rows);const a=e.column.length,s=e.column.filter((e=>/进退|差/.test(e)));return Object.keys(t).forEach(((l,o)=>{l.indexOf("!")<0&&(t[l].s={alignment:{vertical:"center",horizontal:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},font:{name:"宋体",sz:10}},this.textColorHandle(e.column[o%a],t[l],s.length,s))})),t}catch(t){return this.$message.error("啊欧，数据出错，导出失败"),!1}},textColorHandle(e,t,a,s){try{const l=t.v;a?s.includes(e)&&l<0&&(t.s.font.color={rgb:"FF0000"}):this.subjectObj[e]&&l<this.subjectObj[e].passScore&&(t.s.font.color={rgb:"FF0000"})}catch(l){console.log(l),this.$message.error("样式错误，导出失败")}}}};var _=$,j={name:"BaseExportBtn",components:{},mixins:[_],props:{table:{type:Object,default(){return{}}},isExportBtn:{type:Boolean,default:!0},isMultiple:{type:Boolean,default:!1}},computed:{thList(){return this.table.column||Object.keys(this.table.data[0])},subjectList(){return this.$store.getters.subjectList}},data(){return{dialogVisible:!1,formData:{name:"",column:[]},checkData:{showThCheckAll:!0,showThIndeterminate:!1},rules:{name:[{required:!0,message:"请输入"}],column:[{required:!0,message:"请选择"}]},dialogVisibleMul:!1,rulesMul:{},formDataMul:{tables:[]}}},methods:{handleCheckAllChange(e){this.formData.column=e?this.thList:[],this.checkData.showThIndeterminate=!1},handleCheckChange(e){let t=e.length;this.checkData.showThCheckAll=t===this.thList.length,this.checkData.showThIndeterminate=t>0&&t<this.thList.length},exportExcelHandle(){this.formData.name=this.table.name,this.formData.column=this.thList,this.dialogVisible=!0},onAddSheet(e={}){this.formDataMul.tables.push({id:Date.now(),name:e.name||"",column:e.column||[],data:[],isCompare:!0})},onDelectSheet(e){this.formDataMul.tables.splice(e,1)},exportMultipleSheetsExcelHandle(){this.dialogVisibleMul=!0,this.formDataMul.tables=[],this.thList.forEach((e=>{if(this.subjectList.includes(e)){let t={name:`${e}${this.table.isCompare?"进退分析":""}`,column:["姓名","班级",e]};this.thList.includes(this.subjectObj[e].rankKey)&&t.column.push(this.subjectObj[e].rankKey),this.thList.includes(`${this.subjectObj[e].rankKey}进退`)&&t.column.push(`${this.subjectObj[e].rankKey}进退`),this.thList.includes(`${this.subjectObj[e].rankKey}差`)&&t.column.push(`${this.subjectObj[e].rankKey}差`),["折总","折算名"].forEach((e=>{this.thList.includes(e)&&t.column.push(e)})),this.onAddSheet(t)}}))},async onExport(){await this.$refs.form.validate();let e=[];this.table.data.forEach((t=>{let a={};for(let e in t)this.formData.column.includes(e)&&(a[e]=t[e]);e.push(a)})),this.baseExportExcel({...this.table,data:e,column:this.formData.column,name:this.formData.name},!0),this.$message.warning("正在导出"),this.dialogVisible=!1},async onExportMul(){try{await this.$refs.formMul.validate(),this.formDataMul.tables.forEach((e=>e.data=[])),this.table.data.forEach((e=>{this.formDataMul.tables.forEach((t=>{let a={};for(let s in e)t.column.includes(s)&&(a[s]=e[s]);t.data.push(a)}))}));const e={name:`${this.table.name}-分科`,sheets:this.formDataMul.tables};this.baseExportMulSheetExcel(e),this.$message.warning("正在导出"),this.dialogVisibleMul=!1}catch(e){console.log(e)}}}},I=j,E=(0,i.Z)(I,N,S,!1,null,"24ec980b",null),L=E.exports,R=a(3767),O=a(3822);const A=[{name:"语文",key:"chinese",type:1,fullScore:150,scoreKey:"语文",rankKey:"语名"},{name:"数学",key:"mathematics",type:2,fullScore:150,scoreKey:"数学",rankKey:"数名"},{name:"英语",key:"english",type:3,fullScore:150,scoreKey:"英语",rankKey:"英名"},{name:"物理",key:"physical",type:4,fullScore:100,scoreKey:"物理",rankKey:"物名"},{name:"化学",key:"chemical",type:5,fullScore:100,scoreKey:"化学",rankKey:"化名"},{name:"政治",key:"political",type:6,fullScore:100,scoreKey:"政治",rankKey:"政名"},{name:"历史",key:"history",type:7,fullScore:100,scoreKey:"历史",rankKey:"历名"},{name:"生物",key:"biological",type:8,fullScore:100,scoreKey:"生物",rankKey:"生名"},{name:"地理",key:"geographic",type:9,fullScore:100,scoreKey:"地理",rankKey:"地名"}],M=[{label:"1班",value:"1班",bgColor:"#d32525"},{label:"2班",value:"2班",bgColor:"#0085ff"},{label:"3班",value:"3班",bgColor:"#9361dd"},{label:"4班",value:"4班",bgColor:"#d8810b"},{label:"5班",value:"5班",bgColor:"#5ed80b"},{label:"6班",value:"6班",bgColor:"#cf3576"},{label:"7班",value:"7班",bgColor:"#49d4a5"},{label:"8班",value:"8班",bgColor:"#957e62"},{label:"9班",value:"9班",bgColor:"#3939fa"},{label:"10班",value:"10班",bgColor:"#cc66ad"},{label:"11班",value:"11班",bgColor:"#78a8dd"},{label:"12班",value:"12班",bgColor:"#b1ba13"},{label:"13班",value:"13班",bgColor:"#ff00eb"},{label:"14班",value:"14班",bgColor:"#9fb7cc"},{label:"年段",value:"年段",bgColor:"#8b0000"}];s["default"].use(O.ZP);var B=new O.ZP.Store({state:{tables:[],curTableId:null,subjectMap:A,isShowMenu:!0,defaultClassName:"",downloadSetting:{}},getters:{curTable(e){return e.tables.find((t=>t.id==e.curTableId))},curIndex(e){let t=null;return e.tables.find(((a,s)=>{if(a.id==e.curTableId)return t=s,!0})),t},subjectObj(e){let t={};return e.subjectMap.forEach((e=>{t[e.name]=e,t[e.name].passScore=.6*(e.fullScore||100),t[e.name].excellentScore=.85*(e.fullScore||100)})),t},subjectList(e){return e.subjectMap.map((e=>e.name))},subjectRankList(e){return e.subjectMap.map((e=>e.rankKey))}},mutations:{getTables(e){e.tables=JSON.parse(localStorage.getItem("tables"))||[]},setTables(e,t){e.tables=t,localStorage.setItem("tables",JSON.stringify(e.tables))},addTable(e,t){e.tables.push(t),localStorage.setItem("tables",JSON.stringify(e.tables))},deleteTable(e,t){null!=t&&(e.tables.splice(t,1),localStorage.setItem("tables",JSON.stringify(e.tables)))},upMoveTables(e,t){if(0==t)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t-1]),s["default"].set(e.tables,t-1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},downMoveTables(e,t){if(t==e.tables.length-1)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t+1]),s["default"].set(e.tables,t+1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},setCurTableId(e,t){e.curTableId=t,localStorage.setItem("curTableId",t)},getCurTableId(e){e.curTableId=localStorage.getItem("curTableId")},getIsShowMenu(e){e.isShowMenu="false"!=localStorage.getItem("isShowMenu")},setIsShowMenu(e,t){e.isShowMenu=t,localStorage.setItem("isShowMenu",t)},getDefaultClassName(e){e.defaultClassName=localStorage.getItem("defaultClassName")||""},setDefaultClassName(e,t){e.defaultClassName=t,localStorage.setItem("defaultClassName",t)},getDownloadSetting(e){const t=localStorage.getItem("downloadSetting");e.downloadSetting=t?JSON.parse(t):null},setDownloadSetting(e,t){e.downloadSetting=t,localStorage.setItem("downloadSetting",JSON.stringify(t))}},actions:{},modules:{}}),H=a(8499),K=a.n(H);const P=(e=[])=>{const t=Array.from(new Set(e));return e.length!==t.length},V=(e=[])=>{for(let t=0;t<e.length;t++)e[t]=e[t]||0},z=(...e)=>{V(e);const t=R.ZP.minus.apply(null,e);return Z(t)},Z=e=>{let t=e.toString().split(".")[1]?.length||0;return t>6&&(t=6),F(e,t)},F=R.ZP.round,q=()=>{H.MessageBox.alert("未找到原始表格，无法分析数据，请删除该表重新分析","提示",{confirmButtonText:"删除",callback:()=>{B.commit("deleteTable",B.getters.curIndex),B.commit("setCurTableId",null)}})};var J={name:"CompareDialog",components:{BaseTable:C,BaseExportBtn:L},mixins:[_],props:{tables:{type:Array,default(){return[]}}},data(){return{formData:{initTableId:null,compareTableId:null,baseTh:"",compareTh:[]},checkData:{showThCheckAll:!1,showThIndeterminate:!1,compareThCheckAll:!1,compareThIndeterminate:!1},initTable:null,preTable:null,rules:{initTableId:[{required:!0,message:"请选择"}],compareTableId:[{required:!0,message:"请选择"}],baseTh:[{required:!0,message:"请选择"}],compareTh:[{required:!0,message:"请选择"}]},thList:[],dialogVisible:!1,compareTableDialog:!1,compareTable:{}}},created(){this.dialogVisible=!0},methods:{handleCheckAllChange(e,t){this.formData[t]=e?this.thList:[],this.checkData[`${t}Indeterminate`]=!1},handleCheckChange(e,t){let a=e.length;this.checkData[`${t}CheckAll`]=a===this.thList.length,this.checkData[`${t}Indeterminate`]=a>0&&a<this.thList.length},initTableChange(e){e==this.formData.compareTableId&&this.$message.error("比较的是同一张表格，请确认"),this.initTable=this.tables.find((t=>t.id==e)),this.thList=Object.keys(this.initTable.data[0]),this.formData.compareTh=this.thList.filter((e=>"姓名"!==e&&e.indexOf("名")>0)),this.formData.baseTh=this.thList.find((e=>"姓名"==e))||this.thList[0]},compareTableChange(e){e==this.formData.initTableId&&this.$message.error("比较的是同一张表格，请确认"),this.preTable=this.tables.find((t=>t.id==e))},async onSave(){if(await this.$refs.form.validate(),P(this.initTable.data.map((e=>e[this.formData.baseTh]))))return this.$message.error(`本次成绩【${this.formData.baseTh}】基准列存在重复值，请修改`),!1;if(!this.preTable.column.includes(this.formData.baseTh))return this.$message.error(`上次成绩无【${this.formData.baseTh}】基准列，请重新选择`),!1;let e=this.formData.compareTh.find((e=>!this.preTable.column.includes(e)));if(e)return this.$message.error(`上次成绩里无【${e}】列，无法进行比较，请重新选择`),!1;let t=[],a=JSON.parse(JSON.stringify(this.preTable.data)),s=a.length;this.initTable.data.forEach((e=>{let l=!1;for(let o=0;o<s;o++)if(e[this.formData.baseTh]==a[o][this.formData.baseTh]){l=!0;let i={};for(let t in e)i[t]=e[t],e[t]&&a[o][t]&&this.formData.compareTh.includes(t)&&!isNaN(e[t])&&(i[`${t}进退`]=z(e[t],a[o][t]),t.indexOf("名")>0&&(i[`${t}进退`]=0-i[`${t}进退`]));a.splice(o,1),t.push(i),s--;break}l||(this.formData.compareTh.forEach((t=>e[`${t}进退`]="")),t.push(e))}));const l=Object.keys(t[0]);a.forEach((e=>{let a={};l.forEach((t=>{e[t]&&isNaN(e[t])?a[t]=e[t]:a[t]=""})),t.push(a)}));let o={name:`${this.initTable.name}-${this.initTable.className}-进退比较`,data:t,id:Date.now(),column:l,className:`${this.initTable.className}`,isCompare:!0,extend:{compareColumn:this.formData.compareTh,preTable:this.preTable}};this.compareTable=o,this.compareTableDialog=!0},onAddList(){this.$store.commit("addTable",this.compareTable),this.$store.commit("setCurTableId",this.compareTable.id),this.onClose()},onClose(){this.$emit("onClose")}}},U=J,W=(0,i.Z)(U,f,g,!1,null,"59c6deec",null),G=W.exports,Q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseTemplateBtn"},[t("el-button",{attrs:{type:"success",size:"small",plain:""},on:{click:function(t){e.dialogVisiable=!e.dialogVisiable}}},[e._v(" 模板 ")]),t("el-dialog",{attrs:{title:"模板",visible:e.dialogVisiable,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),t("table",{staticClass:"table",attrs:{border:""}},[t("tr",e._l(e.table.column,(function(a){return t("th",{key:a},[e._v(e._s(a))])})),0),e._l(e.table.data.length,(function(a){return t("tr",{key:a},e._l(e.table.column,(function(e){return t("td",{key:e})})),0)}))],2)],1)],1)},X=[],Y={name:"BaseTemplateBtn",mixins:[_],data(){return{dialogVisiable:!1,table:{id:Date.now(),name:"模板",column:[],data:[]}}},computed:{subjectMap(){return this.$store.state.subjectMap}},created(){this.table.column=this.subjectMap.reduce(((e,t)=>(e.push(t.scoreKey),e.push(t.rankKey),e)),["班级","姓名"]),this.table.column.push("总分","段名","折总","折算名");for(let e=0;e<3;e++){const e={};this.table.column.forEach((t=>e[t]="")),this.table.data.push(e)}},methods:{onExport(){this.baseExportExcel(this.table)}}},ee=Y,te=(0,i.Z)(ee,Q,X,!1,null,"2f7b454a",null),ae=te.exports,se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sortTemplate"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.subjectName,callback:function(t){e.subjectName=t},expression:"subjectName"}},e._l(e.subjectList,(function(e){return t("el-tab-pane",{key:e,attrs:{label:e,name:e}})})),1),t("div",{staticClass:"btns"},[t("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),e.isDialog?t("el-button",{staticClass:"btn",attrs:{type:"danger"},on:{click:e.onAddTable}},[e._v(" 添加到列表 ")]):e._e(),t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1)],1),e.sortObj?t("div",[t("el-table",{directives:[{name:"show",rawName:"v-show",value:1==e.radio,expression:"radio == 1"}],attrs:{data:e.sortList,border:"",height:e.tableHeight}},[t("el-table-column",{attrs:{label:e.subjectName,prop:"label",width:"100",align:"center"}}),t("el-table-column",{attrs:{label:e.baseTable.className},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e._v(" "+e._s(e.sortObj[a.key])+" "),e.isShowName&&a.listKey?t("span",[e._v(" ："+e._s(e._f("toList")(e.sortObj[a.listKey]))+" ")]):e._e()]}}],null,!1,471819297)})],1),2==e.radio?t("div",[t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"270px"},attrs:{id:"sortScoreName"}}),e._m(0),e._m(1)]):e._e()],1):t("div",{staticClass:"tip"},[e._v("未找到【"+e._s(e.subjectName)+"】数据")])],1)},le=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"250px"},attrs:{id:"scoreRegion"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"250px"},attrs:{id:"rangRegion"}})])},function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"pass"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"excellent"}})])}],oe={name:"sortTemplate",mixins:[_],props:{tableId:{type:Number,require:!0},tableHeight:{type:Number,default:450},isDialog:{type:Boolean,default:!1},isTotal:{type:Boolean,default:!1}},computed:{...(0,O.rn)({tables:e=>e.tables,isShowMenu:e=>e.isShowMenu}),...(0,O.Se)(["subjectList","subjectObj","curIndex"])},watch:{isShowMenu(){this.echartsResize()}},data(){return{radio:1,subConfig:{},is150:!1,subjectName:"",baseTable:[],sortList:{},scoreRegionList:[],otherList:[{label:"最高分",value:0,key:"maxScore",listKey:"maxScoreList"},{label:"最低分",value:0,key:"minScore",listKey:"minScoreList"},{label:"不及格数",value:0,key:"noPassNum",listKey:"noPass"},{label:"及格数",value:0,key:"passNum",listKey:"pass"},{label:"及格率%",value:0,key:"passRate"},{label:"优秀数",value:0,key:"excellentNum",listKey:"excellent"},{label:"优秀率%",value:0,key:"excellentRate"},{label:"与考人数",value:0,key:"peopleNum"}],rangRegionList:[],averageList:[{label:"平均分",value:0,key:"average"},{label:"均分人数",value:0,key:"averageNum",listKey:"averageList"}],sortObj:null,isTable:!0,isShowName:!1,echarts:{sortScoreName:null,scoreRegion:null,rangRegion:null,pass:null,excellent:null}}},filters:{toList(e){if(e)return Array.isArray(e)?e.map((e=>e.name)).join("、"):e.name||""}},created(){this.subjectName=this.subjectList[0],this.getTables()},destroyed(){this.destroyedEchart()},methods:{getTables(){this.curIndex;let e=this.tables.find((e=>e.id==this.tableId));if(!e)return this.isTable=!1,q(),!1;this.baseTable=e,this.getRowName()},getRowName(){if(!this.isTable)return!1;this.subConfig=this.subjectObj[this.subjectName],this.is150=150==this.subConfig.fullScore,this.scoreRegionList=this.getScoreRegionList(),this.rangRegionList=this.getRangRegionList(),this.sortList=[...this.scoreRegionList,...this.otherList,...this.rangRegionList,...this.averageList],this.init()},getScoreRegionList(){let e=[];for(let t=14;t>=0;t--){let a=10*t,s=a+9;e.push({label:`${a}-${s}`,value:0,key:`score${a}to${s}Num`,listKey:`score${a}to${s}`})}return this.is150?e[0].label="140-150":(e.splice(0,5),e[0].label="90-100"),e},getRangRegionList(){let e=[{label:"前10名",value:0,key:"top10Num",isAdd:!0}];for(let t=50;t<=400;t+=50)e.push({label:`前${t}名`,value:0,key:`top${t}Num`,listKey:`top${t}`,isAdd:!0});return e.push({label:"400名后",value:0,key:"otherTopNum",listKey:"otherTop"}),e},init(){this.sortObj=this.classDataHandle(this.baseTable),this.typeChangeHandle()},classDataHandle(e=this.baseTable){const t=e.sortObj[this.subConfig.scoreKey],a=e.sortObj[this.subConfig.rankKey];if(!t||!a)return null;this.scoreList=t.sort(((e,t)=>t.score-e.score));let s={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,maxScore:0,maxScoreList:[],minScore:0,minScoreList:[],pass:[],passNum:0,noPass:[],noPassNum:0,passRate:0,excellent:[],excellentNum:0,excellentRate:0,peopleNum:t.length,top10:[],top50:[],top100:[],top150:[],top200:[],top250:[],top300:[],top350:[],top400:[],otherTop:[],average:0,averageList:[],averageNum:0},l=0,o=.6*this.subConfig.fullScore,i=.85*this.subConfig.fullScore;t.forEach((e=>{const t=isNaN(e.score)?0:parseFloat(e.score);this.getScoreRange(e,s),l+=t,t>s.maxScore&&(s.maxScore=t,s.maxScoreList=[e]),t<s.minScore&&(s.minScore=t,s.minScoreList=[e]),t>=o?s.pass.push(e):s.noPass.push(e),t>=i&&s.excellent.push(e)})),s.passNum=s.pass.length,s.noPassNum=s.noPass.length,s.passRate=(s.passNum/s.peopleNum*100).toFixed(2),s.excellentNum=s.excellent.length,s.excellentRate=(s.excellentNum/s.peopleNum*100).toFixed(2),s.average=(l/s.peopleNum).toFixed(2),t.forEach((e=>{e.score>=s.average&&s.averageList.push(e)})),s.averageNum=s.averageList.length,a.forEach((e=>{e.score>0&&e.score<=10?s.top10.push(e):e.score>10&&e.score<=50?s.top50.push(e):e.score>50&&e.score<=100?s.top100.push(e):e.score>100&&e.score<=150?s.top150.push(e):e.score>150&&e.score<=200?s.top200.push(e):e.score>200&&e.score<=250?s.top250.push(e):e.score>250&&e.score<=300?s.top300.push(e):e.score>300&&e.score<=350?s.top350.push(e):e.score>350&&e.score<=400?s.top400.push(e):s.otherTop.push(e)}));let r=[10,50,100,150,200,250,300,350,400];return r.forEach(((e,t)=>{s[`top${e}Num`]=s[`top${e}`].length+(s[`top${r[t-1]}Num`]||0)})),s.otherTopNum=s.otherTop.length,s},getScoreRange(e,t){let a=10*parseInt(e.score/10);this.is150||10!=a||(a=9),this.is150&&15==a&&(a=14);let s=a+9;t[`score${a}to${s}`]||(t[`score${a}to${s}`]=[]),t[`score${a}to${s}`].push(e),t[`score${a}to${s}Num`]=t[`score${a}to${s}`].length},getTotalData(e){let t={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,passNum:0,noPassNum:0,passRate:0,excellentNum:0,excellentRate:0,peopleNum:0,top10Num:0,top50Num:0,top100Num:0,top150Num:0,top200Num:0,top250Num:0,top300Num:0,top350Num:0,top400Num:0,otherTopNum:0,average:0,averageNum:0},a=0,s=0,l=0;for(let o in e){a++;for(let a in t)t[a]+=parseFloat(e[o][a])||0;s<e[o].maxScore&&(s=e[o].maxScore),l>e[o].minScore&&(l=e[o].minScore)}t.maxScore=s,t.minScore=l,["passRate","excellentRate","average"].forEach((e=>{t[e]=(t[e]/a).toFixed(2)})),e.all=t},handleClick(){this.getRowName()},onExport(){const e=this.tableHandle();this.baseExportExcel(e)},onAddTable(){const e={id:Date.now(),column:[],name:`${this.baseTable.name}-${this.isTotal?"年段":"科目"}分析表`,className:this.isTotal?"年段":this.baseTable.className,isCompare:!1,template:"sortTemplate",extend:{tableId:this.tableId}};this.$store.commit("addTable",e),this.$store.commit("setCurTableId",e.id),this.$emit("onAddTable")},tableHandle(){const e=[];this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((t=>{if("TR"!==t.tagName)return;let a={},s=t.childNodes[0].textContent;s!=this.subjectName&&(a[this.subjectName]=s,a[this.baseTable.className]=t.childNodes[1].textContent.trim(),e.push(a))}));const t={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.baseTable.name}-${this.subjectName}-科目分析表`,className:this.isTotal?"年段":this.baseTable.className,isCompare:!1,template:"sortTemplate"};return t},echartInit(){this.$nextTick((()=>{this.echartsScoreNameInit(),this.echartsScoreRegionInit(),this.echartsRangRegionInit(),this.echartsPassInit(),this.echartsexcellentInit()}))},typeChangeHandle(){this.sortObj?1==this.radio?this.destroyedEchart():this.echartInit():this.destroyedEchart()},echartsScoreNameInit(){this.echarts.sortScoreName=this.$echarts.init(document.getElementById("sortScoreName"));const e=this,t={title:{text:"成绩排序表"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"姓名",type:"category",data:this.scoreList.map((e=>e.name)),axisLabel:{interval:0,rotate:45}},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:[{name:"分数",data:this.scoreList.map((e=>e.score)),type:"line",markPoint:{data:[{type:"max",name:"最高分"},{type:"min",name:"最低分"}]},markLine:{data:[{type:"average",name:"平均分"}],label:{formatter(t){return`${t.name}：${t.value}\n均分人数：${e.sortObj.averageNum}`}}}}]};this.echarts.sortScoreName.setOption(t)},echartsScoreRegionInit(){this.echarts.scoreRegion=this.$echarts.init(document.getElementById("scoreRegion"));const e={title:{text:"成绩分析表"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{true:!1},xAxis:{name:"分数",type:"category",data:this.scoreRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:20}},yAxis:{name:"人数",type:"value"},series:[{name:"人数",data:this.scoreRegionList.map((e=>this.sortObj[e.key])),type:"bar",label:{show:!0},showBackground:!0,backgroundStyle:{color:"rgba(220, 220, 220, 0.8)"}}]};this.echarts.scoreRegion.setOption(e)},echartsRangRegionInit(){this.echarts.rangRegion=this.$echarts.init(document.getElementById("rangRegion"));const e={title:{text:"名次分析表"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{name:"名次",type:"category",data:this.rangRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:0}},yAxis:{name:"人数",type:"value"},series:[{name:"人数",data:this.rangRegionList.map((e=>this.sortObj[e.key])),type:"bar",label:{show:!0},showBackground:!0,backgroundStyle:{color:"rgba(220, 220, 220, 0.8)"}}]};this.echarts.rangRegion.setOption(e)},echartsPassInit(){this.echarts.pass=this.$echarts.init(document.getElementById("pass"));let e={title:{text:"及格率"},tooltip:{trigger:"item"},series:[{name:"人数",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!0,position:"inside",formatter:"{d}%"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:this.sortObj.passNum,name:"及格数"},{value:this.sortObj.noPassNum,name:"不及格数"}]}],legend:{show:!0,zlevel:0,z:2,left:"center",formatter(t){const a="及格数"==t?e.series[0].data[0].value:e.series[0].data[1].value;return`${t}：${a}`}}};this.echarts.pass.setOption(e)},echartsexcellentInit(){this.echarts.excellent=this.$echarts.init(document.getElementById("excellent"));const e={title:{text:"优秀率"},tooltip:{trigger:"item"},series:[{name:"人数",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!0,position:"inside",formatter:"{d}%"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:this.sortObj.excellentNum,name:"优秀数"},{value:this.sortObj.peopleNum-this.sortObj.excellentNum,name:"其他"}]}],legend:{show:!0,zlevel:0,z:2,left:"center",formatter(t){const a="优秀数"==t?e.series[0].data[0].value:e.series[0].data[1].value;return`${t}：${a}`}}};this.echarts.excellent.setOption(e)},destroyedEchart(){for(let e in this.echarts)this.echarts[e]&&this.echarts[e].dispose()},echartsResize(){setTimeout((()=>{for(let e in this.echarts)this.echarts[e]&&this.echarts[e].resize()}),500)}}},ie=oe,re=(0,i.Z)(ie,se,le,!1,null,"72f90af9",null),ne=re.exports,ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scoreTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("base-class-setting",{ref:"setting",model:{value:e.curTable.className,callback:function(t){e.$set(e.curTable,"className",t)},expression:"curTable.className"}}),e.curTable.sortObj?[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 科目差值：折算名/段名 - 科目名 "),t("br"),e._v(" 优势科目：科目差值 > 50 "),t("br"),e._v(" 劣势科目：科目差值 < -50 ")]),t("el-button",{attrs:{type:"success",plain:""},on:{click:function(t){e.rankCompareDialog.show=!0}}},[e._v(" 优劣分析 ")])],1),t("el-button",{staticClass:"btn",attrs:{plain:"",type:"primary",size:"small"},on:{click:e.openSortDialog}},[e._v(" 科目分析 ")])]:e._e()],2),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1),t("base-export-btn",{attrs:{table:e.curTable,isExportBtn:!1,isMultiple:!0}})],1)]),2==e.radio?t("div",{staticClass:"echarts"},[t("el-checkbox-group",{staticClass:"nameCheck",attrs:{min:1},on:{change:e.nameCheckChange},model:{value:e.nameCheck,callback:function(t){e.nameCheck=t},expression:"nameCheck"}},e._l(e.nameList,(function(e){return t("el-checkbox",{key:e,staticStyle:{width:"70px"},attrs:{label:e,value:e}})})),1),e._m(0),e.isPreCompare?t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"250px"},attrs:{id:"compare"}}):e._e()],1):t("base-table",{ref:"baseTable",attrs:{"table-height":e.tableHeight,table:e.curTable}}),e.sortCompareDialog.show?t("sort-dialog",{attrs:{curTable:e.curTable},on:{onClose:function(t){e.sortCompareDialog.show=!1}}}):e._e(),e.rankCompareDialog.show?t("rank-compare-dialog",{attrs:{curTable:e.curTable},on:{onClose:function(t){e.rankCompareDialog.show=!1}}}):e._e()],1)},he=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"scoreName"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"rankName"}})])}],ue=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-class-setting"},[t("el-form",{ref:"form",attrs:{model:e.formData,inline:"","label-position":"left",rules:e.rules}},[t("el-form-item",{attrs:{label:e.label,prop:"className"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.changeHandle},model:{value:e.formData.className,callback:function(t){e.$set(e.formData,"className",t)},expression:"formData.className"}},e._l(e.classMap,(function(e){return t("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)],1)],1)],1)},me=[],de={name:"BaseClassSetting",props:{value:{type:String,default:""},label:{type:String,default:"班级"}},computed:{tables(){return this.$store.state.tables}},watch:{value:{handler(e){this.formData.className=e||""},immediate:!0}},data(){return{classMap:M,formData:{className:""},rules:{className:[{required:!0,message:"请设置班级"}]}}},methods:{changeHandle(e){this.$emit("input",e),this.$store.commit("setTables",this.tables)},async validate(){return await this.$refs.form.validate()}}},be=de,pe=(0,i.Z)(be,ue,me,!1,null,"20d5425c",null),fe=pe.exports,ge=function(){var e=this,t=e._self._c;return e.dialogVisible?t("el-dialog",{staticClass:"sort-dialog",attrs:{visible:e.dialogVisible,title:"科目分析",width:"80%",top:"5vh","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("sort-template",{attrs:{tableId:e.curTable.id,isDialog:!0},on:{onAddTable:e.onClose}})],1):e._e()},ye=[],ve={name:"SortDialog",components:{SortTemplate:ne},mixins:[_],props:{curTable:{type:Object,require:!0}},data(){return{dialogVisible:!1}},created(){this.dialogVisible=!0},computed:{},methods:{onClose(){this.$emit("onClose")}}},ke=ve,xe=(0,i.Z)(ke,ge,ye,!1,null,"c245a7f8",null),Te=xe.exports,Ce=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"compare-dialog",attrs:{visible:e.dialogVisible,title:"名次比较设置","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:"","label-width":"80px"}},[t("el-form-item",{attrs:{label:"比较列",prop:"compareTh"}},[t("el-checkbox",{attrs:{indeterminate:e.checkData.compareThIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"compareTh")}},model:{value:e.checkData.compareThCheckAll,callback:function(t){e.$set(e.checkData,"compareThCheckAll",t)},expression:"checkData.compareThCheckAll"}},[e._v(" 全选 ")]),t("el-checkbox-group",{model:{value:e.formData.compareTh,callback:function(t){e.$set(e.formData,"compareTh",t)},expression:"formData.compareTh"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1),e.compareTableDialog?t("el-dialog",{attrs:{title:"比较列表",width:"90%",visible:e.compareTableDialog,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.compareTableDialog=t}}},[t("base-export-btn",{attrs:{table:e.compareTable,isMultiple:!0}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:e.onAddList}},[e._v(" 添加到列表 ")]),t("base-table",{attrs:{table:e.compareTable}})],1):e._e()],1)},Ne=[],Se={name:"CompareDialog",components:{BaseTable:C,BaseExportBtn:L},mixins:[_],props:{curTable:{type:Object,default(){return{}}}},data(){return{formData:{compareTh:[]},checkData:{compareThCheckAll:!1,compareThIndeterminate:!1},rules:{compareTh:[{required:!0,message:"请选择"}]},dialogVisible:!1,compareTableDialog:!1,compareTable:{}}},computed:{tables(){return this.$store.state.tables},subjectRankList(){return this.$store.getters.subjectRankList},thList(){return this.curTable.column}},created(){this.getBaseTable()},methods:{getBaseTable(){this.curTable.column.forEach((e=>{this.subjectRankList.includes(e)&&this.formData.compareTh.push(e)})),this.thList.includes("段名")&&this.formData.compareTh.push("段名"),this.dialogVisible=!0},handleCheckAllChange(e,t){this.formData[t]=e?this.thList:[],this.checkData[`${t}Indeterminate`]=!1},handleCheckChange(e,t){let a=e.length;this.checkData[`${t}CheckAll`]=a===this.thList.length,this.checkData[`${t}Indeterminate`]=a>0&&a<this.thList.length},async onSave(){await this.$refs.form.validate();let e=[];this.curTable.data.forEach((t=>{let a={},s=[],l=[],o=t["折算名"]||t["段名"]||null;for(let e in t)if(a[e]=t[e],t[e]&&this.formData.compareTh.includes(e)&&o&&!isNaN(t[e])){let i=z(o,t[e]);a[`${e.substr(0,1)}差`]=i,i>50?s.push(e):i<-50&&l.push(e)}a["优势"]=s.join("、"),a["劣势"]=l.join("、"),e.push(a)}));const t=Object.keys(e[0]);let a={name:`${this.curTable.name}-优劣分析`,data:e,id:Date.now(),column:t,className:`${this.curTable.className}`,isCompare:!0};this.compareTable=a,this.compareTableDialog=!0},onAddList(){this.$store.commit("addTable",this.compareTable),this.$store.commit("setCurTableId",this.compareTable.id),this.onClose()},onClose(){this.$emit("onClose")}}},De=Se,we=(0,i.Z)(De,Ce,Ne,!1,null,"c67449c2",null),$e=we.exports,_e={name:"ScoreTemplate",components:{BaseClassSetting:fe,BaseTable:C,SortDialog:Te,BaseExportBtn:L,RankCompareDialog:$e},props:{tableHeight:{type:Number,default:500}},data(){return{sortCompareDialog:{show:!1},rankCompareDialog:{show:!1},nameList:[],nameListObj:{},preNameListObj:{},radio:1,nameCheck:[],echartsScoreName:null,echartsRankName:null,echartsCompare:null,xAxisData:[],xAxisRankData:[],contentHeight:300}},computed:{...(0,O.rn)({tables:e=>e.tables,subjectMap:e=>e.subjectMap,isShowMenu:e=>e.isShowMenu}),...(0,O.Se)(["curTable","subjectList","subjectRankList"]),isPreCompare(){return this.curTable.isCompare&&this.curTable?.extend?.compareColumn}},watch:{"curTable.id":{handler(){this.dataInitHandle(),this.typeChangeHandle()},immediate:!0},isShowMenu(){this.echartsResize()}},mounted(){this.contentHeight=this.tableHeight-this.$el.childNodes[0].offsetHeight+50},destroyed(){this.destroyedEchart()},methods:{dataInitHandle(){this.nameCheck=[this.curTable.data[0]["姓名"]];let e={},t=[],a=[],s=[];this.curTable.data.forEach((a=>{let s=a["姓名"];e[s]=a,t.push(s)})),this.nameList=t,this.nameListObj=e,this.curTable.column.forEach((e=>{this.subjectList.includes(e)&&a.push(e)})),this.curTable.column.forEach((e=>{this.subjectRankList.includes(e)&&s.push(e)})),s.push("段名"),this.xAxisData=a,this.xAxisRankData=s,this.isPreCompare&&this.compareInitHandle()},compareInitHandle(){(this.curTable?.extend?.preTable.data||[]).forEach((e=>{this.preNameListObj[e["姓名"]]=e}))},async openSortDialog(){try{await this.$refs.setting.validate(),this.sortCompareDialog.show=!0}catch(e){console.log(e),this.$message.error("请先设置班级")}},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},destroyedEchart(){["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].dispose()}))},echartsResize(){setTimeout((()=>{["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].resize()}))}),500)},echartInit(){this.$nextTick((()=>{this.echartsScoreInit(),this.echartsRankInit(),this.echartsCompareInit()}))},nameCheckChange(e){this.nameCheck=e.splice(1,1);const t=this.getSeries();if(this.echartsScoreName.setOption({series:t.score}),this.echartsRankName.setOption({series:t.rank}),this.isPreCompare){const{series:e}=this.getCompaseConfig();this.echartsCompare.setOption({series:e})}},getSeries(){let e={score:[],rank:[]};return this.nameCheck.forEach((t=>{let a={name:this.curTable.name,type:"line",label:{show:!0},data:[]},s={name:this.curTable.name,type:"line",label:{show:!0},data:[]},l=this.nameListObj[t];this.xAxisData.forEach((e=>{a.data.push(l[e])})),this.xAxisRankData.forEach((e=>{s.data.push(l[e])})),l["折算名"]?s.markLine={data:[{name:"折算名",yAxis:l["折算名"]}]}:l["段名"]&&(s.markLine={data:[{name:"段名",yAxis:l["段名"]}]}),s.markLine&&(s.markLine.label={show:!0,formatter:"{b}:{c}"}),e.score.push(a),e.rank.push(s)})),e},echartsScoreInit(){let{score:e}=this.getSeries();this.echartsScoreName=this.$echarts.init(document.getElementById("scoreName"));const t={title:{text:"成绩表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",data:this.xAxisData},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsScoreName.setOption(t)},echartsRankInit(){let{rank:e}=this.getSeries();this.echartsRankName=this.$echarts.init(document.getElementById("rankName"));const t={title:{text:"名次表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",position:"top",data:this.xAxisRankData},yAxis:{name:"名次",type:"value",inverse:!0,nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsRankName.setOption(t)},getCompaseConfig(){let e=this.curTable.extend.preTable,t=[{name:this.curTable.name,type:"line",label:{show:!0},data:[]},{name:e.name,type:"line",label:{show:!0},data:[]}],a=this.curTable.extend.compareColumn;const s=this.nameCheck[0];let l=this.nameListObj[s],o=this.preNameListObj[s];return a.forEach((e=>{l&&t[0].data.push(l[e]),o&&t[1].data.push(o[e])})),{series:t,xAxis:a}},echartsCompareInit(){if(!this.isPreCompare)return;let{xAxis:e,series:t}=this.getCompaseConfig();this.echartsCompare=this.$echarts.init(document.getElementById("compare"));const a={title:{text:"比较表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",position:"top",data:e},yAxis:{name:"名次",type:"value",inverse:!0,nameTextStyle:{padding:[0,50,5,0]}},series:t};this.echartsCompare.setOption(a)}}},je=_e,Ie=(0,i.Z)(je,ce,he,!1,null,"188da092",null),Ee=Ie.exports,Le=function(){var e=this,t=e._self._c;return t("div",{staticClass:"totalSortTemplate"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.subjectName,callback:function(t){e.subjectName=t},expression:"subjectName"}},e._l(e.subjectList,(function(e){return t("el-tab-pane",{key:e,attrs:{label:e,name:e}})})),1),t("div",{staticClass:"btns"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),e.isDialog?t("el-button",{attrs:{type:"danger"},on:{click:e.onAddTable}},[e._v(" 添加到列表 ")]):e._e()],1),e.dataObj?t("el-table",{attrs:{data:e.scoreTable,border:"",height:e.tableHeight}},[t("el-table-column",{attrs:{label:e.subjectName,prop:"label",width:"100",align:"center"}}),t("el-table-column",{attrs:{label:"年段",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.dataObj.all[t.key])+" ")]}}],null,!1,3958705334)}),e._l(e.classTables,(function(a){return[t("el-table-column",{key:a.id,attrs:{label:a.className,align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.dataObj[a.className][t.key])+" ")]}}],null,!0)})]}))],2):e._e()],1)},Re=[],Oe={name:"TotalSortTemplate",mixins:[_],props:{classes:{type:Array,default(){return[]}},tableHeight:{type:Number,default:450},isDialog:{type:Boolean,default:!1}},watch:{},computed:{tables(){return this.$store.state.tables},isShowMenu(){return this.$store.state.isShowMenu},subjectList(){return this.$store.getters.subjectList},subjectObj(){return this.$store.getters.subjectObj}},data(){return{subConfig:{},is150:!1,classTables:[],subjectName:"",scoreTable:{},scoreRegionList:[],otherList:[{label:"最高分",value:0,key:"maxScore",isName:!0},{label:"最低分",value:0,key:"minScore",isName:!0},{label:"不及格数",value:0,key:"noPassNum",isName:!0},{label:"及格数",value:0,key:"passNum",isName:!0},{label:"及格率%",value:0,key:"passRate"},{label:"优秀数",value:0,key:"excellentNum",isName:!0},{label:"优秀率%",value:0,key:"excellentRate"},{label:"与考人数",value:0,key:"peopleNum"}],rangRegionList:[],averageList:[{label:"平均分",value:0,key:"average"},{label:"均分人数",value:0,key:"averageNum",isName:!0}],dataObj:null,isTable:!0}},created(){this.subjectName=this.subjectList[0],this.getTables()},methods:{getTables(){let e=[];if(this.classes.forEach((t=>{let a=this.tables.find((e=>e.id==t));a?e.push(a):this.isTable=!1})),!this.isTable)return q(),!1;this.classTables=e,this.getRowName()},getRowName(){if(!this.isTable)return!1;this.subConfig=this.subjectObj[this.subjectName],this.is150=150==this.subConfig.fullScore;let e=this.getScoreRegionList(),t=this.getRangRegionList();this.scoreTable=[...e,...this.otherList,...t,...this.averageList],this.init()},getScoreRegionList(){let e=[];for(let t=14;t>=0;t--){let a=10*t,s=a+9;e.push({label:`${a}-${s}`,value:0,key:`score${a}to${s}Num`,isName:!0})}return this.is150?e[0].label="140-150":(e.splice(0,5),e[0].label="90-100"),e},getRangRegionList(){let e=[{label:"前10名",value:0,key:"top10Num",isAdd:!0,isName:!0}];for(let t=50;t<=400;t+=50)e.push({label:`前${t}名`,value:0,key:`top${t}Num`,isAdd:!0,isName:!0});return e.push({label:"400名后",value:0,key:"otherTopNum",isName:!0}),e},init(){let e={};this.classTables.forEach((t=>{e[t.className]=this.classDataHandle(t)})),this.getTotalData(e),this.dataObj=e},classDataHandle(e){const t=e.sortObj[this.subConfig.scoreKey],a=e.sortObj[this.subConfig.rankKey];if(!t||!a)return{};let s={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,maxScore:0,minScore:0,pass:[],passNum:0,noPass:[],noPassNum:0,passRate:0,excellent:[],excellentNum:0,excellentRate:0,peopleNum:t.length,top10:[],top50:[],top100:[],top150:[],top200:[],top250:[],top300:[],top350:[],top400:[],otherTop:[],average:0,averageList:[],averageNum:0},l=0,o=.6*this.subConfig.fullScore,i=.85*this.subConfig.fullScore;t.forEach((e=>{this.getScoreRange(e,s),l+=e.score,e.score>s.maxScore&&(s.maxScore=e.score),e.score<s.minScore&&(s.minScore=e.score),e.score>=o?s.pass.push(e):s.noPass.push(e),e.score>=i&&s.excellent.push(e)})),s.passNum=s.pass.length,s.noPassNum=s.noPass.length,s.passRate=(s.passNum/s.peopleNum*100).toFixed(2),s.excellentNum=s.excellent.length,s.excellentRate=(s.excellentNum/s.peopleNum*100).toFixed(2),s.average=(l/s.peopleNum).toFixed(2),t.forEach((e=>{e.score>=s.average&&s.averageList.push(e)})),s.averageNum=s.averageList.length,a.forEach((e=>{e.score>0&&e.score<=10?s.top10.push(e):e.score>10&&e.score<=50?s.top50.push(e):e.score>50&&e.score<=100?s.top100.push(e):e.score>100&&e.score<=150?s.top150.push(e):e.score>150&&e.score<=200?s.top200.push(e):e.score>200&&e.score<=250?s.top250.push(e):e.score>250&&e.score<=300?s.top300.push(e):e.score>300&&e.score<=350?s.top350.push(e):e.score>350&&e.score<=400?s.top400.push(e):s.otherTop.push(e)}));let r=[10,50,100,150,200,250,300,350,400];return r.forEach(((e,t)=>{s[`top${e}Num`]=s[`top${e}`].length+(s[`top${r[t-1]}Num`]||0)})),s.otherTopNum=s.otherTop.length,s},getScoreRange(e,t){let a=10*parseInt(e.score/10);this.is150||10!=a||(a=9),this.is150&&15==a&&(a=14);let s=a+9;t[`score${a}to${s}`]||(t[`score${a}to${s}`]=[]),t[`score${a}to${s}`].push(e),t[`score${a}to${s}Num`]=t[`score${a}to${s}`].length},getTotalData(e){let t={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,passNum:0,noPassNum:0,passRate:0,excellentNum:0,excellentRate:0,peopleNum:0,top10Num:0,top50Num:0,top100Num:0,top150Num:0,top200Num:0,top250Num:0,top300Num:0,top350Num:0,top400Num:0,otherTopNum:0,average:0,averageNum:0},a=0,s=0,l=0;for(let o in e){a++;for(let a in t)t[a]+=parseFloat(e[o][a])||0;s<e[o].maxScore&&(s=e[o].maxScore),l>e[o].minScore&&(l=e[o].minScore)}t.maxScore=s,t.minScore=l,["passRate","excellentRate","average"].forEach((e=>{t[e]=(t[e]/a).toFixed(2)})),e.all=t},handleClick(){this.getRowName()},onExport(){const e=this.tableHandle();this.baseExportExcel(e)},onAddTable(){const e=this.tableHandle();this.$store.commit("addTable",e),this.$store.commit("setCurTableId",e.id),this.$emit("onAddTable")},tableHandle(){const e=[],t=this.classTables.map((e=>e.className));this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((a=>{if("TR"!==a.tagName)return;let s={},l=a.childNodes[0].textContent;l!=this.subjectName&&(s[this.subjectName]=l,s["年段"]=a.childNodes[1].textContent.trim(),t.forEach(((e,t)=>{s[e]=a.childNodes[t+2].textContent.trim()})),e.push(s))}));const a={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.subjectName}-年段分析表`,className:"年段",isCompare:!1,template:"totalSortTemplate",extend:{classes:this.classes}};return a}}},Ae=Oe,Me=(0,i.Z)(Ae,Le,Re,!1,null,"70df7bad",null),Be=Me.exports,He=function(){var e=this,t=e._self._c;return t("div",{staticClass:"studentScoreTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"name"},[t("el-checkbox-group",{staticClass:"nameCheck",attrs:{min:1},on:{change:e.nameCheckChange},model:{value:e.nameCheck,callback:function(t){e.nameCheck=t},expression:"nameCheck"}},e._l(e.defaultTable.data,(function(e){return t("el-checkbox",{key:e["姓名"],staticStyle:{width:"70px"},attrs:{label:e["姓名"],value:e["姓名"]}})})),1)],1),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1),t("br"),t("div",{staticClass:"btn"},[t("base-echart-download-btn",{attrs:{name:e.nameCheck[0],table:e.table}}),t("br"),t("base-score-analyse-btn",{staticClass:"btn",attrs:{btnName:"修改",table:e.curTable}})],1)],1)]),t("div",{staticClass:"content",style:{height:`${e.contentHeight}px`}},[1==e.radio?t("base-table",{ref:"baseTable",attrs:{"table-height":e.contentHeight,table:e.table}}):e._e(),2==e.radio?t("div",[t("div",{staticClass:"echarts",attrs:{id:"echarts"}},[e.isShowEhart.name?t("p",{staticClass:"nameTitle"},[e._v(e._s(e.nameCheck[0]))]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart.reducedRank,expression:"isShowEhart.reducedRank"}],staticClass:"echartitem",staticStyle:{width:"100%",height:"250px"},attrs:{id:"reducedRank"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart.totalRank,expression:"isShowEhart.totalRank"}],staticClass:"echartitem",staticStyle:{width:"48%",height:"250px"},attrs:{id:"totalRank"}}),e._l(e.subjectMap,(function(a){return[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart[a.key],expression:"isShowEhart[item.key]"}],key:a.key,staticClass:"echartitem",staticStyle:{width:"48%",height:"250px"},attrs:{id:a.key}})]}))],2)]):e._e()],1)])},Ke=[],Pe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseScoreAnalyseBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" "+e._s(e.btnName)+" ")]),t("el-dialog",{attrs:{title:"成绩分析",visible:e.visiableDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visiableDialog=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"表格"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"","collapse-tags":"",placeholder:"请选择",clearable:""},on:{change:e.onSelectHandle},model:{value:e.formData.selectTablesId,callback:function(t){e.$set(e.formData,"selectTablesId",t)},expression:"formData.selectTablesId"}},e._l(e.options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-button",{attrs:{type:"primary"},on:{click:e.onAll}},[e._v("全选")])],1),t("div",[e._v(" 已选择： "),t("el-table",{attrs:{data:e.selectTables,height:300,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",align:"center"}}),t("el-table-column",{attrs:{label:"班级",prop:"className",width:"70",align:"center"}}),t("el-table-column",{attrs:{label:"表名",prop:"name"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:s}){return[t("el-link",{attrs:{type:"danger",icon:"el-icon-delete-solid"},on:{click:function(t){return e.onDelect(a.id,s)}}})]}}])})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确定")])],1)],1),e.tableDialog?t("el-dialog",{attrs:{title:"成绩分析",visible:e.tableDialog,width:"80%",top:"10vh"},on:{"update:visible":function(t){e.tableDialog=t}}},[t("student-score-template",{attrs:{selectTablesId:e.formData.selectTablesId,isDialog:!0},on:{onAddTable:function(t){e.tableDialog=!1,e.visiableDialog=!1}}})],1):e._e()],1)},Ve=[],ze={name:"BaseMulClassAnalyseBtn",mixins:[_],components:{StudentScoreTemplate:lt},props:{btnName:{type:String,default:"成绩分析"},table:{type:Object,default(){return null}}},computed:{tables(){return this.$store.state.tables},options(){return this.tables.filter((e=>e.sortObj))}},data(){return{tableDialog:!1,visiableDialog:!1,selectTables:[],formData:{name:"成绩分析",selectTablesId:[]},rules:{name:[{required:!0,message:"请输入"}],selectTablesId:[{required:!0,message:"请选择"}]}}},created(){if(this.table){this.formData.name=this.table.name;let e=[],t=[];this.table.extend.selectTablesId.forEach((a=>{let s=this.tables.find((e=>e.id==a));s&&(t.push(a),e.push(s))})),this.selectTables=e,this.formData.selectTablesId=t}},methods:{async onSave(){try{await this.$refs.form.validate();let e=this.selectTables.find((e=>!e.className));if(e)return this.$message.error(`请设置【${e.name}】的班级`),!1;let t=this.selectTables[0].className;if(this.selectTables.find((e=>e.className!==t)))return this.$message.error("班级不唯一，请调整"),!1;const a={name:this.formData.name,id:Date.now(),column:[],className:t,isCompare:!0,template:"studentScoreTemplate",extend:{selectTablesId:this.formData.selectTablesId}};if(this.table?.id){let e=null;this.tables.find(((t,a)=>{if(t.id==this.table.id)return e=a,!0})),this.tables[e]=a,this.$store.commit("setTables",this.tables),this.$store.commit("setCurTableId",a.id)}else this.$store.commit("addTable",a),this.$store.commit("setCurTableId",a.id);this.visiableDialog=!1,this.onClose()}catch(e){console.log(e)}},onAll(){this.formData.selectTablesId=this.options.map((e=>e.id)),this.onSelectHandle()},onDelect(e,t){this.formData.selectTablesId.splice(this.formData.selectTablesId.indexOf(e),1),this.selectTables.splice(t,1)},onSelectHandle(){this.selectTables=this.tables.filter((e=>this.formData.selectTablesId.includes(e.id)))},onClose(){this.formData.selectTablesId=[],this.selectTables=[]}}},Ze=ze,Fe=(0,i.Z)(Ze,Pe,Ve,!1,null,"d5d0af38",null),qe=Fe.exports,Je=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseEchartDownLoadBtn"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onDownload}},[e._v("下载")]),t("el-button",{staticStyle:{"margin-left":"-2px","border-radius":"0 3px 3px 0"},attrs:{type:"primary",plain:""},on:{click:function(t){e.downloadVisiable=!0}}},[e._v(" 设置 ")]),t("el-dialog",{attrs:{title:"下载设置",visible:e.downloadVisiable},on:{"update:visible":function(t){e.downloadVisiable=t}}},[t("el-form",{attrs:{model:e.formData}},[t("el-form-item",{attrs:{label:"打印列名"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminateColmn},on:{change:e.handleCheckAllColumnChange},model:{value:e.checkAllColumn,callback:function(t){e.checkAllColumn=t},expression:"checkAllColumn"}},[e._v(" 全选 ")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedColumnChange},model:{value:e.formData.checkedColumn,callback:function(t){e.$set(e.formData,"checkedColumn",t)},expression:"formData.checkedColumn"}},e._l(e.columnTh,(function(a){return t("el-checkbox",{key:a,attrs:{label:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("el-form-item",{attrs:{label:"打印图表"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v(" 全选 ")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.formData.checkedSubject,callback:function(t){e.$set(e.formData,"checkedSubject",t)},expression:"formData.checkedSubject"}},e._l(e.options,(function(a){return t("el-checkbox",{key:a.key,attrs:{label:a.key}},[e._v(" "+e._s(a.rankKey)+" ")])})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.downloadVisiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确 定")])],1)],1)],1)},Ue=[],We=a(2269),Ge=a.n(We),Qe={name:"BaseEchartDownLoadBtn",mixins:[_],props:{name:{type:String,required:!0},table:{type:Object,required:!0}},data(){return{downloadVisiable:!1,formData:{checkedColumn:[],checkedSubject:[]},checkAll:!0,options:[{name:"折算名",rankKey:"折算名",key:"reducedRank"},{name:"段名",rankKey:"段名",key:"totalRank"}],isIndeterminate:!0,isIndeterminateColmn:!0,checkAllColumn:!1}},computed:{...(0,O.rn)({subjectMap:e=>e.subjectMap,downloadSetting:e=>e.downloadSetting}),...(0,O.Se)(["subjectList"]),columnTh(){return this.table.column.filter(((e,t)=>0!==t))}},created(){this.options.push(...this.subjectMap),this.openHandle()},methods:{openHandle(){this.downloadSetting?(this.formData.checkedColumn=[...this.downloadSetting.checkedColumn],this.formData.checkedSubject=this.downloadSetting.checkedSubject):(this.table.column.forEach((e=>{this.subjectList.includes(e)||this.formData.checkedColumn.push(e)})),this.formData.checkedColumn.splice(0,1),this.handleCheckAllChange(!0))},handleCheckAllChange(e){this.formData.checkedSubject=e?this.options.map((e=>e.key)):[],this.isIndeterminate=!1},handleCheckAllColumnChange(e){this.formData.checkedColumn=e?this.columnTh:[],this.isIndeterminateColumn=!1},handleCheckedChange(e){let t=e.length;this.checkAll=t===this.options.length,this.isIndeterminate=t>0&&t<this.options.length},handleCheckedColumnChange(e){let t=e.length;this.checkAllColumn=t===this.columnTh.length,this.isIndeterminateColumn=t>0&&t<this.columnTh.length},onPrint(){window.print()},onSave(){this.$store.commit("setDownloadSetting",this.formData),this.downloadVisiable=!1},downloadTable(){let e=[this.name,...this.formData.checkedColumn],t=[],a=[];this.table.data.forEach((s=>{a.push({hpx:24});let l={};for(let t in s)e.includes(t)&&(l[t]=s[t]);t.push(l)}));const s={"折算名":6,"优势":18,"劣势":18},l=e.map((e=>s[e]?{wch:s[e]}:{wch:4}));l[0].wch=8;let o={name:this.table.name,className:this.table.className,column:this.formData.checkedColumn,data:t,isCompare:!0};this.baseExportExcel(o)},onDownload(){this.downloadTable();let e={};this.options.forEach((t=>{this.formData.checkedSubject.includes(t.key)?e[t.key]=!0:e[t.key]=!1})),e.name=!0,this.$parent.isShowEhart=e,this.$nextTick((()=>{Ge()(document.getElementById("echarts")).then((t=>{var a=t.toDataURL("image/png").replace("image/png","image/octet-stream"),s=document.createElement("a");s.download=`${this.name}-成绩分析.png`,s.href=a,document.body.appendChild(s),s.click(),s.remove();for(let l in e)e[l]=!0;e.name=!1,this.$parent.isShowEhart=e,this.$nextTick((()=>{this.downloadVisiable=!1}))}))}))}}},Xe=Qe,Ye=(0,i.Z)(Xe,Je,Ue,!1,null,"0ca9a3a0",null),et=Ye.exports,tt={name:"StudentScoreTemplate",components:{BaseTable:C,BaseScoreAnalyseBtn:qe,BaseEchartDownloadBtn:et},props:{selectTablesId:{type:Array,default(){return[]}},tableHeight:{type:Number,default:450}},watch:{curTableId:{handler(){this.getTables()}},isShowMenu(){this.echartsResize()}},computed:{tables(){return this.$store.state.tables},curTableId(){return this.$store.state.curTableId},subjectMap(){return this.$store.state.subjectMap},isShowMenu(){return this.$store.state.isShowMenu},curTable(){return this.$store.getters.curTable||{}}},mounted(){this.contentHeight=this.tableHeight-this.$el.childNodes[0].offsetHeight+55},data(){return{radio:2,nameCheck:[],nameList:[],selectTables:[],defaultTable:[],column:[],contentHeight:500,table:{},xAxisData:[],zsmSeries:{},echarts:{reducedRank:null,totalRank:null},isShowEhart:{reducedRank:!0,totalRank:!0}}},created(){this.subjectMap.forEach((e=>{this.$set(this.echarts,e.key,null),this.$set(this.isShowEhart,e.key,!0)})),this.getTables()},destroyed(){this.destroyedEchart()},methods:{getTables(){let e=!0,t=[];if(this.selectTablesId.find((a=>{let s=this.tables.find((e=>e.id==a));if(!s)return e=!1,q(),!0;t.push(s)})),!e)return!1;this.selectTables=t,this.getInit(t)},getInit(e){this.defaultTable=e[0],this.nameCheck=[this.defaultTable.data[0]["姓名"]],this.getColumn(),this.getTable()},getColumn(){this.column=this.subjectMap.reduce(((e,t)=>(e.push(t.scoreKey),e.push(t.rankKey),e.push(`${t.rankKey.substr(0,1)}差`),e)),[]),this.column.push("总分","段名","段差","折总","折算名","优势","劣势")},getTable(e=this.selectTables){let t=[],a=[];const s=this.nameCheck[0];e.forEach((e=>{a.push(e.name);let l=e.data.find((e=>e["姓名"]==this.nameCheck[0]))||{},o={};o[s]=e.name;let i=l["折算名"]||l["段名"]||null,r={"优势":[],"劣势":[]};this.subjectMap.forEach((e=>{let t=l[e.rankKey]?z(i,l[e.rankKey]):null;r[`${e.rankKey.substr(0,1)}差`]=t,t>50?r["优势"].push(e.scoreKey):t<-50&&r["劣势"].push(e.scoreKey)})),r["段差"]=l["段名"]?z(i,l["段名"]):null,r["优势"]=r["优势"].join("、"),r["劣势"]=r["劣势"].join("、"),this.column.forEach((e=>{o[e]=l[e]||r[e]||""})),t.push(o)})),this.table={name:`${this.nameCheck[0]}-成绩分析`,id:Date.now(),data:t,column:Object.keys(t[0]),isCompare:!0,className:this.defaultTable.className},this.xAxisData=a,this.getZsmData(),this.typeChangeHandle()},getZsmData(){this.zsmSeries=this.getSeries("折算名")},nameCheckChange(e){this.nameCheck=e.splice(1,1),this.getTable()},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},destroyedEchart(){for(let e in this.echarts)this.echarts[e]&&this.echarts[e].dispose()},echartInit(){this.$nextTick((()=>{this.echartsReducedRankInit(),this.echartsInitHandle({name:"段名",key:"totalRank",rankKey:"段名"}),this.subjectMap.forEach((e=>{this.echartsInitHandle(e)}))}))},getSeries(e){const t=this.table.data.map((t=>t[e]));return{name:e,type:"line",label:{show:!0},data:t}},echartsReducedRankInit(){this.echarts.reducedRank=this.$echarts.init(document.getElementById("reducedRank"));const e={title:{text:"折算名分析",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",data:this.xAxisData,position:"top"},yAxis:{name:"名次",type:"value",inverse:!0},series:this.zsmSeries};this.echarts.reducedRank.setOption(e)},echartsSummaryInit(){let e=[this.getSeries("段名")];this.subjectMap.forEach((t=>{e.push(this.getSeries(t.rankKey))})),this.echarts.summary=this.$echarts.init(document.getElementById("summary"));const t={title:{text:"汇总分析",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",data:this.xAxisData,position:"top"},yAxis:{name:"名次",type:"value",inverse:!0},series:e};this.echarts.summary.setOption(t)},echartsInitHandle(e){let t=[this.getSeries(e.rankKey)];t.push(this.zsmSeries),this.echarts[`${e.key}`]=this.$echarts.init(document.getElementById(e.key));const a={title:{text:`${e.rankKey}分析`,textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center",selected:{"折算名":!1}},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",position:"top",data:this.xAxisData},yAxis:{name:"名次",type:"value",inverse:!0},series:t};this.echarts[`${e.key}`].setOption(a)},echartsResize(){setTimeout((()=>{for(let e in this.echarts)this.echarts[e].resize()}),500)}}},at=tt,st=(0,i.Z)(at,He,Ke,!1,null,"8d98cd8c",null),lt=st.exports,ot=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseMulSheetExportBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" 合表导出 ")]),t("el-dialog",{attrs:{title:"分表导出",visible:e.visiableDialog,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.visiableDialog=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-table",{attrs:{data:e.formData.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"70"}}),t("el-table-column",{attrs:{label:"sheet名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.tableName}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.tableChangeHandle(t,a)}},model:{value:e.formData.tables[a].name,callback:function(t){e.$set(e.formData.tables[a],"name",t)},expression:"formData.tables[$index].name"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"列名"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.tableColumn}},[t("el-checkbox-group",{model:{value:e.formData.tables[a].column,callback:function(t){e.$set(e.formData.tables[a],"column",t)},expression:"formData.tables[$index].column"}},e._l(e.formData.tables[a].th,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{width:"100",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.formData.tables.push({name:"",column:[]})}}},[e._v(" 添加 ")])]},proxy:!0},{key:"default",fn:function({$index:a}){return[t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.onDelect(a)}}},[e._v(" 删除 ")])]}}])})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1)],1)},it=[],rt={name:"BaseMulSheetExportBtn",mixins:[_],computed:{tables(){return this.$store.state.tables}},data(){return{visiableDialog:!1,formData:{name:"",tables:[{name:"",column:[]}]},rules:{name:[{required:!0,message:"请输入"}],tableName:[{required:!0,message:"请选择"}],tableColumn:[{required:!0,message:"请选择"}]}}},methods:{tableChangeHandle(e,t){const a=this.tables.find((t=>t.id===e));this.formData.tables[t].table=a,this.formData.tables[t].th=a.column,this.formData.tables[t].column=a.column},onDelect(e){this.formData.tables.splice(e,1)},async onExport(){try{await this.$refs.form.validate();let e=[];this.formData.tables.forEach((t=>{let a={id:t.table.id,className:t.table.className,isCompare:t.table.isCompare||!1,data:[],column:t.column,name:t.table.name};t.table.data.forEach((e=>{let s={};for(const a in e)t.column.includes(a)&&(s[a]=e[a]);a.data.push(s)})),e.push(a)}));const t={name:this.formData.name,sheets:e};this.baseExportMulSheetExcel(t)}catch(e){console.log(e)}}}},nt=rt,ct=(0,i.Z)(nt,ot,it,!1,null,"f1111b88",null),ht=ct.exports,ut=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseMulClassAnalyseBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" 年段分析 ")]),t("el-dialog",{attrs:{title:"年段分析",visible:e.visiableDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visiableDialog=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"班级",prop:"classes"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"","collapse-tags":"",placeholder:"请选择","value-key":"id",clearable:"","multiple-limit":14},model:{value:e.formData.classes,callback:function(t){e.$set(e.formData,"classes",t)},expression:"formData.classes"}},e._l(e.options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1),t("div",[e._v(" 已选择： "),e._l(e.formData.classes,(function(a,s){return t("span",{key:a.id},[e._v(" "+e._s(a.name)+"【"+e._s(a.className||"未知")+"】 "),s!==e.formData.classes.length-1?t("span",[e._v("、")]):e._e()])}))],2)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确定")])],1)],1),e.tableDialog?t("el-dialog",{attrs:{title:"年段分析",visible:e.tableDialog,width:"80%",top:"10vh"},on:{"update:visible":function(t){e.tableDialog=t}}},[t("total-sort-template",{attrs:{classes:e.formData.classes.map((e=>e.id)),isDialog:!0},on:{onAddTable:function(t){e.tableDialog=!1,e.visiableDialog=!1}}})],1):e._e()],1)},mt=[],dt={name:"BaseMulClassAnalyseBtn",mixins:[_],components:{TotalSortTemplate:Be},computed:{tables(){return this.$store.state.tables},options(){return this.tables.filter((e=>e.sortObj))}},data(){return{tableDialog:!1,visiableDialog:!1,formData:{name:"年段分析",classes:[]},rules:{name:[{required:!0,message:"请输入"}],classes:[{required:!0,message:"请选择"}]}}},methods:{async onSave(){try{await this.$refs.form.validate();let e=this.formData.classes.find((e=>!e.className));if(e)return this.$message.error(`请设置【${e.name}】的班级`),!1;if(P(this.formData.classes.map((e=>e.className))))return this.$message.error("班级重复，请确认"),!1;this.tableDialog=!0}catch(e){console.log(e)}},onClose(){this.formData.classes=[]}}},bt=dt,pt=(0,i.Z)(bt,ut,mt,!1,null,"3392b1e4",null),ft=pt.exports,gt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseSettingBtn"},[t("el-link",{on:{click:function(t){e.dialogVisiable=!e.dialogVisiable}}},[t("i",{staticClass:"el-icon-setting btn"})]),t("el-dialog",{attrs:{title:"设置",visible:e.dialogVisiable,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[t("base-class-setting",{attrs:{label:"默认班级"},model:{value:e.className,callback:function(t){e.className=t},expression:"className"}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确 定")])],1)],1)],1)},yt=[],vt={name:"BaseTemplateBtn",mixins:[_],components:{BaseClassSetting:fe},data(){return{className:"",dialogVisiable:!1}},computed:{defaultClassName(){return this.$store.state.defaultClassName}},created(){this.className=this.defaultClassName},methods:{onSave(){this.$store.commit("setDefaultClassName",this.className),this.$message.success("设置成功"),this.dialogVisiable=!1}}},kt=vt,xt=(0,i.Z)(kt,gt,yt,!1,null,"6421ceda",null),Tt=xt.exports,Ct=function(){var e=this,t=e._self._c;return t("div",{staticClass:"menuList",style:{width:e.isShowMenu?"250px":"50px"}},[t("div",{staticClass:"title"},[e.isShowMenu?t("p",{staticClass:"text"},[e._v("列表")]):e._e(),t("i",{staticClass:"btn",class:e.isShowMenu?"el-icon-s-fold":"el-icon-s-unfold",on:{click:function(t){return e.$store.commit("setIsShowMenu",!e.isShowMenu)}}})]),t("transition",{attrs:{name:"el-fade-in-linear"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMenu,expression:"isShowMenu"}]},e._l(e.tables,(function(a,s){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("span",{staticClass:"name"},[e._v(e._s(a.name))]),a.data?t("i",{staticClass:"el-icon-download btn",on:{click:function(t){return e.exportExcel(a,t)}}}):e._e(),t("i",{staticClass:"el-icon-delete-solid btn",staticStyle:{"padding-left":"5px"},on:{click:function(t){return e.delectTable(a,s,t)}}}),t("i",{staticClass:"el-icon-top btn",staticStyle:{"padding-left":"3px"},on:{click:function(t){return e.upMove(s,t)}}}),t("i",{staticClass:"el-icon-bottom btn",on:{click:function(t){return e.downMove(s,t)}}})])})),0)]),t("transition",{attrs:{name:"el-fade-in"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowMenu,expression:"!isShowMenu"}]},e._l(e.tables,(function(a){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:a.name,placement:"right"}},[t("i",{staticClass:"el-icon-document"})])],1)})),0)])],1)},Nt=[],St={name:"MenuList",mixins:[_],computed:{isShowMenu(){return this.$store.state.isShowMenu},tables(){return this.$store.state.tables},curTable(){return this.$store.getters.curTable||{}},classNameObj(){let e={};return M.forEach((t=>{e[t.value]=t})),e}},created(){this.$store.commit("getIsShowMenu")},methods:{changeTable(e){this.$store.commit("setCurTableId",e.id)},exportExcel(e,t){t.stopPropagation(),this.baseExportExcel(e)},delectTable(e,t,a){a.stopPropagation(),this.$store.commit("deleteTable",t),e.id==this.curTableId&&this.$store.commit("setCurTableId",null)},upMove(e,t){t.stopPropagation(),this.$store.commit("upMoveTables",e)},downMove(e,t){t.stopPropagation(),this.$store.commit("downMoveTables",e)}}},Dt=St,wt=(0,i.Z)(Dt,Ct,Nt,!1,null,"2f30bf80",null),$t=wt.exports,_t={name:"ExcelView",components:{CompaseDialog:G,BaseTemplateBtn:ae,SortTemplate:ne,ScoreTemplate:Ee,StudentScoreTemplate:lt,BaseMulSheetExportBtn:ht,BaseMulClassAnalyseBtn:ft,BaseScoreAnalyseBtn:qe,BaseSettingBtn:Tt,MenuList:$t,TotalSortTemplate:Be},mixins:[_],data(){return{tableHeight:500,compaseDialog:{show:!1}}},computed:{...(0,O.rn)({subjectMap:e=>e.subjectMap,tables:e=>e.tables,defaultClassName:e=>e.defaultClassName}),curTable(){return this.$store.getters.curTable||{}}},created(){this.$store.commit("getTables"),this.$store.commit("getDefaultClassName"),this.$store.commit("getDownloadSetting")},mounted(){this.tableHeight=b()(".content")[0].offsetHeight-56,this.$store.commit("getCurTableId")},methods:{fileChange(e){return/\.(xls|xlsx)$/.test(e.name)?e.raw?void this.importFile(e):this.$message.error("文件导入失败"):this.$message.error("上传格式不正确，请上传xls/xlsx文件格式")},importFile(e){let t=this.curTable;const a=new FileReader;a.readAsArrayBuffer(e.raw),a.onload=a=>{const s=a.target.result,l=p.ij(s,{type:"binary"});l.SheetNames.forEach((a=>{const s=p.P6.sheet_to_json(l.Sheets[a]);if(0==s.length)return;const o={name:a.indexOf("Sheet")<0?a:e.name,data:s,id:Date.now(),column:Object.keys(s[0]),className:this.defaultClassName,isCompare:!1,sortObj:this.sortCompare(s)};this.$store.commit("addTable",o),t=o.id})),this.$store.commit("setCurTableId",t)}},sortCompare(e){let t={};return e.forEach((e=>{let a=e["姓名"];for(let s in e)"姓名"!==s&&(t[s]||(t[s]=[]),t[s].push({name:a,score:e[s]}))})),t},onDelete(){this.$store.commit("setCurTableId",null),this.$store.commit("setTables",[])}}},jt=_t,It=(0,i.Z)(jt,u,m,!1,null,"699ae242",null),Et=It.exports;s["default"].use(h.ZP);const Lt=[{path:"/",name:"home",component:Et},{path:"/test",name:"test",component:()=>a.e(241).then(a.bind(a,2306))},{path:"/echarts",name:"echarts",component:()=>a.e(338).then(a.bind(a,9597))}],Rt=new h.ZP({routes:Lt});var Ot=Rt,At=a(3139);s["default"].prototype.$echarts=At,s["default"].prototype.$echarts=At,s["default"].config.productionTip=!1,s["default"].use(K(),{size:"mini"}),new s["default"]({router:Ot,store:B,render:e=>e(c)}).$mount("#app")},5234:function(){},3659:function(){}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,l,o){if(!s){var i=1/0;for(h=0;h<e.length;h++){s=e[h][0],l=e[h][1],o=e[h][2];for(var r=!0,n=0;n<s.length;n++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[n])}))?s.splice(n--,1):(r=!1,o<i&&(i=o));if(r){e.splice(h--,1);var c=l();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,l,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,s){return a.f[s](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"faf4ed3c",338:"e4755d17"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"4f034e44",338:"8f9a6dcf"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="students-score-analyse:";a.l=function(s,l,o,i){if(e[s])e[s].push(l);else{var r,n;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+o){r=u;break}}r||(n=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+o),r.src=s),e[s]=[l];var m=function(t,a){r.onerror=r.onload=null,clearTimeout(d);var l=e[s];if(delete e[s],r.parentNode&&r.parentNode.removeChild(r),l&&l.forEach((function(e){return e(a)})),t)return t(a)},d=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),n&&document.head.appendChild(r)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e=function(e,t,a,s){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css";var o=function(o){if(l.onerror=l.onload=null,"load"===o.type)a();else{var i=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.href||t,n=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");n.code="CSS_CHUNK_LOAD_FAILED",n.type=i,n.request=r,l.parentNode.removeChild(l),s(n)}};return l.onerror=l.onload=o,l.href=t,document.head.appendChild(l),l},t=function(e,t){for(var a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s],o=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(o===e||o===t))return l}var i=document.getElementsByTagName("style");for(s=0;s<i.length;s++){l=i[s],o=l.getAttribute("data-href");if(o===e||o===t)return l}},s=function(s){return new Promise((function(l,o){var i=a.miniCssF(s),r=a.p+i;if(t(i,r))return l();e(s,r,l,o)}))},l={143:0};a.f.miniCss=function(e,t){var a={241:1,338:1};l[e]?t.push(l[e]):0!==l[e]&&a[e]&&t.push(l[e]=s(e).then((function(){l[e]=0}),(function(t){throw delete l[e],t})))}}(),function(){var e={143:0};a.f.j=function(t,s){var l=a.o(e,t)?e[t]:void 0;if(0!==l)if(l)s.push(l[2]);else{var o=new Promise((function(a,s){l=e[t]=[a,s]}));s.push(l[2]=o);var i=a.p+a.u(t),r=new Error,n=function(s){if(a.o(e,t)&&(l=e[t],0!==l&&(e[t]=void 0),l)){var o=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",r.name="ChunkLoadError",r.type=o,r.request=i,l[1](r)}};a.l(i,n,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,s){var l,o,i=s[0],r=s[1],n=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(l in r)a.o(r,l)&&(a.m[l]=r[l]);if(n)var h=n(a)}for(t&&t(s);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(h)},s=self["webpackChunkstudents_score_analyse"]=self["webpackChunkstudents_score_analyse"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(1997)}));s=a.O(s)})();
//# sourceMappingURL=app.c7412372.js.map