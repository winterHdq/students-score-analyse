(function(){var e={1887:function(e,t,a){"use strict";var s=a(6369),l=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],i=a(1001),n={},r=(0,i.Z)(n,l,o,!1,null,null,null),c=r.exports,h=a(2631),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Excel"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"",accept:".xls,.xlsx","auto-upload":!1,"show-file-list":!1,"on-change":e.fileChange}},[t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""}},[e._v("上传")])],1),t("base-mul-class-analyse-btn",{staticClass:"btn"}),t("base-score-analyse-btn",{staticClass:"btn"}),t("base-mul-sheet-export-btn",{staticClass:"btn"}),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:e.onDelete}},[e._v(" 一键删除 ")])],1),t("div",{staticClass:"right"},[t("base-template-btn"),t("base-setting-btn")],1)]),t("div",{staticClass:"content"},[t("div",{staticClass:"left"},[t("menu-list")],1),t("div",{staticClass:"right"},[e.curTable.column?t("div",["sortTemplate"==e.curTable.template?t("sort-template",{attrs:{tableId:e.curTable.extend.tableId,"table-height":e.tableHeight}}):"studentScoreTemplate"==e.curTable.template?t("student-score-template",{attrs:{selectTablesId:e.curTable.extend.selectTablesId,"table-height":e.tableHeight}}):"totalSortTemplate"==e.curTable.template?t("total-sort-template",{attrs:{classes:e.curTable.extend.classes,"table-height":e.tableHeight}}):t("score-template",{attrs:{tableHeight:e.tableHeight}})],1):e._e()])]),e.compaseDialog.show?t("compase-dialog",{attrs:{tables:e.tables},on:{onClose:function(t){e.compaseDialog.show=!1}}}):e._e()],1)},m=[],d=(a(7658),a(7387)),b=a.n(d),p=a(7092),f=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"compare-dialog",attrs:{visible:e.dialogVisible,title:"比较设置","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:"","label-width":"80px"}},[t("el-form-item",{attrs:{label:"本次成绩",prop:"initTableId"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:e.curTableId},on:{change:e.initTableChange},model:{value:e.formData.initTableId,callback:function(t){e.$set(e.formData,"initTableId",t)},expression:"formData.initTableId"}},e._l(e.scoreTables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"上次成绩",prop:"compareTableId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.compareTableChange},model:{value:e.formData.compareTableId,callback:function(t){e.$set(e.formData,"compareTableId",t)},expression:"formData.compareTableId"}},e._l(e.scoreTables,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("br"),t("el-form-item",{attrs:{label:"基准",prop:"baseTh"}},[t("el-select",{attrs:{placeholder:""},model:{value:e.formData.baseTh,callback:function(t){e.$set(e.formData,"baseTh",t)},expression:"formData.baseTh"}},e._l(e.thList,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1),t("span",{staticClass:"tip"},[e._v(" 请确保基准列数据唯一，比如以【姓名】为基准比较两个表格 ")])],1),t("br"),t("br"),t("el-form-item",{attrs:{label:"比较列",prop:"compareTh"}},[e.formData.initTableId?t("el-checkbox",{attrs:{indeterminate:e.checkData.compareThIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"compareTh")}},model:{value:e.checkData.compareThCheckAll,callback:function(t){e.$set(e.checkData,"compareThCheckAll",t)},expression:"checkData.compareThCheckAll"}},[e._v(" 全选 ")]):e._e(),t("el-checkbox-group",{model:{value:e.formData.compareTh,callback:function(t){e.$set(e.formData,"compareTh",t)},expression:"formData.compareTh"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1),e.compareTableDialog?t("el-dialog",{attrs:{title:"比较列表",width:"90%",visible:e.compareTableDialog,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.compareTableDialog=t}}},[t("base-export-btn",{attrs:{table:e.compareTable,isMultiple:!0}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:e.onAddList}},[e._v(" 添加到列表 ")]),t("base-table",{attrs:{table:e.compareTable}})],1):e._e()],1)},g=[],y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-table"},[t("el-table",{ref:"table",attrs:{data:e.table.data,border:"",stripe:"","highlight-current-row":"",height:e.tableHeight}},[t("el-table-column",{attrs:{fixed:"",label:"序号",type:"index",align:"center"}}),e._l(e.table.column,(function(a){return t("el-table-column",{key:a,attrs:{label:a,prop:a,fixed:e.fixedCol.indexOf(a)>=0,sortable:-1==e.fixedCol.indexOf(a),align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("span",{style:e.scoreStyle(s,a)},[e._v(" "+e._s(e.numHandle(s[a],a))+" ")])]}}],null,!0)})}))],2)],1)},k=[],v={name:"BaseTable",props:{tableHeight:{type:Number,default:500},table:{type:Object,default(){return{}}},fixedCol:{type:Array,default(){return["班级","姓名"]}}},watch:{table(){this.$nextTick((()=>{this.doLayout()}))}},computed:{subjectObj(){return this.$store.getters.subjectObj},subjectRankList(){return this.table.column.filter((e=>/进退|差/.test(e)))}},data(){return{}},methods:{doLayout(){this.$refs.table&&this.$refs.table.doLayout()},numHandle(e,t){return console.log(t),e},scoreStyle(e,t){let{subjectObj:a,subjectRankList:s}=this;if(this.table.isCompare){if(s.includes(t)&&e[t]<0)return{color:"red"}}else if(a[t]&&e[t]<a[t].passScore)return{color:"red"};return{}}}},x=v,T=(0,i.Z)(x,y,k,!1,null,"51344543",null),C=T.exports,S=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseExportBtn"},[e.isExportBtn?t("el-button",{attrs:{type:"primary"},on:{click:e.exportExcelHandle}},[e._v(" 导出 ")]):e._e(),e.isMultiple?t("el-button",{staticClass:"btn",attrs:{type:"success"},on:{click:e.exportMultipleSheetsExcelHandle}},[e._v(" 分科导出 ")]):e._e(),t("el-dialog",{attrs:{top:"20vh",title:"导出",visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"导出名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入导出表格的名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"导出列",prop:"column"}},[t("el-checkbox",{attrs:{indeterminate:e.checkData.showThIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkData.showThCheckAll,callback:function(t){e.$set(e.checkData,"showThCheckAll",t)},expression:"checkData.showThCheckAll"}},[e._v(" 全选 ")]),t("el-checkbox-group",{on:{change:e.handleCheckChange},model:{value:e.formData.column,callback:function(t){e.$set(e.formData,"column",t)},expression:"formData.column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1),t("el-dialog",{attrs:{top:"20vh",title:"分科导出",visible:e.dialogVisibleMul,"append-to-body":!0,"destroy-on-close":!0,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.dialogVisibleMul=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExportMul}},[e._v("导出")]),t("el-form",{ref:"formMul",attrs:{model:e.formDataMul,rules:e.rulesMul,inline:""}},[t("el-table",{attrs:{data:e.formDataMul.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),t("el-table-column",{attrs:{label:"表名",width:"150"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.name}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formDataMul.tables[a].name,callback:function(t){e.$set(e.formDataMul.tables[a],"name",t)},expression:"formDataMul.tables[$index].name"}})],1)]}}])}),t("el-table-column",{attrs:{label:"列名",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.column}},[t("el-checkbox-group",{model:{value:e.formDataMul.tables[a].column,callback:function(t){e.$set(e.formDataMul.tables[a],"column",t)},expression:"formDataMul.tables[$index].column"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[a==e.formDataMul.tables.length-1?t("el-button",{attrs:{type:"primary"},on:{click:e.onAddSheet}},[e._v(" 添加 ")]):e._e(),e.formDataMul.tables.length-1?t("el-button",{staticStyle:{"margin-left":"0px"},attrs:{type:"danger"},on:{click:function(t){return e.onDelectSheet(a)}}},[e._v(" 删除 ")]):e._e()]}}])})],1)],1)],1)],1)},D=[],w=a(5209),N=a.n(w);const $={data(){return{}},computed:{subjectObj(){return this.$store.getters.subjectObj}},methods:{baseExportExcel(e){const t=N().utils.book_new(),a=this.sheetHandle(e);N().utils.book_append_sheet(t,a);const s=e.name.lastIndexOf("."),l=e.name.slice(0,-1==s?99:s);N().writeFile(t,`${l}-${e.className||"班级"}.xlsx`)},baseExportMulSheetExcel(e){let t=!0;const a=N().utils.book_new();e.sheets.forEach((e=>{const s=this.sheetHandle(e);!s&&(t=!1),N().utils.book_append_sheet(a,s,e.name)})),t&&N().writeFile(a,`${e.name}.xlsx`)},sheetHandle(e){try{const t=N().utils.json_to_sheet(e.data);e?.sheet?.cols&&(t["!cols"]=e.sheet.cols),e?.sheet?.rows&&(t["!rows"]=e.sheet.rows);const a=e.column.length,s=e.column.filter((e=>/进退|差/.test(e)));return Object.keys(t).forEach(((l,o)=>{if(l.indexOf("!")<0){if(t[l].s={alignment:{vertical:"center",horizontal:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},font:{name:"宋体",sz:10}},!1===e.isScore)return;this.textColorHandle(e.column[o%a],t[l],s.length,s)}})),t}catch(t){return this.$message.error("啊欧，数据出错，导出失败"),!1}},textColorHandle(e,t,a,s){try{const l=t.v;a?s.includes(e)&&l<0&&(t.s.font.color={rgb:"FF0000"}):this.subjectObj[e]&&l<this.subjectObj[e].passScore&&(t.s.font.color={rgb:"FF0000"})}catch(l){console.log(l),this.$message.error("样式错误，导出失败")}}}};var _=$,E={name:"BaseExportBtn",components:{},mixins:[_],props:{table:{type:Object,default(){return{}}},isExportBtn:{type:Boolean,default:!0},isMultiple:{type:Boolean,default:!1}},computed:{thList(){return this.table.column||Object.keys(this.table.data[0])},subjectList(){return this.$store.getters.subjectList}},data(){return{dialogVisible:!1,formData:{name:"",column:[]},checkData:{showThCheckAll:!0,showThIndeterminate:!1},rules:{name:[{required:!0,message:"请输入"}],column:[{required:!0,message:"请选择"}]},dialogVisibleMul:!1,rulesMul:{},formDataMul:{tables:[]}}},methods:{handleCheckAllChange(e){this.formData.column=e?this.thList:[],this.checkData.showThIndeterminate=!1},handleCheckChange(e){let t=e.length;this.checkData.showThCheckAll=t===this.thList.length,this.checkData.showThIndeterminate=t>0&&t<this.thList.length},exportExcelHandle(){this.formData.name=this.table.name,this.formData.column=this.thList,this.dialogVisible=!0},onAddSheet(e={}){this.formDataMul.tables.push({id:Date.now(),name:e.name||"",column:e.column||[],data:[],isCompare:!0})},onDelectSheet(e){this.formDataMul.tables.splice(e,1)},exportMultipleSheetsExcelHandle(){this.dialogVisibleMul=!0,this.formDataMul.tables=[],this.thList.forEach((e=>{if(this.subjectList.includes(e)){let t={name:`${e}${this.table.isCompare?"进退分析":""}`,column:["姓名","班级",e]};const a=this.subjectObj[e].rankKey;this.thList.includes(a)&&t.column.push(a),this.thList.includes(`${a}进退`)&&t.column.push(`${a}进退`),this.thList.includes(`${a.substr(0,1)}差`)&&t.column.push(`${a.substr(0,1)}差`),["折总","折算名"].forEach((e=>{this.thList.includes(e)&&t.column.push(e)})),this.onAddSheet(t)}}))},async onExport(){await this.$refs.form.validate();let e=[];this.table.data.forEach((t=>{let a={};for(let e in t)this.formData.column.includes(e)&&(a[e]=t[e]);e.push(a)})),this.baseExportExcel({...this.table,data:e,column:this.formData.column,name:this.formData.name},!0),this.$message.warning("正在导出"),this.dialogVisible=!1},async onExportMul(){try{await this.$refs.formMul.validate(),this.formDataMul.tables.forEach((e=>e.data=[])),this.table.data.forEach((e=>{this.formDataMul.tables.forEach((t=>{let a={};for(let s in e)t.column.includes(s)&&(a[s]=e[s]);t.data.push(a)}))}));const e={name:`${this.table.name}-分科`,sheets:this.formDataMul.tables};this.baseExportMulSheetExcel(e),this.$message.warning("正在导出"),this.dialogVisibleMul=!1}catch(e){console.log(e)}}}},j=E,I=(0,i.Z)(j,S,D,!1,null,"75cb10df",null),L=I.exports,R=a(3767),M=a(3822);const A=[{name:"语文",key:"chinese",type:1,fullScore:150,scoreKey:"语文",rankKey:"语名"},{name:"数学",key:"mathematics",type:2,fullScore:150,scoreKey:"数学",rankKey:"数名"},{name:"英语",key:"english",type:3,fullScore:150,scoreKey:"英语",rankKey:"英名"},{name:"物理",key:"physical",type:4,fullScore:100,scoreKey:"物理",rankKey:"物名"},{name:"化学",key:"chemical",type:5,fullScore:100,scoreKey:"化学",rankKey:"化名"},{name:"政治",key:"political",type:6,fullScore:100,scoreKey:"政治",rankKey:"政名"},{name:"历史",key:"history",type:7,fullScore:100,scoreKey:"历史",rankKey:"历名"},{name:"生物",key:"biological",type:8,fullScore:100,scoreKey:"生物",rankKey:"生名"},{name:"地理",key:"geographic",type:9,fullScore:100,scoreKey:"地理",rankKey:"地名"}],O=[{label:"1班",value:"1班",bgColor:"#d32525"},{label:"2班",value:"2班",bgColor:"#0085ff"},{label:"3班",value:"3班",bgColor:"#9361dd"},{label:"4班",value:"4班",bgColor:"#d8810b"},{label:"5班",value:"5班",bgColor:"#5ed80b"},{label:"6班",value:"6班",bgColor:"#cf3576"},{label:"7班",value:"7班",bgColor:"#49d4a5"},{label:"8班",value:"8班",bgColor:"#957e62"},{label:"9班",value:"9班",bgColor:"#3939fa"},{label:"10班",value:"10班",bgColor:"#cc66ad"},{label:"11班",value:"11班",bgColor:"#78a8dd"},{label:"12班",value:"12班",bgColor:"#b1ba13"},{label:"13班",value:"13班",bgColor:"#ff00eb"},{label:"14班",value:"14班",bgColor:"#9fb7cc"},{label:"年段",value:"年段",bgColor:"#8b0000"}];s["default"].use(M.ZP);var B=new M.ZP.Store({state:{tables:[],curTableId:null,subjectMap:A,isShowMenu:!0,defaultClassName:"",downloadSetting:{}},getters:{curTable(e){return e.tables.find((t=>t.id==e.curTableId))},curIndex(e){let t=null;return e.tables.find(((a,s)=>{if(a.id==e.curTableId)return t=s,!0})),t},subjectObj(e){let t={};return e.subjectMap.forEach((e=>{t[e.name]=e,t[e.name].passScore=.6*(e.fullScore||100),t[e.name].excellentScore=.85*(e.fullScore||100)})),t},subjectList(e){return e.subjectMap.map((e=>e.name))},subjectRankList(e){return e.subjectMap.map((e=>e.rankKey))}},mutations:{getTables(e){e.tables=JSON.parse(localStorage.getItem("tables"))||[]},setTables(e,t){e.tables=t,localStorage.setItem("tables",JSON.stringify(e.tables))},addTable(e,t){e.tables.push(t),localStorage.setItem("tables",JSON.stringify(e.tables))},deleteTable(e,t){null!=t&&(e.tables.splice(t,1),localStorage.setItem("tables",JSON.stringify(e.tables)))},upMoveTables(e,t){if(0==t)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t-1]),s["default"].set(e.tables,t-1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},downMoveTables(e,t){if(t==e.tables.length-1)return;let a=e.tables[t];s["default"].set(e.tables,t,e.tables[t+1]),s["default"].set(e.tables,t+1,a),localStorage.setItem("tables",JSON.stringify(e.tables))},setCurTableId(e,t){e.curTableId=t,localStorage.setItem("curTableId",t)},getCurTableId(e){e.curTableId=localStorage.getItem("curTableId")},getIsShowMenu(e){e.isShowMenu="false"!=localStorage.getItem("isShowMenu")},setIsShowMenu(e,t){e.isShowMenu=t,localStorage.setItem("isShowMenu",t)},getDefaultClassName(e){e.defaultClassName=localStorage.getItem("defaultClassName")||""},setDefaultClassName(e,t){e.defaultClassName=t,localStorage.setItem("defaultClassName",t)},getDownloadSetting(e){const t=localStorage.getItem("downloadSetting");e.downloadSetting=t?JSON.parse(t):null},setDownloadSetting(e,t){e.downloadSetting=t,localStorage.setItem("downloadSetting",JSON.stringify(t))}},actions:{},modules:{}}),H=a(8499),K=a.n(H);const P=(e=[])=>{const t=Array.from(new Set(e));return e.length!==t.length},V=(e=[])=>{for(let t=0;t<e.length;t++)e[t]=e[t]||0},z=(...e)=>{V(e);const t=R.ZP.minus.apply(null,e);return Z(t)},Z=e=>{let t=e.toString().split(".")[1]?.length||0;return t>6&&(t=6),q(e,t)},q=R.ZP.round,F=()=>{H.MessageBox.alert("未找到原始表格，无法分析数据，请删除该表重新分析","提示",{confirmButtonText:"删除",callback:()=>{B.commit("deleteTable",B.getters.curIndex),B.commit("setCurTableId",null)}})},J=e=>{const t=e.filter((e=>e||0===e));return 100*parseInt(Math.min(...t)/100)};var U={name:"CompareDialog",components:{BaseTable:C,BaseExportBtn:L},mixins:[_],props:{curTableId:{type:Number}},computed:{tables(){return this.$store.state.tables},scoreTables(){return this.tables.filter((e=>e.sortObj))}},data(){return{formData:{initTableId:null,compareTableId:null,baseTh:"",compareTh:[]},checkData:{showThCheckAll:!1,showThIndeterminate:!1,compareThCheckAll:!1,compareThIndeterminate:!1},initTable:null,preTable:null,rules:{initTableId:[{required:!0,message:"请选择"}],compareTableId:[{required:!0,message:"请选择"}],baseTh:[{required:!0,message:"请选择"}],compareTh:[{required:!0,message:"请选择"}]},thList:[],dialogVisible:!1,compareTableDialog:!1,compareTable:{}}},created(){this.dialogVisible=!0,this.curTableId&&(this.formData.initTableId=this.curTableId,this.initTableChange(this.curTableId))},methods:{handleCheckAllChange(e,t){this.formData[t]=e?this.thList:[],this.checkData[`${t}Indeterminate`]=!1},handleCheckChange(e,t){let a=e.length;this.checkData[`${t}CheckAll`]=a===this.thList.length,this.checkData[`${t}Indeterminate`]=a>0&&a<this.thList.length},initTableChange(e){e==this.formData.compareTableId&&this.$message.error("比较的是同一张表格，请确认"),this.initTable=this.scoreTables.find((t=>t.id==e)),this.thList=Object.keys(this.initTable.data[0]),this.formData.compareTh=this.thList.filter((e=>"姓名"!==e&&e.indexOf("名")>0)),this.formData.baseTh=this.thList.find((e=>"姓名"==e))||this.thList[0]},compareTableChange(e){e==this.formData.initTableId&&this.$message.error("比较的是同一张表格，请确认"),this.preTable=this.scoreTables.find((t=>t.id==e))},async onSave(){if(await this.$refs.form.validate(),P(this.initTable.data.map((e=>e[this.formData.baseTh]))))return this.$message.error(`本次成绩【${this.formData.baseTh}】基准列存在重复值，请修改`),!1;if(!this.preTable.column.includes(this.formData.baseTh))return this.$message.error(`上次成绩无【${this.formData.baseTh}】基准列，请重新选择`),!1;let e=this.formData.compareTh.find((e=>!this.preTable.column.includes(e)));if(e)return this.$message.error(`上次成绩里无【${e}】列，无法进行比较，请重新选择`),!1;let t=[],a=JSON.parse(JSON.stringify(this.preTable.data)),s=a.length;this.initTable.data.forEach((e=>{let l=!1;for(let o=0;o<s;o++)if(e[this.formData.baseTh]==a[o][this.formData.baseTh]){l=!0;let i={};for(let t in e)i[t]=e[t],e[t]&&a[o][t]&&this.formData.compareTh.includes(t)&&!isNaN(e[t])&&(i[`${t}进退`]=z(e[t],a[o][t]),t.indexOf("名")>0&&(i[`${t}进退`]=0-i[`${t}进退`]));a.splice(o,1),t.push(i),s--;break}l||(this.formData.compareTh.forEach((t=>e[`${t}进退`]="")),t.push(e))}));const l=Object.keys(t[0]);a.forEach((e=>{let a={};l.forEach((t=>{e[t]&&isNaN(e[t])?a[t]=e[t]:a[t]=""})),t.push(a)}));let o={name:`${this.initTable.name}-${this.initTable.className}-进退比较`,data:t,id:Date.now(),column:l,className:`${this.initTable.className}`,isCompare:!0,extend:{compareColumn:this.formData.compareTh,preTable:this.preTable}};this.compareTable=o,this.compareTableDialog=!0},onAddList(){this.$store.commit("addTable",this.compareTable),this.$store.commit("setCurTableId",this.compareTable.id),this.onClose()},onClose(){this.$emit("onClose")}}},W=U,G=(0,i.Z)(W,f,g,!1,null,"87547660",null),Q=G.exports,X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseTemplateBtn"},[t("el-button",{attrs:{type:"success",size:"small",plain:""},on:{click:function(t){e.dialogVisiable=!e.dialogVisiable}}},[e._v(" 模板 ")]),t("el-dialog",{attrs:{title:"模板",visible:e.dialogVisiable,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),t("table",{staticClass:"table",attrs:{border:""}},[t("tr",e._l(e.table.column,(function(a){return t("th",{key:a},[e._v(e._s(a))])})),0),e._l(e.table.data.length,(function(a){return t("tr",{key:a},e._l(e.table.column,(function(e){return t("td",{key:e})})),0)}))],2)],1)],1)},Y=[],ee={name:"BaseTemplateBtn",mixins:[_],data(){return{dialogVisiable:!1,table:{id:Date.now(),name:"模板",column:[],data:[]}}},computed:{subjectMap(){return this.$store.state.subjectMap}},created(){this.table.column=this.subjectMap.reduce(((e,t)=>(e.push(t.scoreKey),e.push(t.rankKey),e)),["班级","姓名"]),this.table.column.push("总分","段名","折总","折算名");for(let e=0;e<3;e++){const e={};this.table.column.forEach((t=>e[t]="")),this.table.data.push(e)}},methods:{onExport(){this.baseExportExcel(this.table)}}},te=ee,ae=(0,i.Z)(te,X,Y,!1,null,"2f7b454a",null),se=ae.exports,le=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sortTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),e.isDialog?t("el-button",{staticClass:"btn",attrs:{type:"danger"},on:{click:e.onAddTable}},[e._v(" 添加到列表 ")]):e._e()],1),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1)],1)]),e.sortObj?t("div",[t("el-table",{directives:[{name:"show",rawName:"v-show",value:1==e.radio,expression:"radio == 1"}],attrs:{data:e.sortList,border:"",height:e.tableHeight}},[t("el-table-column",{attrs:{label:"类别",prop:"label",width:"100",align:"center"}}),e._l(e.subjectMap,(function(a){return[t("el-table-column",{key:a.key,attrs:{label:a.scoreKey,align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[e._v(" "+e._s(e.sortObj[a.key]?e.sortObj[a.key][s.key]:"")+" "),e.isShowName&&s.listKey?t("span",[e._v(" ："+e._s(e._f("toList")(e.sortObj[a.key][s.listKey]))+" ")]):e._e()]}}],null,!0)})]}))],2),2==e.radio?t("div",[t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"250px"},attrs:{id:"scoreRegion"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"250px"},attrs:{id:"rangRegion"}}),e._m(0)]):e._e()],1):e._e()])},oe=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"pass"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"200px"},attrs:{id:"excellent"}})])}],ie={name:"sortTemplate",mixins:[_],props:{tableId:{type:Number,require:!0},tableHeight:{type:Number,default:450},isDialog:{type:Boolean,default:!1}},computed:{...(0,M.rn)({subjectMap:e=>e.subjectMap,tables:e=>e.tables,isShowMenu:e=>e.isShowMenu}),...(0,M.Se)(["subjectList","subjectObj","curIndex"])},watch:{tableId:{handler(){this.getTables()},immediate:!0},isShowMenu(){this.echartsResize()}},data(){return{radio:1,is150:!0,baseTable:[],sortList:{},scoreRegionList:[],otherList:[{label:"最高分",value:0,key:"maxScore",listKey:"maxScoreList"},{label:"最低分",value:0,key:"minScore",listKey:"minScoreList"},{label:"不及格数",value:0,key:"noPassNum",listKey:"noPass"},{label:"及格数",value:0,key:"passNum",listKey:"pass"},{label:"及格率%",value:0,key:"passRate"},{label:"优秀数",value:0,key:"excellentNum",listKey:"excellent"},{label:"优秀率%",value:0,key:"excellentRate"},{label:"与考人数",value:0,key:"peopleNum"}],rangRegionList:[],averageList:[{label:"平均分",value:0,key:"average"},{label:"均分人数",value:0,key:"averageNum",listKey:"averageList"}],sortObj:null,isTable:!0,isShowName:!1,echarts:{scoreRegion:null,rangRegion:null,pass:null,excellent:null}}},filters:{toList(e){if(e)return Array.isArray(e)?e.map((e=>e.name)).join("、"):e.name||""}},destroyed(){this.destroyedEchart()},methods:{getTables(){this.curIndex;let e=this.tables.find((e=>e.id==this.tableId));if(!e)return this.isTable=!1,F(),!1;this.baseTable=e,this.getRowName()},getRowName(){if(!this.isTable)return!1;this.scoreRegionList=this.getScoreRegionList(),this.rangRegionList=this.getRangRegionList(),this.sortList=[...this.scoreRegionList,...this.otherList,...this.rangRegionList,...this.averageList],this.init()},getScoreRegionList(){let e=[];for(let t=14;t>=0;t--){let a=10*t,s=a+9;e.push({label:`${a}-${s}`,value:0,key:`score${a}to${s}Num`,listKey:`score${a}to${s}`})}return this.is150?e[0].label="140-150":(e.splice(0,5),e[0].label="90-100"),e},getRangRegionList(){let e=[{label:"前10名",value:0,key:"top10Num",isAdd:!0}];for(let t=50;t<=400;t+=50)e.push({label:`前${t}名`,value:0,key:`top${t}Num`,listKey:`top${t}`,isAdd:!0});return e.push({label:"400名后",value:0,key:"otherTopNum",listKey:"otherTop"}),e},init(){let e={};this.subjectMap.forEach((t=>{e[t.key]=this.classDataHandle(t)})),this.sortObj=e,this.typeChangeHandle()},classDataHandle(e){const t=this.baseTable,a=t.sortObj[e.scoreKey],s=t.sortObj[e.rankKey];if(!a||!s)return null;let l={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,maxScore:0,maxScoreList:[],minScore:0,minScoreList:[],pass:[],passNum:0,noPass:[],noPassNum:0,passRate:0,excellent:[],excellentNum:0,excellentRate:0,peopleNum:a.length,top10:[],top50:[],top100:[],top150:[],top200:[],top250:[],top300:[],top350:[],top400:[],otherTop:[],average:0,averageList:[],averageNum:0},o=0,i=.6*e.fullScore,n=.85*e.fullScore;a.forEach((t=>{const a=isNaN(t.score)?0:parseFloat(t.score);this.getScoreRange(t,l,150===e.fullScore),o+=a,a>l.maxScore&&(l.maxScore=a,l.maxScoreList=[t]),a<l.minScore&&(l.minScore=a,l.minScoreList=[t]),a>=i?l.pass.push(t):l.noPass.push(t),a>=n&&l.excellent.push(t)})),l.passNum=l.pass.length,l.noPassNum=l.noPass.length,l.passRate=(l.passNum/l.peopleNum*100).toFixed(2),l.excellentNum=l.excellent.length,l.excellentRate=(l.excellentNum/l.peopleNum*100).toFixed(2),l.average=(o/l.peopleNum).toFixed(2),a.forEach((e=>{e.score>=l.average&&l.averageList.push(e)})),l.averageNum=l.averageList.length,s.forEach((e=>{e.score>0&&e.score<=10?l.top10.push(e):e.score>10&&e.score<=50?l.top50.push(e):e.score>50&&e.score<=100?l.top100.push(e):e.score>100&&e.score<=150?l.top150.push(e):e.score>150&&e.score<=200?l.top200.push(e):e.score>200&&e.score<=250?l.top250.push(e):e.score>250&&e.score<=300?l.top300.push(e):e.score>300&&e.score<=350?l.top350.push(e):e.score>350&&e.score<=400?l.top400.push(e):l.otherTop.push(e)}));let r=[10,50,100,150,200,250,300,350,400];return r.forEach(((e,t)=>{l[`top${e}Num`]=l[`top${e}`].length+(l[`top${r[t-1]}Num`]||0)})),l.otherTopNum=l.otherTop.length,l},getScoreRange(e,t,a=!1){let s=10*parseInt(e.score/10);a||10!=s||(s=9),a&&15==s&&(s=14);let l=s+9;t[`score${s}to${l}`]||(t[`score${s}to${l}`]=[]),t[`score${s}to${l}`].push(e),t[`score${s}to${l}Num`]=t[`score${s}to${l}`].length},onExport(){const e=this.tableHandle();this.baseExportExcel(e)},onAddTable(){const e={id:Date.now(),column:[],name:`${this.baseTable.name}-科目分析表`,className:this.baseTable.className,isCompare:!1,template:"sortTemplate",extend:{tableId:this.tableId}};this.$store.commit("addTable",e),this.$store.commit("setCurTableId",e.id),this.$emit("onAddTable")},tableHandle(){const e=[];this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((t=>{if("TR"!==t.tagName)return;let a={},s=t.childNodes[0].textContent.trim();"类别"!=s&&(a["类别"]=s,this.subjectList.forEach(((e,s)=>{a[e]=t.childNodes[s+1].textContent.trim()})),e.push(a))}));const t={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.baseTable.name}-科目分析表`,className:this.baseTable.className,isCompare:!1,isScore:!1,template:"sortTemplate"};return t},echartInit(){this.$nextTick((()=>{this.echartsScoreRegionInit(),this.echartsRangRegionInit(),this.echartsPassInit(),this.echartsexcellentInit()}))},typeChangeHandle(){this.sortObj?1==this.radio?this.destroyedEchart():this.echartInit():this.destroyedEchart()},echartsScoreNameInit(){this.echarts.sortScoreName=this.$echarts.init(document.getElementById("sortScoreName"));const e=this,t={title:{text:"成绩排序表"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"姓名",type:"category",data:this.scoreList.map((e=>e.name)),axisLabel:{interval:0,rotate:45}},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:[{name:"分数",data:this.scoreList.map((e=>e.score)),type:"line",markPoint:{data:[{type:"max",name:"最高分"},{type:"min",name:"最低分"}]},markLine:{data:[{type:"average",name:"平均分"}],label:{formatter(t){return`${t.name}：${t.value}\n均分人数：${e.sortObj.averageNum}`}}}}]};this.echarts.sortScoreName.setOption(t)},getSeriesData(e,t){return{name:t.scoreKey,data:this.sortObj[t.key]?this[e].map((e=>this.sortObj[t.key][e.key])):[],type:"bar",label:{show:!0}}},echartsScoreRegionInit(){const e=[],t={};this.subjectMap.forEach((a=>{t[a.scoreKey]=!1,e.push(this.getSeriesData("scoreRegionList",a))})),["语文","数学","英语"].forEach((e=>t[e]=!0)),this.echarts.scoreRegion=this.$echarts.init(document.getElementById("scoreRegion"));const a={title:{text:"成绩分析表"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{show:!0,left:"center",selected:t},grid:{true:!1},xAxis:{name:"分数",type:"category",data:this.scoreRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:20}},yAxis:{name:"人数",type:"value"},series:e};this.echarts.scoreRegion.setOption(a)},echartsRangRegionInit(){const e=[],t={};this.subjectMap.forEach((a=>{t[a.scoreKey]=!1,e.push(this.getSeriesData("rangRegionList",a))})),["语文","数学","英语"].forEach((e=>t[e]=!0)),this.echarts.scoreRegion=this.$echarts.init(document.getElementById("scoreRegion")),this.echarts.rangRegion=this.$echarts.init(document.getElementById("rangRegion"));const a={title:{text:"名次分析表"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{show:!0,left:"center",selected:t},xAxis:{name:"名次",type:"category",data:this.rangRegionList.map((e=>e.label)),axisLabel:{interval:0,rotate:0}},yAxis:{name:"人数",type:"value"},series:e};this.echarts.rangRegion.setOption(a)},echartsPassInit(){const e=[];this.subjectMap.forEach((t=>{this.sortObj[t.key]&&e.push({value:this.sortObj[t.key].passRate,name:t.scoreKey})})),this.echarts.pass=this.$echarts.init(document.getElementById("pass"));let t={title:{text:"及格率"},tooltip:{trigger:"item",formatter:"{b}：{c}%"},series:[{name:"人数",type:"pie",radius:["10%","60%"],avoidLabelOverlap:!0,label:{show:!0,position:"outside",formatter:"{b}：{c}%"},labelLine:{show:!0},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},data:e}],legend:{show:!0,zlevel:0,z:2,left:"center"}};this.echarts.pass.setOption(t)},echartsexcellentInit(){const e=[];this.subjectMap.forEach((t=>{this.sortObj[t.key]&&e.push({value:this.sortObj[t.key].excellentRate,name:t.scoreKey})})),this.echarts.excellent=this.$echarts.init(document.getElementById("excellent"));const t={title:{text:"优秀率"},tooltip:{trigger:"item",formatter:"{b}：{c}%"},series:[{name:"人数",type:"pie",radius:["10%","60%"],avoidLabelOverlap:!1,label:{show:!0,position:"outside",formatter:"{b}：{c}%"},labelLine:{show:!0},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},data:e}],legend:{show:!0,zlevel:0,z:2,left:"center"}};this.echarts.excellent.setOption(t)},destroyedEchart(){for(let e in this.echarts)this.echarts[e]&&this.echarts[e].dispose()},echartsResize(){setTimeout((()=>{for(let e in this.echarts)this.echarts[e]&&this.echarts[e].resize()}),500)}}},ne=ie,re=(0,i.Z)(ne,le,oe,!1,null,"44746a73",null),ce=re.exports,he=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scoreTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"left"},[t("base-class-setting",{ref:"setting",model:{value:e.curTable.className,callback:function(t){e.$set(e.curTable,"className",t)},expression:"curTable.className"}}),e.curTable.sortObj?[t("el-button",{staticClass:"btn",attrs:{type:"danger",plain:""},on:{click:function(t){e.compaseDialog.show=!0}}},[e._v(" 进退比较 ")]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 科目差值：折算名/段名 - 科目名 "),t("br"),e._v(" 优势科目：科目差值 > 50 "),t("br"),e._v(" 劣势科目：科目差值 < -50 ")]),t("el-button",{attrs:{type:"success",plain:""},on:{click:function(t){e.rankCompareDialog.show=!0}}},[e._v(" 优劣分析 ")])],1),t("el-button",{staticClass:"btn",attrs:{plain:"",type:"primary",size:"small"},on:{click:e.openSortDialog}},[e._v(" 科目分析 ")])]:e._e()],2),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1),t("base-export-btn",{attrs:{table:e.curTable,isExportBtn:!1,isMultiple:!0}})],1)]),2==e.radio?t("div",{staticClass:"echarts"},[t("el-checkbox-group",{staticClass:"nameCheck",attrs:{min:1},on:{change:e.nameCheckChange},model:{value:e.nameCheck,callback:function(t){e.nameCheck=t},expression:"nameCheck"}},e._l(e.nameList,(function(e){return t("el-checkbox",{key:e,staticStyle:{width:"70px"},attrs:{label:e,value:e}})})),1),e._m(0),e.isPreCompare?t("div",{staticClass:"echartitem",staticStyle:{width:"auto",height:"250px"},attrs:{id:"compare"}}):e._e()],1):t("base-table",{ref:"baseTable",attrs:{"table-height":e.tableHeight,table:e.curTable}}),e.sortCompareDialog.show?t("sort-dialog",{attrs:{curTable:e.curTable},on:{onClose:function(t){e.sortCompareDialog.show=!1}}}):e._e(),e.rankCompareDialog.show?t("rank-compare-dialog",{attrs:{curTable:e.curTable},on:{onClose:function(t){e.rankCompareDialog.show=!1}}}):e._e(),e.compaseDialog.show?t("compase-dialog",{attrs:{curTableId:e.curTable.id},on:{onClose:function(t){e.compaseDialog.show=!1}}}):e._e()],1)},ue=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"scoreName"}}),t("div",{staticClass:"echartitem",staticStyle:{width:"50%",height:"270px"},attrs:{id:"rankName"}})])}],me=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-class-setting"},[t("el-form",{ref:"form",attrs:{model:e.formData,inline:"","label-position":"left",rules:e.rules}},[t("el-form-item",{attrs:{label:e.label,prop:"className"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.changeHandle},model:{value:e.formData.className,callback:function(t){e.$set(e.formData,"className",t)},expression:"formData.className"}},e._l(e.classMap,(function(e){return t("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)],1)],1)],1)},de=[],be={name:"BaseClassSetting",props:{value:{type:String,default:""},label:{type:String,default:"班级"}},computed:{tables(){return this.$store.state.tables}},watch:{value:{handler(e){this.formData.className=e||""},immediate:!0}},data(){return{classMap:O,formData:{className:""},rules:{className:[{required:!0,message:"请设置班级"}]}}},methods:{changeHandle(e){this.$emit("input",e),this.$store.commit("setTables",this.tables)},async validate(){return await this.$refs.form.validate()}}},pe=be,fe=(0,i.Z)(pe,me,de,!1,null,"20d5425c",null),ge=fe.exports,ye=function(){var e=this,t=e._self._c;return e.dialogVisible?t("el-dialog",{staticClass:"sort-dialog",attrs:{visible:e.dialogVisible,title:"科目分析",width:"80%",top:"5vh","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("sort-template",{attrs:{tableId:e.curTable.id,isDialog:!0},on:{onAddTable:e.onClose}})],1):e._e()},ke=[],ve={name:"SortDialog",components:{SortTemplate:ce},mixins:[_],props:{curTable:{type:Object,require:!0}},data(){return{dialogVisible:!1}},created(){this.dialogVisible=!0},computed:{},methods:{onClose(){this.$emit("onClose")}}},xe=ve,Te=(0,i.Z)(xe,ye,ke,!1,null,"c245a7f8",null),Ce=Te.exports,Se=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"compare-dialog",attrs:{visible:e.dialogVisible,title:"名次比较设置","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:"","label-width":"80px"}},[t("el-form-item",{attrs:{label:"比较列",prop:"compareTh"}},[t("el-checkbox",{attrs:{indeterminate:e.checkData.compareThIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"compareTh")}},model:{value:e.checkData.compareThCheckAll,callback:function(t){e.$set(e.checkData,"compareThCheckAll",t)},expression:"checkData.compareThCheckAll"}},[e._v(" 全选 ")]),t("el-checkbox-group",{model:{value:e.formData.compareTh,callback:function(t){e.$set(e.formData,"compareTh",t)},expression:"formData.compareTh"}},e._l(e.thList,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1),e.compareTableDialog?t("el-dialog",{attrs:{title:"比较列表",width:"90%",visible:e.compareTableDialog,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.compareTableDialog=t}}},[t("base-export-btn",{attrs:{table:e.compareTable,isMultiple:!0}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:e.onAddList}},[e._v(" 添加到列表 ")]),t("base-table",{attrs:{table:e.compareTable}})],1):e._e()],1)},De=[],we={name:"CompareDialog",components:{BaseTable:C,BaseExportBtn:L},mixins:[_],props:{curTable:{type:Object,default(){return{}}}},data(){return{formData:{compareTh:[]},checkData:{compareThCheckAll:!1,compareThIndeterminate:!1},rules:{compareTh:[{required:!0,message:"请选择"}]},dialogVisible:!1,compareTableDialog:!1,compareTable:{}}},computed:{tables(){return this.$store.state.tables},subjectRankList(){return this.$store.getters.subjectRankList},thList(){return this.curTable.column}},created(){this.getBaseTable()},methods:{getBaseTable(){this.curTable.column.forEach((e=>{this.subjectRankList.includes(e)&&this.formData.compareTh.push(e)})),this.thList.includes("段名")&&this.formData.compareTh.push("段名"),this.dialogVisible=!0},handleCheckAllChange(e,t){this.formData[t]=e?this.thList:[],this.checkData[`${t}Indeterminate`]=!1},handleCheckChange(e,t){let a=e.length;this.checkData[`${t}CheckAll`]=a===this.thList.length,this.checkData[`${t}Indeterminate`]=a>0&&a<this.thList.length},async onSave(){await this.$refs.form.validate();let e=[];this.curTable.data.forEach((t=>{let a={},s=[],l=[],o=t["折算名"]||t["段名"]||null;for(let e in t)if(a[e]=t[e],t[e]&&this.formData.compareTh.includes(e)&&o&&!isNaN(t[e])){let i=z(o,t[e]);a[`${e.substr(0,1)}差`]=i,i>50?s.push(e):i<-50&&l.push(e)}a["优势"]=s.join("、"),a["劣势"]=l.join("、"),e.push(a)}));const t=Object.keys(e[0]);let a={name:`${this.curTable.name}-优劣分析`,data:e,id:Date.now(),column:t,className:`${this.curTable.className}`,isCompare:!0};this.compareTable=a,this.compareTableDialog=!0},onAddList(){this.$store.commit("addTable",this.compareTable),this.$store.commit("setCurTableId",this.compareTable.id),this.onClose()},onClose(){this.$emit("onClose")}}},Ne=we,$e=(0,i.Z)(Ne,Se,De,!1,null,"c67449c2",null),_e=$e.exports,Ee={name:"ScoreTemplate",components:{BaseClassSetting:ge,BaseTable:C,SortDialog:Ce,BaseExportBtn:L,RankCompareDialog:_e,CompaseDialog:Q},props:{tableHeight:{type:Number,default:500}},data(){return{sortCompareDialog:{show:!1},rankCompareDialog:{show:!1},compaseDialog:{show:!1},nameList:[],nameListObj:{},preNameListObj:{},radio:1,nameCheck:[],echartsScoreName:null,echartsRankName:null,echartsCompare:null,xAxisData:[],xAxisRankData:[],contentHeight:300}},computed:{...(0,M.rn)({tables:e=>e.tables,subjectMap:e=>e.subjectMap,isShowMenu:e=>e.isShowMenu}),...(0,M.Se)(["curTable","subjectList","subjectRankList"]),isPreCompare(){return this.curTable.isCompare&&this.curTable?.extend?.compareColumn}},watch:{"curTable.id":{handler(){this.dataInitHandle(),this.typeChangeHandle()},immediate:!0},isShowMenu(){this.echartsResize()}},mounted(){this.contentHeight=this.tableHeight-this.$el.childNodes[0].offsetHeight+50},destroyed(){this.destroyedEchart()},methods:{dataInitHandle(){this.nameCheck=[this.curTable.data[0]["姓名"]];let e={},t=[],a=[],s=[];this.curTable.data.forEach((a=>{let s=a["姓名"];e[s]=a,t.push(s)})),this.nameList=t,this.nameListObj=e,this.curTable.column.forEach((e=>{this.subjectList.includes(e)&&a.push(e)})),this.curTable.column.forEach((e=>{this.subjectRankList.includes(e)&&s.push(e)})),this.xAxisData=a,this.xAxisRankData=s,this.isPreCompare&&this.compareInitHandle()},compareInitHandle(){(this.curTable?.extend?.preTable.data||[]).forEach((e=>{this.preNameListObj[e["姓名"]]=e}))},async openSortDialog(){try{await this.$refs.setting.validate(),this.sortCompareDialog.show=!0}catch(e){console.log(e),this.$message.error("请先设置班级")}},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},destroyedEchart(){["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].dispose()}))},echartsResize(){setTimeout((()=>{["echartsScoreName","echartsRankName","echartsCompare"].forEach((e=>{this[e]&&this[e].resize()}))}),500)},echartInit(){this.$nextTick((()=>{this.echartsScoreInit(),this.echartsRankInit(),this.echartsCompareInit()}))},nameCheckChange(e){this.nameCheck=e.splice(1,1);const t=this.getSeries();this.echartsScoreName.setOption({series:t.score});const a=J(t.rank[0].data);if(this.echartsRankName.setOption({series:t.rank,yAxis:{min:a}}),this.isPreCompare){const{series:e}=this.getCompaseConfig(),t=J([...e[0].data,...e[1].data]);this.echartsCompare.setOption({series:e,yAxis:{min:t}})}},getSeries(){let e={score:[],rank:[]};return this.nameCheck.forEach((t=>{let a={name:this.curTable.name,type:"line",label:{show:!0},data:[]},s={name:this.curTable.name,type:"line",label:{show:!0},data:[]},l=this.nameListObj[t];this.xAxisData.forEach((e=>{a.data.push(l[e])})),this.xAxisRankData.forEach((e=>{s.data.push(l[e])})),l["折算名"]?s.markLine={data:[{name:"折算名",yAxis:l["折算名"]}]}:l["段名"]&&(s.markLine={data:[{name:"段名",yAxis:l["段名"]}]}),s.markLine&&(s.markLine.label={show:!0,formatter:"{b}:{c}"}),e.score.push(a),e.rank.push(s)})),e},echartsScoreInit(){let{score:e}=this.getSeries();this.echartsScoreName=this.$echarts.init(document.getElementById("scoreName"));const t={title:{text:"成绩表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",data:this.xAxisData},yAxis:{name:"分数",type:"value",nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsScoreName.setOption(t)},echartsRankInit(){let{rank:e}=this.getSeries();const t=J(e[0].data);this.echartsRankName=this.$echarts.init(document.getElementById("rankName"));const a={title:{text:"名次表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",position:"top",data:this.xAxisRankData},yAxis:{min:t,name:"名次",type:"value",inverse:!0,nameTextStyle:{padding:[0,50,5,0]}},series:e};this.echartsRankName.setOption(a)},getCompaseConfig(){let e=this.curTable.extend.preTable,t=[{name:this.curTable.name,type:"line",label:{show:!0},data:[]},{name:e.name,type:"line",label:{show:!0},data:[]}],a=this.curTable.extend.compareColumn;const s=this.nameCheck[0];let l=this.nameListObj[s],o=this.preNameListObj[s];return a.forEach((e=>{l&&t[0].data.push(l[e]),o&&t[1].data.push(o[e])})),{series:t,xAxis:a}},echartsCompareInit(){if(!this.isPreCompare)return;let{xAxis:e,series:t}=this.getCompaseConfig();this.echartsCompare=this.$echarts.init(document.getElementById("compare"));const a={title:{text:"比较表",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"科目",type:"category",position:"top",data:e},yAxis:{name:"名次",type:"value",inverse:!0,nameTextStyle:{padding:[0,50,5,0]}},series:t};this.echartsCompare.setOption(a)}}},je=Ee,Ie=(0,i.Z)(je,he,ue,!1,null,"4886518a",null),Le=Ie.exports,Re=function(){var e=this,t=e._self._c;return t("div",{staticClass:"totalSortTemplate"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.subjectName,callback:function(t){e.subjectName=t},expression:"subjectName"}},e._l(e.subjectList,(function(e){return t("el-tab-pane",{key:e,attrs:{label:e,name:e}})})),1),t("div",{staticClass:"btns"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")]),e.isDialog?t("el-button",{attrs:{type:"danger"},on:{click:e.onAddTable}},[e._v(" 添加到列表 ")]):e._e()],1),e.dataObj?t("el-table",{attrs:{data:e.scoreTable,border:"",height:e.tableHeight}},[t("el-table-column",{attrs:{label:e.subjectName,prop:"label",width:"100",align:"center"}}),t("el-table-column",{attrs:{label:"年段",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.dataObj.all[t.key])+" ")]}}],null,!1,3958705334)}),e._l(e.classTables,(function(a){return[t("el-table-column",{key:a.id,attrs:{label:a.className,align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.dataObj[a.className][t.key])+" ")]}}],null,!0)})]}))],2):e._e()],1)},Me=[],Ae={name:"TotalSortTemplate",mixins:[_],props:{classes:{type:Array,default(){return[]}},tableHeight:{type:Number,default:450},isDialog:{type:Boolean,default:!1}},watch:{},computed:{tables(){return this.$store.state.tables},isShowMenu(){return this.$store.state.isShowMenu},subjectList(){return this.$store.getters.subjectList},subjectObj(){return this.$store.getters.subjectObj}},data(){return{subConfig:{},is150:!1,classTables:[],subjectName:"",scoreTable:{},scoreRegionList:[],otherList:[{label:"最高分",value:0,key:"maxScore",isName:!0},{label:"最低分",value:0,key:"minScore",isName:!0},{label:"不及格数",value:0,key:"noPassNum",isName:!0},{label:"及格数",value:0,key:"passNum",isName:!0},{label:"及格率%",value:0,key:"passRate"},{label:"优秀数",value:0,key:"excellentNum",isName:!0},{label:"优秀率%",value:0,key:"excellentRate"},{label:"与考人数",value:0,key:"peopleNum"}],rangRegionList:[],averageList:[{label:"平均分",value:0,key:"average"},{label:"均分人数",value:0,key:"averageNum",isName:!0}],dataObj:null,isTable:!0}},created(){this.subjectName=this.subjectList[0],this.getTables()},methods:{getTables(){let e=[];if(this.classes.forEach((t=>{let a=this.tables.find((e=>e.id==t));a?e.push(a):this.isTable=!1})),!this.isTable)return F(),!1;this.classTables=e,this.getRowName()},getRowName(){if(!this.isTable)return!1;this.subConfig=this.subjectObj[this.subjectName],this.is150=150==this.subConfig.fullScore;let e=this.getScoreRegionList(),t=this.getRangRegionList();this.scoreTable=[...e,...this.otherList,...t,...this.averageList],this.init()},getScoreRegionList(){let e=[];for(let t=14;t>=0;t--){let a=10*t,s=a+9;e.push({label:`${a}-${s}`,value:0,key:`score${a}to${s}Num`,isName:!0})}return this.is150?e[0].label="140-150":(e.splice(0,5),e[0].label="90-100"),e},getRangRegionList(){let e=[{label:"前10名",value:0,key:"top10Num",isAdd:!0,isName:!0}];for(let t=50;t<=400;t+=50)e.push({label:`前${t}名`,value:0,key:`top${t}Num`,isAdd:!0,isName:!0});return e.push({label:"400名后",value:0,key:"otherTopNum",isName:!0}),e},init(){let e={};this.classTables.forEach((t=>{e[t.className]=this.classDataHandle(t)})),this.getTotalData(e),this.dataObj=e},classDataHandle(e){const t=e.sortObj[this.subConfig.scoreKey],a=e.sortObj[this.subConfig.rankKey];if(!t||!a)return{};let s={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,maxScore:0,minScore:0,pass:[],passNum:0,noPass:[],noPassNum:0,passRate:0,excellent:[],excellentNum:0,excellentRate:0,peopleNum:t.length,top10:[],top50:[],top100:[],top150:[],top200:[],top250:[],top300:[],top350:[],top400:[],otherTop:[],average:0,averageList:[],averageNum:0},l=0,o=.6*this.subConfig.fullScore,i=.85*this.subConfig.fullScore;t.forEach((e=>{this.getScoreRange(e,s),l+=e.score,e.score>s.maxScore&&(s.maxScore=e.score),e.score<s.minScore&&(s.minScore=e.score),e.score>=o?s.pass.push(e):s.noPass.push(e),e.score>=i&&s.excellent.push(e)})),s.passNum=s.pass.length,s.noPassNum=s.noPass.length,s.passRate=(s.passNum/s.peopleNum*100).toFixed(2),s.excellentNum=s.excellent.length,s.excellentRate=(s.excellentNum/s.peopleNum*100).toFixed(2),s.average=(l/s.peopleNum).toFixed(2),t.forEach((e=>{e.score>=s.average&&s.averageList.push(e)})),s.averageNum=s.averageList.length,a.forEach((e=>{e.score>0&&e.score<=10?s.top10.push(e):e.score>10&&e.score<=50?s.top50.push(e):e.score>50&&e.score<=100?s.top100.push(e):e.score>100&&e.score<=150?s.top150.push(e):e.score>150&&e.score<=200?s.top200.push(e):e.score>200&&e.score<=250?s.top250.push(e):e.score>250&&e.score<=300?s.top300.push(e):e.score>300&&e.score<=350?s.top350.push(e):e.score>350&&e.score<=400?s.top400.push(e):s.otherTop.push(e)}));let n=[10,50,100,150,200,250,300,350,400];return n.forEach(((e,t)=>{s[`top${e}Num`]=s[`top${e}`].length+(s[`top${n[t-1]}Num`]||0)})),s.otherTopNum=s.otherTop.length,s},getScoreRange(e,t){let a=10*parseInt(e.score/10);this.is150||10!=a||(a=9),this.is150&&15==a&&(a=14);let s=a+9;t[`score${a}to${s}`]||(t[`score${a}to${s}`]=[]),t[`score${a}to${s}`].push(e),t[`score${a}to${s}Num`]=t[`score${a}to${s}`].length},getTotalData(e){let t={score0to9Num:0,score10to19Num:0,score20to29Num:0,score30to39Num:0,score40to49Num:0,score50to59Num:0,score60to69Num:0,score70to79Num:0,score80to89Num:0,score90to99Num:0,score100to109Num:0,score110to119Num:0,score120to129Num:0,score130to139Num:0,score140to149Num:0,passNum:0,noPassNum:0,passRate:0,excellentNum:0,excellentRate:0,peopleNum:0,top10Num:0,top50Num:0,top100Num:0,top150Num:0,top200Num:0,top250Num:0,top300Num:0,top350Num:0,top400Num:0,otherTopNum:0,average:0,averageNum:0},a=0,s=0,l=0;for(let o in e){a++;for(let a in t)t[a]+=parseFloat(e[o][a])||0;s<e[o].maxScore&&(s=e[o].maxScore),l>e[o].minScore&&(l=e[o].minScore)}t.maxScore=s,t.minScore=l,["passRate","excellentRate","average"].forEach((e=>{t[e]=(t[e]/a).toFixed(2)})),e.all=t},handleClick(){this.getRowName()},onExport(){const e=this.tableHandle();this.baseExportExcel(e)},onAddTable(){const e=this.tableHandle();this.$store.commit("addTable",e),this.$store.commit("setCurTableId",e.id),this.$emit("onAddTable")},tableHandle(){const e=[],t=this.classTables.map((e=>e.className));this.$el.getElementsByTagName("table")[1].childNodes[1].childNodes.forEach((a=>{if("TR"!==a.tagName)return;let s={},l=a.childNodes[0].textContent;l!=this.subjectName&&(s[this.subjectName]=l,s["年段"]=a.childNodes[1].textContent.trim(),t.forEach(((e,t)=>{s[e]=a.childNodes[t+2].textContent.trim()})),e.push(s))}));const a={id:Date.now(),column:Object.keys(e[0]),data:e,name:`${this.subjectName}-年段分析表`,className:"年段",isCompare:!1,template:"totalSortTemplate",extend:{classes:this.classes}};return a}}},Oe=Ae,Be=(0,i.Z)(Oe,Re,Me,!1,null,"70df7bad",null),He=Be.exports,Ke=function(){var e=this,t=e._self._c;return t("div",{staticClass:"studentScoreTemplate"},[t("div",{staticClass:"btns"},[t("div",{staticClass:"name"},[t("el-checkbox-group",{staticClass:"nameCheck",attrs:{min:1},on:{change:e.nameCheckChange},model:{value:e.nameCheck,callback:function(t){e.nameCheck=t},expression:"nameCheck"}},e._l(e.defaultTable.data,(function(e){return t("el-checkbox",{key:e["姓名"],staticStyle:{width:"70px"},attrs:{label:e["姓名"],value:e["姓名"]}})})),1)],1),t("div",{staticClass:"right"},[t("el-radio-group",{on:{change:e.typeChangeHandle},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[t("el-radio-button",{attrs:{label:1}},[e._v("表格")]),t("el-radio-button",{attrs:{label:2}},[e._v("图表")])],1),t("br"),t("div",[t("base-score-analyse-btn",{staticClass:"btn",attrs:{btnName:"修改",table:e.curTable}}),t("base-echart-download-btn",{ref:"downloadBtn",attrs:{name:e.nameCheck[0],table:e.table,radio:e.radio},on:{batchDownload:e.batchDownload}})],1)],1)]),t("div",{staticClass:"content",style:{height:`${e.contentHeight}px`}},[1==e.radio?t("base-table",{ref:"baseTable",attrs:{"table-height":e.contentHeight,table:e.table,fixedCol:e.nameCheck}}):e._e(),2==e.radio?t("div",[t("div",{staticClass:"echarts",attrs:{id:"echarts"}},[e.isShowEhart.name?t("p",{staticClass:"nameTitle"},[e._v(e._s(e.nameCheck[0]))]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart.reducedRank,expression:"isShowEhart.reducedRank"}],staticClass:"echartitem",staticStyle:{width:"100%",height:"250px"},attrs:{id:"reducedRank"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart.totalRank,expression:"isShowEhart.totalRank"}],staticClass:"echartitem",staticStyle:{width:"48%",height:"250px"},attrs:{id:"totalRank"}}),e._l(e.subjectMap,(function(a){return[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowEhart[a.key],expression:"isShowEhart[item.key]"}],key:a.key,staticClass:"echartitem",staticStyle:{width:"48%",height:"250px"},attrs:{id:a.key}})]}))],2)]):e._e()],1),e.downloadLoading?t("div",{staticClass:"downloadClose"},[t("el-button",{attrs:{type:"danger"},on:{click:function(t){e.isCancelDownload=!0}}},[e._v(" 取消下载 ")])],1):e._e()])},Pe=[],Ve=a(2269),ze=a.n(Ve),Ze=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseScoreAnalyseBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" "+e._s(e.btnName)+" ")]),t("el-dialog",{attrs:{title:"成绩分析",visible:e.visiableDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visiableDialog=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"表格"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"","collapse-tags":"",placeholder:"请选择",clearable:""},on:{change:e.onSelectHandle},model:{value:e.formData.selectTablesId,callback:function(t){e.$set(e.formData,"selectTablesId",t)},expression:"formData.selectTablesId"}},e._l(e.options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-button",{attrs:{type:"primary"},on:{click:e.onAll}},[e._v("全选")])],1),t("div",[e._v(" 已选择： "),t("el-table",{attrs:{data:e.selectTables,height:300,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",align:"center"}}),t("el-table-column",{attrs:{label:"班级",prop:"className",width:"70",align:"center"}}),t("el-table-column",{attrs:{label:"表名",prop:"name"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:a,$index:s}){return[t("el-link",{attrs:{type:"danger",icon:"el-icon-delete-solid"},on:{click:function(t){return e.onDelect(a.id,s)}}})]}}])})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确定")])],1)],1),e.tableDialog?t("el-dialog",{attrs:{title:"成绩分析",visible:e.tableDialog,width:"80%",top:"10vh"},on:{"update:visible":function(t){e.tableDialog=t}}},[t("student-score-template",{attrs:{selectTablesId:e.formData.selectTablesId,isDialog:!0},on:{onAddTable:function(t){e.tableDialog=!1,e.visiableDialog=!1}}})],1):e._e()],1)},qe=[],Fe={name:"BaseMulClassAnalyseBtn",mixins:[_],components:{StudentScoreTemplate:ot},props:{btnName:{type:String,default:"成绩分析"},table:{type:Object,default(){return null}}},computed:{tables(){return this.$store.state.tables},options(){return this.tables.filter((e=>e.sortObj))}},data(){return{tableDialog:!1,visiableDialog:!1,selectTables:[],formData:{name:"成绩分析",selectTablesId:[]},rules:{name:[{required:!0,message:"请输入"}],selectTablesId:[{required:!0,message:"请选择"}]}}},created(){if(this.table){this.formData.name=this.table.name;let e=[],t=[];this.table.extend.selectTablesId.forEach((a=>{let s=this.tables.find((e=>e.id==a));s&&(t.push(a),e.push(s))})),this.selectTables=e,this.formData.selectTablesId=t}},methods:{async onSave(){try{await this.$refs.form.validate();let e=this.selectTables.find((e=>!e.className));if(e)return this.$message.error(`请设置【${e.name}】的班级`),!1;let t=this.selectTables[0].className;if(this.selectTables.find((e=>e.className!==t)))return this.$message.error("班级不唯一，请调整"),!1;const a={name:this.formData.name,id:Date.now(),column:[],className:t,isCompare:!0,template:"studentScoreTemplate",extend:{selectTablesId:this.formData.selectTablesId}};if(this.table?.id){let e=null;this.tables.find(((t,a)=>{if(t.id==this.table.id)return e=a,!0})),this.tables[e]=a,this.$store.commit("setTables",this.tables),this.$store.commit("setCurTableId",a.id)}else this.$store.commit("addTable",a),this.$store.commit("setCurTableId",a.id);this.visiableDialog=!1,this.onClose()}catch(e){console.log(e)}},onAll(){this.formData.selectTablesId=this.options.map((e=>e.id)),this.onSelectHandle()},onDelect(e,t){this.formData.selectTablesId.splice(this.formData.selectTablesId.indexOf(e),1),this.selectTables.splice(t,1)},onSelectHandle(){this.selectTables=this.tables.filter((e=>this.formData.selectTablesId.includes(e.id)))},onClose(){this.formData.selectTablesId=[],this.selectTables=[]}}},Je=Fe,Ue=(0,i.Z)(Je,Ze,qe,!1,null,"d5d0af38",null),We=Ue.exports,Ge=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseEchartDownLoadBtn"},[t("el-dropdown",{attrs:{"split-button":"",type:"primary",disabled:e.disabledBtn},on:{click:e.onDownload,command:e.handleCommand}},[e._v(" 下载 "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"batch"}},[e._v("一键下载")])],1)],1),t("el-button",{staticStyle:{"margin-left":"-2px","border-radius":"0 3px 3px 0",padding:"0px 5px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.downloadVisiable=!0}}},[t("i",{staticClass:"el-icon-s-tools",staticStyle:{"font-size":"17px","flex-shrink":"1"}})]),t("el-dialog",{attrs:{title:"下载设置",visible:e.downloadVisiable},on:{"update:visible":function(t){e.downloadVisiable=t}}},[t("el-form",{attrs:{model:e.formData}},[t("el-form-item",{attrs:{label:"打印列名"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminateColmn},on:{change:e.handleCheckAllColumnChange},model:{value:e.checkAllColumn,callback:function(t){e.checkAllColumn=t},expression:"checkAllColumn"}},[e._v(" 全选 ")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedColumnChange},model:{value:e.formData.checkedColumn,callback:function(t){e.$set(e.formData,"checkedColumn",t)},expression:"formData.checkedColumn"}},e._l(e.columnTh,(function(a){return t("el-checkbox",{key:a,attrs:{label:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("el-form-item",{attrs:{label:"打印图表"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v(" 全选 ")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.formData.checkedSubject,callback:function(t){e.$set(e.formData,"checkedSubject",t)},expression:"formData.checkedSubject"}},e._l(e.options,(function(a){return t("el-checkbox",{key:a.key,attrs:{label:a.key}},[e._v(" "+e._s(a.rankKey)+" ")])})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.downloadVisiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确 定")])],1)],1)],1)},Qe=[],Xe={name:"BaseEchartDownLoadBtn",mixins:[_],props:{name:{type:String,required:!0},table:{type:Object,required:!0},radio:{type:Number,required:!0}},data(){return{disabledBtn:!1,downloadVisiable:!1,formData:{checkedColumn:[],checkedSubject:[]},checkAll:!0,options:[{name:"折算名",rankKey:"折算名",key:"reducedRank"},{name:"段名",rankKey:"段名",key:"totalRank"}],isIndeterminate:!0,isIndeterminateColmn:!0,checkAllColumn:!1}},computed:{...(0,M.rn)({subjectMap:e=>e.subjectMap,downloadSetting:e=>e.downloadSetting}),...(0,M.Se)(["subjectList"]),columnTh(){return this.table.column.filter(((e,t)=>0!==t))}},created(){this.options.push(...this.subjectMap),this.openHandle()},methods:{openHandle(){this.downloadSetting?(this.formData.checkedColumn=[...this.downloadSetting.checkedColumn],this.formData.checkedSubject=this.downloadSetting.checkedSubject):(this.table.column.forEach((e=>{this.subjectList.includes(e)||this.formData.checkedColumn.push(e)})),this.formData.checkedColumn.splice(0,1),this.handleCheckAllChange(!0))},handleCheckAllChange(e){this.formData.checkedSubject=e?this.options.map((e=>e.key)):[],this.isIndeterminate=!1},handleCheckAllColumnChange(e){this.formData.checkedColumn=e?this.columnTh:[],this.isIndeterminateColumn=!1},handleCheckedChange(e){let t=e.length;this.checkAll=t===this.options.length,this.isIndeterminate=t>0&&t<this.options.length},handleCheckedColumnChange(e){let t=e.length;this.checkAllColumn=t===this.columnTh.length,this.isIndeterminateColumn=t>0&&t<this.columnTh.length},onPrint(){window.print()},onSave(){this.$store.commit("setDownloadSetting",this.formData),this.downloadVisiable=!1},getDownloadData(e=this.table,t=this.name){let a=[t,...this.formData.checkedColumn],s=[],l=[{hpx:24}];e.data.forEach((e=>{l.push({hpx:24});let t={};for(let s in e)a.includes(s)&&(t[s]=e[s]);s.push(t)}));const o={"折算名":6,"优势":18,"劣势":18},i=a.map((e=>o[e]?{wch:o[e]}:{wch:4}));return i[0].wch=8,{name:e.name,className:e.className,column:a,data:s,sheet:{cols:i},isCompare:!0}},downloadTable(){let e=this.getDownloadData();this.baseExportExcel(e),this.disabledBtn=!1},onDownload(){if(this.disabledBtn=!0,1===this.radio)return void this.downloadTable();let e={};this.options.forEach((t=>{this.formData.checkedSubject.includes(t.key)?e[t.key]=!0:e[t.key]=!1})),e.name=!0,this.$parent.isShowEhart=e,this.$nextTick((()=>{ze()(document.getElementById("echarts")).then((t=>{var a=t.toDataURL("image/png").replace("image/png","image/octet-stream"),s=document.createElement("a");s.download=`${this.name}-成绩分析.png`,s.href=a,document.body.appendChild(s),s.click(),s.remove();for(let l in e)e[l]=!0;e.name=!1,this.$parent.isShowEhart=e,this.disabledBtn=!1}))}))},async handleCommand(e){switch(this.disabledBtn=!0,e){case"batch":this.$emit("batchDownload");break}},onBatchDownLoadTable(e={}){const t=[];e.sheets.forEach((e=>{t.push(this.getDownloadData(e,e.extends.name))})),e.sheets=t,this.baseExportMulSheetExcel(e),this.disabledBtn=!1}}},Ye=Xe,et=(0,i.Z)(Ye,Ge,Qe,!1,null,"6fb96a93",null),tt=et.exports,at={name:"StudentScoreTemplate",components:{BaseTable:C,BaseScoreAnalyseBtn:We,BaseEchartDownloadBtn:tt},props:{selectTablesId:{type:Array,default(){return[]}},tableHeight:{type:Number,default:450}},watch:{curTableId:{handler(){this.getTables()}},isShowMenu(){this.echartsResize()}},computed:{...(0,M.rn)({tables:e=>e.tables,curTableId:e=>e.curTableId,subjectMap:e=>e.subjectMap,isShowMenu:e=>e.isShowMenu,downloadSetting:e=>e.downloadSetting}),...(0,M.Se)(["curTable"])},mounted(){this.contentHeight=this.tableHeight-this.$el.childNodes[0].offsetHeight+55},data(){return{radio:2,nameCheck:[],nameList:[],selectTables:[],defaultTable:[],column:[],contentHeight:500,table:{},xAxisData:[],zsmSeries:{},echarts:{reducedRank:null,totalRank:null},isShowEhart:{reducedRank:!0,totalRank:!0},downloadLoading:null,isCancelDownload:!1}},created(){this.subjectMap.forEach((e=>{this.$set(this.echarts,e.key,null),this.$set(this.isShowEhart,e.key,!0)})),this.getTables()},destroyed(){this.destroyedEchart()},methods:{getTables(){let e=!0,t=[];if(this.selectTablesId.find((a=>{let s=this.tables.find((e=>e.id==a));if(!s)return e=!1,F(),!0;t.push(s)})),!e)return!1;this.selectTables=t,this.getInit(t)},getInit(e){this.defaultTable=e[0],this.nameCheck=[this.defaultTable.data[0]["姓名"]],this.getColumn(),this.getTable()},getColumn(){this.column=this.subjectMap.reduce(((e,t)=>(e.push(t.scoreKey),e.push(t.rankKey),e.push(`${t.rankKey.substr(0,1)}差`),e)),[]),this.column.push("总分","段名","段差","折总","折算名","优势","劣势")},getTableData(e=this.selectTables,t=this.nameCheck[0]){let a=[],s=[];return e.forEach((e=>{s.push(e.name);let l=e.data.find((e=>e["姓名"]==t))||{},o={};o[t]=e.name;let i=l["折算名"]||l["段名"]||null,n={"优势":[],"劣势":[]};this.subjectMap.forEach((e=>{let t=l[e.rankKey]?z(i,l[e.rankKey]):null;n[`${e.rankKey.substr(0,1)}差`]=t,t>50?n["优势"].push(e.scoreKey):t<-50&&n["劣势"].push(e.scoreKey)})),n["段差"]=l["段名"]?z(i,l["段名"]):null,n["优势"]=n["优势"].join("、"),n["劣势"]=n["劣势"].join("、"),this.column.forEach((e=>{o[e]=l[e]||n[e]||""})),a.push(o)})),this.xAxisData=s,{name:`${t}-成绩分析`,id:Date.now(),data:a,column:Object.keys(a[0]),isCompare:!0,className:this.defaultTable.className,extends:{name:t}}},getTable(e=this.selectTables,t=this.nameCheck[0]){this.table=this.getTableData(e,t),this.getZsmData(),this.typeChangeHandle()},getZsmData(){this.zsmSeries=this.getSeries("折算名")},nameCheckChange(e){this.nameCheck=e.splice(1,1),this.getTable()},typeChangeHandle(){1==this.radio?this.destroyedEchart():this.echartInit()},destroyedEchart(){for(let e in this.echarts)this.echarts[e]&&(this.echarts[e].dispose(),this.echarts[e]=null)},echartInit(){this.$nextTick((()=>{this.isShowEhart.reducedRank&&this.echartsReducedRankInit(),this.isShowEhart.totalRank&&this.echartsInitHandle({name:"段名",key:"totalRank",rankKey:"段名"}),this.subjectMap.forEach((e=>{this.isShowEhart[e.key]&&this.echartsInitHandle(e)}))}))},getSeries(e){const t=this.table.data.map((t=>t[e]));return{name:e,type:"line",label:{show:!0},data:t}},echartsReducedRankInit(){let e=J(this.zsmSeries.data);const t={name:"名次",min:e,type:"value",inverse:!0};if(this.echarts.reducedRank)return void this.echarts.reducedRank.setOption({series:this.zsmSeries,yAxis:t});this.echarts.reducedRank=this.$echarts.init(document.getElementById("reducedRank"));const a={title:{text:"折算名分析",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",data:this.xAxisData,position:"top"},yAxis:t,series:this.zsmSeries};this.echarts.reducedRank.setOption(a)},echartsSummaryInit(){let e=[this.getSeries("段名")];if(this.subjectMap.forEach((t=>{e.push(this.getSeries(t.rankKey))})),this.echarts.summary)return void this.echarts.summary.setOption({series:e});this.echarts.summary=this.$echarts.init(document.getElementById("summary"));const t={title:{text:"汇总分析",textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",data:this.xAxisData,position:"top"},yAxis:{name:"名次",type:"value",inverse:!0},series:e};this.echarts.summary.setOption(t)},echartsInitHandle(e){let t=[this.getSeries(e.rankKey)];t.push(this.zsmSeries);let a=J([...t[0].data,...t[1].data]);if(this.echarts[`${e.key}`])return void this.echarts[`${e.key}`].setOption({yAxis:{min:a},series:t});this.echarts[`${e.key}`]=this.$echarts.init(document.getElementById(e.key));const s={title:{text:`${e.rankKey}分析`,textStyle:{fontSize:"14px",lineHeight:30}},grid:{top:75,bottom:35},legend:{show:!0,left:"center",selected:{"折算名":!1}},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:{name:"表名",type:"category",position:"top",data:this.xAxisData},yAxis:{name:"名次",min:a,type:"value",inverse:!0},series:t};this.echarts[`${e.key}`].setOption(s)},echartsResize(){setTimeout((()=>{for(let e in this.echarts)this.echarts[e].resize()}),500)},async batchDownload(){if(1==this.radio){const e={name:`${this.defaultTable.className}-学生成绩分析表`,id:Date.now(),className:this.defaultTable.className,sheets:[]};this.defaultTable.data.forEach((t=>{const a=t["姓名"];a&&e.sheets.push(this.getTableData(this.selectTables,a))})),this.$refs.downloadBtn.onBatchDownLoadTable(e)}else try{this.downloadLoading=this.$loading({lock:!0,text:"正在拼命下载中......",spinner:"el-icon-loading",fullscreen:!0,background:"rgba(0, 0, 0, 0.7)"}),this.isShowEhart.name=!0;for(let t in this.echarts)this.downloadSetting.checkedSubject.includes(t)||(this.isShowEhart[t]=!1);let e=this.defaultTable.data;for(let t=0;t<e.length;t++){if(this.isCancelDownload)return;const a=e[t],s=a["姓名"];this.getTable(this.selectTables,s),await this.downloadEchart(s)}}finally{for(let e in this.isShowEhart)this.isShowEhart[e]=!0;this.isShowEhart.name=!1,this.$nextTick((()=>{this.getTable(),this.isCancelDownload=!1,this.downloadLoading.close(),this.downloadLoading=null,this.$refs.downloadBtn.disabledBtn=!1}))}},downloadEchart(e){return new Promise((t=>{this.$nextTick((()=>{ze()(document.getElementById("echarts")).then((a=>{var s=a.toDataURL("image/png").replace("image/png","image/octet-stream"),l=document.createElement("a");l.download=`${e}-成绩分析.png`,l.href=s,document.body.appendChild(l),l.click(),l.remove(),t()}))}))}))}}},st=at,lt=(0,i.Z)(st,Ke,Pe,!1,null,"291e7338",null),ot=lt.exports,it=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseMulSheetExportBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" 合表导出 ")]),t("el-dialog",{attrs:{title:"分表导出",visible:e.visiableDialog,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.visiableDialog=t}}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-table",{attrs:{data:e.formData.tables,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"70"}}),t("el-table-column",{attrs:{label:"sheet名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.name`,rules:e.rules.tableName}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.tableChangeHandle(t,a)}},model:{value:e.formData.tables[a].name,callback:function(t){e.$set(e.formData.tables[a],"name",t)},expression:"formData.tables[$index].name"}},e._l(e.tables,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"列名"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("el-form-item",{attrs:{prop:`tables.${a}.column`,rules:e.rules.tableColumn}},[t("el-checkbox-group",{model:{value:e.formData.tables[a].column,callback:function(t){e.$set(e.formData.tables[a],"column",t)},expression:"formData.tables[$index].column"}},e._l(e.formData.tables[a].th,(function(e){return t("el-checkbox",{key:e,attrs:{label:e}})})),1)],1)]}}])}),t("el-table-column",{attrs:{width:"100",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.formData.tables.push({name:"",column:[]})}}},[e._v(" 添加 ")])]},proxy:!0},{key:"default",fn:function({$index:a}){return[t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.onDelect(a)}}},[e._v(" 删除 ")])]}}])})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onExport}},[e._v("导出")])],1)],1)],1)},nt=[],rt={name:"BaseMulSheetExportBtn",mixins:[_],computed:{tables(){return this.$store.state.tables}},data(){return{visiableDialog:!1,formData:{name:"",tables:[{name:"",column:[]}]},rules:{name:[{required:!0,message:"请输入"}],tableName:[{required:!0,message:"请选择"}],tableColumn:[{required:!0,message:"请选择"}]}}},methods:{tableChangeHandle(e,t){const a=this.tables.find((t=>t.id===e));this.formData.tables[t].table=a,this.formData.tables[t].th=a.column,this.formData.tables[t].column=a.column},onDelect(e){this.formData.tables.splice(e,1)},async onExport(){try{await this.$refs.form.validate();let e=[];this.formData.tables.forEach((t=>{let a={id:t.table.id,className:t.table.className,isCompare:t.table.isCompare||!1,data:[],column:t.column,name:t.table.name};t.table.data.forEach((e=>{let s={};for(const a in e)t.column.includes(a)&&(s[a]=e[a]);a.data.push(s)})),e.push(a)}));const t={name:this.formData.name,sheets:e};this.baseExportMulSheetExcel(t)}catch(e){console.log(e)}}}},ct=rt,ht=(0,i.Z)(ct,it,nt,!1,null,"f1111b88",null),ut=ht.exports,mt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseMulClassAnalyseBtn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.visiableDialog=!0}}},[e._v(" 年段分析 ")]),t("el-dialog",{attrs:{title:"年段分析",visible:e.visiableDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visiableDialog=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,inline:""}},[t("el-form-item",{attrs:{label:"表名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"班级",prop:"classes"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"","collapse-tags":"",placeholder:"请选择","value-key":"id",clearable:"","multiple-limit":14},model:{value:e.formData.classes,callback:function(t){e.$set(e.formData,"classes",t)},expression:"formData.classes"}},e._l(e.options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1),t("div",[e._v(" 已选择： "),e._l(e.formData.classes,(function(a,s){return t("span",{key:a.id},[e._v(" "+e._s(a.name)+"【"+e._s(a.className||"未知")+"】 "),s!==e.formData.classes.length-1?t("span",[e._v("、")]):e._e()])}))],2)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确定")])],1)],1),e.tableDialog?t("el-dialog",{attrs:{title:"年段分析",visible:e.tableDialog,width:"80%",top:"10vh"},on:{"update:visible":function(t){e.tableDialog=t}}},[t("total-sort-template",{attrs:{classes:e.formData.classes.map((e=>e.id)),isDialog:!0},on:{onAddTable:function(t){e.tableDialog=!1,e.visiableDialog=!1}}})],1):e._e()],1)},dt=[],bt={name:"BaseMulClassAnalyseBtn",mixins:[_],components:{TotalSortTemplate:He},computed:{tables(){return this.$store.state.tables},options(){return this.tables.filter((e=>e.sortObj))}},data(){return{tableDialog:!1,visiableDialog:!1,formData:{name:"年段分析",classes:[]},rules:{name:[{required:!0,message:"请输入"}],classes:[{required:!0,message:"请选择"}]}}},methods:{async onSave(){try{await this.$refs.form.validate();let e=this.formData.classes.find((e=>!e.className));if(e)return this.$message.error(`请设置【${e.name}】的班级`),!1;if(P(this.formData.classes.map((e=>e.className))))return this.$message.error("班级重复，请确认"),!1;this.tableDialog=!0}catch(e){console.log(e)}},onClose(){this.formData.classes=[]}}},pt=bt,ft=(0,i.Z)(pt,mt,dt,!1,null,"3392b1e4",null),gt=ft.exports,yt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"baseSettingBtn"},[t("el-link",{on:{click:function(t){e.dialogVisiable=!e.dialogVisiable}}},[t("i",{staticClass:"el-icon-setting btn"})]),t("el-dialog",{attrs:{title:"设置",visible:e.dialogVisiable,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[t("base-class-setting",{attrs:{label:"默认班级"},model:{value:e.className,callback:function(t){e.className=t},expression:"className"}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisiable=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确 定")])],1)],1)],1)},kt=[],vt={name:"BaseTemplateBtn",mixins:[_],components:{BaseClassSetting:ge},data(){return{className:"",dialogVisiable:!1}},computed:{defaultClassName(){return this.$store.state.defaultClassName}},created(){this.className=this.defaultClassName},methods:{onSave(){this.$store.commit("setDefaultClassName",this.className),this.$message.success("设置成功"),this.dialogVisiable=!1}}},xt=vt,Tt=(0,i.Z)(xt,yt,kt,!1,null,"6421ceda",null),Ct=Tt.exports,St=function(){var e=this,t=e._self._c;return t("div",{staticClass:"menuList",style:{width:e.isShowMenu?"250px":"50px"}},[t("div",{staticClass:"title"},[e.isShowMenu?t("p",{staticClass:"text"},[e._v("列表")]):e._e(),t("i",{staticClass:"btn",class:e.isShowMenu?"el-icon-s-fold":"el-icon-s-unfold",on:{click:function(t){return e.$store.commit("setIsShowMenu",!e.isShowMenu)}}})]),t("transition",{attrs:{name:"el-fade-in-linear"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMenu,expression:"isShowMenu"}]},e._l(e.tables,(function(a,s){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("span",{staticClass:"name"},[e._v(e._s(a.name))]),a.data?t("i",{staticClass:"el-icon-download btn",on:{click:function(t){return e.exportExcel(a,t)}}}):e._e(),t("i",{staticClass:"el-icon-delete-solid btn",staticStyle:{"padding-left":"5px"},on:{click:function(t){return e.delectTable(a,s,t)}}}),t("i",{staticClass:"el-icon-top btn",staticStyle:{"padding-left":"3px"},on:{click:function(t){return e.upMove(s,t)}}}),t("i",{staticClass:"el-icon-bottom btn",on:{click:function(t){return e.downMove(s,t)}}})])})),0)]),t("transition",{attrs:{name:"el-fade-in"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowMenu,expression:"!isShowMenu"}]},e._l(e.tables,(function(a){return t("p",{key:a.index,staticClass:"name-item",class:{"name-item-active":a.id==e.curTable.id},on:{click:function(t){return e.changeTable(a)}}},[a.className?t("span",{staticClass:"className",style:{background:e.classNameObj[a.className].bgColor}},[e._v(" "+e._s(a.className)+" ")]):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:a.name,placement:"right"}},[t("i",{staticClass:"el-icon-document"})])],1)})),0)])],1)},Dt=[],wt={name:"MenuList",mixins:[_],computed:{isShowMenu(){return this.$store.state.isShowMenu},tables(){return this.$store.state.tables},curTable(){return this.$store.getters.curTable||{}},classNameObj(){let e={};return O.forEach((t=>{e[t.value]=t})),e}},created(){this.$store.commit("getIsShowMenu")},methods:{changeTable(e){this.$store.commit("setCurTableId",e.id)},exportExcel(e,t){t.stopPropagation(),this.baseExportExcel(e)},delectTable(e,t,a){a.stopPropagation(),this.$store.commit("deleteTable",t),e.id==this.curTableId&&this.$store.commit("setCurTableId",null)},upMove(e,t){t.stopPropagation(),this.$store.commit("upMoveTables",e)},downMove(e,t){t.stopPropagation(),this.$store.commit("downMoveTables",e)}}},Nt=wt,$t=(0,i.Z)(Nt,St,Dt,!1,null,"2f30bf80",null),_t=$t.exports,Et={name:"ExcelView",components:{CompaseDialog:Q,BaseTemplateBtn:se,SortTemplate:ce,ScoreTemplate:Le,StudentScoreTemplate:ot,BaseMulSheetExportBtn:ut,BaseMulClassAnalyseBtn:gt,BaseScoreAnalyseBtn:We,BaseSettingBtn:Ct,MenuList:_t,TotalSortTemplate:He},mixins:[_],data(){return{tableHeight:500,compaseDialog:{show:!1}}},computed:{...(0,M.rn)({subjectMap:e=>e.subjectMap,tables:e=>e.tables,defaultClassName:e=>e.defaultClassName}),curTable(){return this.$store.getters.curTable||{}}},created(){this.$store.commit("getTables"),this.$store.commit("getDefaultClassName"),this.$store.commit("getDownloadSetting")},mounted(){this.tableHeight=b()(".content")[0].offsetHeight-56,this.$store.commit("getCurTableId")},methods:{fileChange(e){return/\.(xls|xlsx)$/.test(e.name)?e.raw?void this.importFile(e):this.$message.error("文件导入失败"):this.$message.error("上传格式不正确，请上传xls/xlsx文件格式")},importFile(e){let t=this.curTable;const a=new FileReader;a.readAsArrayBuffer(e.raw),a.onload=a=>{const s=a.target.result,l=p.ij(s,{type:"binary"});l.SheetNames.forEach((a=>{const s=p.P6.sheet_to_json(l.Sheets[a]);if(0==s.length)return;const o={name:a.indexOf("Sheet")<0?a:e.name,data:s,id:Date.now(),column:Object.keys(s[0]),className:this.defaultClassName,isCompare:!1,sortObj:this.sortCompare(s)};this.$store.commit("addTable",o),t=o.id})),this.$store.commit("setCurTableId",t)}},sortCompare(e){let t={};return e.forEach((e=>{let a=e["姓名"];for(let s in e)"姓名"!==s&&(t[s]||(t[s]=[]),t[s].push({name:a,score:e[s]}))})),t},onDelete(){this.$store.commit("setCurTableId",null),this.$store.commit("setTables",[])}}},jt=Et,It=(0,i.Z)(jt,u,m,!1,null,"88fac952",null),Lt=It.exports;s["default"].use(h.ZP);const Rt=[{path:"/",name:"home",component:Lt},{path:"/test",name:"test",component:()=>a.e(241).then(a.bind(a,2306))},{path:"/echarts",name:"echarts",component:()=>a.e(338).then(a.bind(a,9597))}],Mt=new h.ZP({routes:Rt});var At=Mt,Ot=a(3139);s["default"].prototype.$echarts=Ot,s["default"].prototype.$echarts=Ot,s["default"].config.productionTip=!1,s["default"].use(K(),{size:"mini"}),new s["default"]({router:At,store:B,render:e=>e(c)}).$mount("#app")},5234:function(){},3659:function(){}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,l,o){if(!s){var i=1/0;for(h=0;h<e.length;h++){s=e[h][0],l=e[h][1],o=e[h][2];for(var n=!0,r=0;r<s.length;r++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[r])}))?s.splice(r--,1):(n=!1,o<i&&(i=o));if(n){e.splice(h--,1);var c=l();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,l,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,s){return a.f[s](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"faf4ed3c",338:"e4755d17"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+{241:"test-view",338:"echarts-view"}[e]+"."+{241:"4f034e44",338:"8f9a6dcf"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="students-score-analyse:";a.l=function(s,l,o,i){if(e[s])e[s].push(l);else{var n,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+o){n=u;break}}n||(r=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,a.nc&&n.setAttribute("nonce",a.nc),n.setAttribute("data-webpack",t+o),n.src=s),e[s]=[l];var m=function(t,a){n.onerror=n.onload=null,clearTimeout(d);var l=e[s];if(delete e[s],n.parentNode&&n.parentNode.removeChild(n),l&&l.forEach((function(e){return e(a)})),t)return t(a)},d=setTimeout(m.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=m.bind(null,n.onerror),n.onload=m.bind(null,n.onload),r&&document.head.appendChild(n)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e=function(e,t,a,s){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css";var o=function(o){if(l.onerror=l.onload=null,"load"===o.type)a();else{var i=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.href||t,r=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");r.code="CSS_CHUNK_LOAD_FAILED",r.type=i,r.request=n,l.parentNode.removeChild(l),s(r)}};return l.onerror=l.onload=o,l.href=t,document.head.appendChild(l),l},t=function(e,t){for(var a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s],o=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(o===e||o===t))return l}var i=document.getElementsByTagName("style");for(s=0;s<i.length;s++){l=i[s],o=l.getAttribute("data-href");if(o===e||o===t)return l}},s=function(s){return new Promise((function(l,o){var i=a.miniCssF(s),n=a.p+i;if(t(i,n))return l();e(s,n,l,o)}))},l={143:0};a.f.miniCss=function(e,t){var a={241:1,338:1};l[e]?t.push(l[e]):0!==l[e]&&a[e]&&t.push(l[e]=s(e).then((function(){l[e]=0}),(function(t){throw delete l[e],t})))}}(),function(){var e={143:0};a.f.j=function(t,s){var l=a.o(e,t)?e[t]:void 0;if(0!==l)if(l)s.push(l[2]);else{var o=new Promise((function(a,s){l=e[t]=[a,s]}));s.push(l[2]=o);var i=a.p+a.u(t),n=new Error,r=function(s){if(a.o(e,t)&&(l=e[t],0!==l&&(e[t]=void 0),l)){var o=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",n.name="ChunkLoadError",n.type=o,n.request=i,l[1](n)}};a.l(i,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,s){var l,o,i=s[0],n=s[1],r=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(l in n)a.o(n,l)&&(a.m[l]=n[l]);if(r)var h=r(a)}for(t&&t(s);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(h)},s=self["webpackChunkstudents_score_analyse"]=self["webpackChunkstudents_score_analyse"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(1887)}));s=a.O(s)})();
//# sourceMappingURL=app.da4aabaa.js.map